!function(){"use strict";var e={67023:function(e,r,n){var t=n(37762),a=n(93433),o=n(1413),i=n(74165),u=n(29439);function c(e,r){if(e&&r)return!Array.isArray(r)&&console.error(r),r.reduce((function(e,r){return null===e||void 0===e?void 0:e[r]}),e)}function s(e,r){return Object.fromEntries(e.map((function(e,n){return[e,r(e,n)]})))}function f(e,r){return Object.fromEntries(Object.entries(e).map((function(e,n){var t=(0,u.Z)(e,2),a=t[0],o=t[1];return[a,r(o,a,n)]})))}var l=(0,i.Z)().mark((function e(r,n){var t;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=r;case 1:if(!(t<=n)){e.next=7;break}return e.next=4,t;case 4:t++,e.next=1;break;case 7:case"end":return e.stop()}}),e)}));function d(e,r){return(0,a.Z)(l(e,r))}function p(e){throw new Error("Should not reach this with value ".concat(e))}function h(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return r.reduce((function(e,r){return e.flatMap((function(e){return r.map((function(r){return[e,[r]].flat()}))}))}),[[]])}v(NaN,{name:"TODO"}),m(1),m(0),v("none");function v(e,r){return"number"===typeof e?{operation:"const",operands:[],type:"number",value:e,info:r}:{operation:"const",operands:[],type:"string",value:e,info:r}}function m(e,r){return e>=Number.MAX_VALUE/100&&(e=1/0),e<=-Number.MAX_VALUE/100&&(e=-1/0),v(e,(0,o.Z)({unit:"%"},r))}function b(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return{operation:"add",operands:y(r)}}function g(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return{operation:"mul",operands:y(r)}}function w(e,r){return{operation:"read",operands:[],path:e,info:r,type:"number"}}function y(e){return e.map((function(e){return"object"===typeof e?e:v(e)}))}function k(e){return"object"!==typeof e?v(e):e}function Z(e,r,n){var t=new Set,a=new Set;e.forEach((function e(o){a.has(o)||(t.has(o)?console.error("Found cyclical dependency during formula traversal"):(t.add(o),r(o),o.operands.forEach(e),n(o),t.delete(o),a.add(o)))}))}function x(e,r,n){var t=new Set,a=new Map,i=new Map;function u(e){var c=a.get(e);if(c)return c;c=r(e);var s=i.get(c);return s||(t.has(c)?(console.error("Found cyclical dependency during formula mapping"),v(NaN)):(t.add(c),s=n(function(e){var r=e.operands.map(u);return M(r,e.operands)?e:(0,o.Z)((0,o.Z)({},e),{},{operands:r})}(c),e),t.delete(c),a.set(e,s),i.set(c,s),s))}var c=e.map(u);return M(c,e)?e:c}function S(e,r,n){var t=new Map;function a(e,r){var o=t.get(r);o||t.set(r,o=[new Set,new Map]);var i=o,c=(0,u.Z)(i,2),s=c[0],f=c[1],l=f.get(e);if(l)return l;if(s.has(e))throw new Error("Found cyclical dependency during formula mapping");s.add(e);var d=n(e,r,a);return f.set(e,d),s.delete(e),d}return e.map((function(e){return a(e,r)}))}function M(e,r){return void 0===e?void 0===r:void 0!==r&&(e.length===r.length&&e.every((function(e,n){return e===r[n]})))}var E={min:function(e){return Math.min.apply(Math,(0,a.Z)(e))},max:function(e){return Math.max.apply(Math,(0,a.Z)(e))},add:function(e){return e.reduce((function(e,r){return e+r}),0)},mul:function(e){return e.reduce((function(e,r){return e*r}),1)}},O=(0,o.Z)((0,o.Z)({},E),{},{res:function(e){var r=(0,u.Z)(e,1)[0];return r<0?1-r/2:r>=.75?1/(4*r+1):1-r},sum_frac:function(e){return e[0]/e.reduce((function(e,r){return e+r}))},threshold:function(e){var r=(0,u.Z)(e,4),n=r[0],t=r[1],a=r[2],o=r[3];return n>=t?a:o}}),B=new Set(Object.keys(E));function j(e,r,n,t){var o='\n"use strict";\n// copied from the code above\nfunction res(res) {\n  if (res < 0) return 1 - res / 2\n  else if (res >= 0.75) return 1 / (res * 4 + 1)\n  return 1 - res\n};\nconst x0=0',i=1,c=new Map;return Z(e,(function(e){}),(function(e){var s=e.operation,f=e.operands,l="x".concat(i++),d=f.map((function(e){return c.get(e)}));switch(c.set(e,l),s){case"read":var h=n(e),v=new Array(t).fill(null).map((function(e,r){return"(b[".concat(r,'].values["').concat(h,'"] ?? 0)')}));r[h]&&0!==r[h]&&(v=[r[h].toString()].concat((0,a.Z)(v))),o+=",".concat(l,"=").concat(v.join("+"));break;case"const":c.set(e,"(".concat(e.value,")"));break;case"add":case"mul":o+=",".concat(l,"=").concat(d.join("add"===s?"+":"*"));break;case"min":case"max":o+=",".concat(l,"=Math.").concat(s,"(").concat(d,")");break;case"threshold":var m=(0,u.Z)(d,4),b=m[0],g=m[1],w=m[2],y=m[3];o+=",".concat(l,"=(").concat(b,">=").concat(g,")?").concat(w,":").concat(y);break;case"res":o+=",".concat(l,"=res(").concat(d[0],")");break;case"sum_frac":o+=",".concat(l,"=").concat(d[0],"/(").concat(d[0],"+").concat(d[1],")");break;default:p(s)}})),o+=";\nreturn [".concat(e.map((function(e){return c.get(e)})),"]"),new Function("b",o)}function T(e){return x(e,(function(e){return e}),(function(e){var r=e;if(B.has(e.operation)){var n=e,t=n.operation,a=!1,i=n.operands.flatMap((function(e){return e.operation===t?(a=!0,e.operands):[e]}));r=a?(0,o.Z)((0,o.Z)({},n),{},{operands:i}):n}return r}))}function V(e){function r(e){var r,n=new Map,a=(0,t.Z)(e);try{for(a.s();!(r=a.n()).done;){var o,i=r.value;n.set(i,(null!==(o=n.get(i))&&void 0!==o?o:0)+1)}}catch(u){a.e(u)}finally{a.f()}return n}for(var n={common:{counts:new Map,formulas:new Set,operation:"add"}},i=function(){for(var i,c=void 0,s={operation:n.common.operation,operands:(i=n.common.counts,(0,a.Z)(i).flatMap((function(e){var r=(0,u.Z)(e,2),n=r[0],t=r[1];return Array(t).fill(n)})))},f=new Map,l=0,d=Object.keys(E);l<d.length;l++){var p=d[l];f.set(p,[])}if(e=x(e,(function(e){if(n.common.formulas.has(e)){var r=e,t=new Map(n.common.counts),a=r.operands.filter((function(e){var r=t.get(e);return!r||(t.set(e,r-1),!1)}));return a.length?(a.push(s),(0,o.Z)((0,o.Z)({},r),{},{operands:a})):s}return e}),(function(e){if(!B.has(e.operation))return e;var n=e;if(c){if(c.operation===n.operation){var a,o=r(n.operands),i=new Map,s=c.counts,l=0,d=(0,t.Z)(o.entries());try{for(d.s();!(a=d.n()).done;){var p,h=(0,u.Z)(a.value,2),v=h[0],m=h[1],b=Math.min(m,null!==(p=s.get(v))&&void 0!==p?p:0);b?(i.set(v,b),l+=b):i.delete(v)}}catch(P){d.e(P)}finally{d.f()}l>1&&(c.counts=i,c.formulas.add(n))}}else{var g,w=f.get(n.operation),y=r(n.operands),k=(0,t.Z)(w);try{for(k.s();!(g=k.n()).done;){var Z,x=(0,u.Z)(g.value,2),S=x[0],M=x[1],E=0,O=new Map,j=(0,t.Z)(M.entries());try{for(j.s();!(Z=j.n()).done;){var T,V=(0,u.Z)(Z.value,2),A=V[0],F=V[1],D=Math.min(F,null!==(T=y.get(A))&&void 0!==T?T:0);D&&(O.set(A,D),E+=D)}}catch(P){j.e(P)}finally{j.f()}if(E>1){c={counts:O,formulas:new Set([n,S]),operation:n.operation},f.clear();break}}}catch(P){k.e(P)}finally{k.f()}c||w.push([n,y])}return n})),!c)return"break";n.common=c};;){if("break"===i())break}return e}function A(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return!1},i={data:[],processed:new Map},s=new Map([[i,new Map]]),f={data:[r],processed:new Map};return s.set(f,new Map),s.get(i).set(r,f),S(e,f,(function(e,r,f){var l,d,h=e.operation,m=function(e,r){return f(e,r)},b=function(e,r){return f(e,r)};switch(h){case"const":d=e;break;case"add":case"mul":case"max":case"min":var g=O[h],w=[],y=e.operands.filter((function(e){var n=m(e,r);return"const"!==n.operation||(w.push(n.value),!1)})).map((function(e){return m(e,r)})),k=g(w);if(isFinite(k)){if("mul"===h&&0===k){d=v(k);break}}else if("mul"!==h&&("max"!==h||k>0)&&("min"!==h||k<0)){d=v(k);break}k!==g([])&&y.push(v(k)),d=y.length<=1?null!==(l=y[0])&&void 0!==l?l:v(g([])):{operation:h,operands:y};break;case"res":case"sum_frac":var Z=e.operands.map((function(e){return m(e,r)})),x=O[h];d=Z.every((function(e){return"const"===e.operation}))?v(x(Z.map((function(e){return e.value})))):(0,o.Z)((0,o.Z)({},e),{},{operands:Z});break;case"lookup":var S=b(e.operands[0],r);if("const"===S.operation){var M,E=null!==(M=e.table[S.value])&&void 0!==M?M:e.operands[1];if(E){d=f(E,r);break}}throw new Error("Unsupported ".concat(h," node while folding"));case"prio":var B=e.operands.find((function(e){var n=b(e,r);if("const"!==n.operation)throw new Error("Unsupported ".concat(h," node while folding"));return void 0!==n.value}));d=B?b(B,r):v(void 0);break;case"small":var j,T,V=void 0,A=(0,t.Z)(e.operands);try{for(A.s();!(T=A.n()).done;){var F,D=T.value,P=b(D,r);if("const"!==P.operation)throw new Error("Unsupported ".concat(h," node while folding"));(void 0===(null===(F=V)||void 0===F?void 0:F.value)||void 0!==P.value&&P.value<V.value)&&(V=P)}}catch($){A.e($)}finally{A.f()}d=null!==(j=V)&&void 0!==j?j:v(void 0);break;case"match":var N=e.operands.map((function(e){return f(e,r)})),R=(0,u.Z)(N,4),C=R[0],K=R[1],H=R[2],I=R[3];if("const"!==C.operation||"const"!==K.operation)throw new Error("Unsupported ".concat(h," node while folding"));d=C.value===K.value?H:I;break;case"threshold":var W=e.operands.map((function(e){return f(e,r)})),z=(0,u.Z)(W,4),G=z[0],L=z[1],q=z[2],_=z[3];d="const"===q.operation&&"const"===_.operation&&q.value===_.value?q:"const"===G.operation&&"const"===L.operation?G.value>=L.value?q:_:(0,o.Z)((0,o.Z)({},e),{},{operands:[G,L,q,_]});break;case"subscript":var U=m(e.operands[0],r);if("const"!==U.operation)throw new Error("Found non-constant subscript node while folding");d=v(e.list[U.value]);break;case"read":var Y=r.data.map((function(r){return c(r,e.path)})).filter((function(e){return e}));if(0===Y.length)if(n(e)){var X=e.accu;d=void 0===X||"small"===X?"string"===e.type?v(void 0):v(NaN):v(O[X]([]))}else d=e;else d=void 0===e.accu||1===Y.length?f(Y[Y.length-1],r):f({operation:e.accu,operands:Y},r);break;case"data":e.reset&&(r=i);var J=s.get(r),Q=J.get(e.data);Q||(Q={data:[].concat((0,a.Z)(r.data),[e.data]),processed:new Map},s.set(Q,new Map),J.set(e.data,Q)),d=f(e.operands[0],Q);break;default:p(h)}return d.info&&delete(d=(0,o.Z)({},d)).info,d}))}var F=["flower","plume","sands","goblet","circlet"],D=(["physical"].concat(["anemo","geo","electro","hydro","pyro","cryo","dendro"]),["Adventurer","ArchaicPetra","Berserker","BlizzardStrayer","BloodstainedChivalry","BraveHeart","CrimsonWitchOfFlames","DeepwoodMemories","DefendersWill","DesertPavilionChronicle","EchoesOfAnOffering","EmblemOfSeveredFate","FlowerOfParadiseLost","Gambler","GildedDreams","GladiatorsFinale","HeartOfDepth","HuskOfOpulentDreams","Instructor","Lavawalker","LuckyDog","MaidenBeloved","MartialArtist","NoblesseOblige","OceanHuedClam","PaleFlame","PrayersForDestiny","PrayersForIllumination","PrayersForWisdom","PrayersToSpringtime","ResolutionOfSojourner","RetracingBolide","Scholar","ShimenawasReminiscence","TenacityOfTheMillelith","TheExile","ThunderingFury","Thundersoother","TinyMiracle","TravelingDoctor","VermillionHereafter","ViridescentVenerer","WanderersTroupe"]),P=["Albedo","Aloy","Amber","AratakiItto","Barbara","Beidou","Bennett","Candace","Chongyun","Collei","Cyno","Diluc","Diona","Dori","Eula","Faruzan","Fischl","Ganyu","Gorou","HuTao","Jean","KaedeharaKazuha","Kaeya","KamisatoAyaka","KamisatoAyato","Keqing","Klee","KujouSara","KukiShinobu","Layla","Lisa","Mona","Nahida","Nilou","Ningguang","Noelle","Qiqi","RaidenShogun","Razor","Rosaria","SangonomiyaKokomi","Sayu","Shenhe","ShikanoinHeizou","Sucrose","Tartaglia","Thoma","Tighnari","Venti","Wanderer","Xiangling","Xiao","Xingqiu","Xinyan","YaeMiko","Yanfei","Yelan","Yoimiya","YunJin","Zhongli"],N=([].concat(P,["Traveler"]),["TravelerAnemo","TravelerGeo","TravelerElectro","TravelerDendro"]);[].concat(P,N),[].concat(P,["TravelerAnemoF","TravelerGeoF","TravelerElectroF","TravelerDendroF"],["TravelerAnemoM","TravelerGeoM","TravelerElectroM","TravelerDendroM"]),[].concat(["AmenomaKageuchi","AquilaFavonia","BlackcliffLongsword","CinnabarSpindle","CoolSteel","KagotsurubeIsshin","DarkIronSword","DullBlade","FavoniusSword","FesteringDesire","FilletBlade","FreedomSworn","HaranGeppakuFutsu","HarbingerOfDawn","IronSting","KeyOfKhajNisut","LionsRoar","MistsplitterReforged","PrimordialJadeCutter","PrototypeRancour","RoyalLongsword","SacrificialSword","SapwoodBlade","SilverSword","SkyriderSword","SkywardBlade","SummitShaper","SwordOfDescension","TheAlleyFlash","TheBlackSword","TheFlute","ToukabouShigure","TravelersHandySword","XiphosMoonlight"],["Akuoumaru","BlackcliffSlasher","BloodtaintedGreatsword","DebateClub","FavoniusGreatsword","FerrousShadow","ForestRegalia","KatsuragikiriNagamasa","LithicBlade","LuxuriousSeaLord","MakhairaAquamarine","OldMercsPal","PrototypeArchaic","Rainslasher","RedhornStonethresher","RoyalGreatsword","SacrificialGreatsword","SerpentSpine","SkyriderGreatsword","SkywardPride","SnowTombedStarsilver","SongOfBrokenPines","TheBell","TheUnforged","WasterGreatsword","Whiteblind","WhiteIronGreatsword","WolfsGravestone"],["BeginnersProtector","BlackcliffPole","BlackTassel","CalamityQueller","CrescentPike","Deathmatch","DragonsBane","DragonspineSpear","EngulfingLightning","FavoniusLance","Halberd","IronPoint","KitainCrossSpear","LithicSpear","MissiveWindspear","Moonpiercer","PrimordialJadeWingedSpear","PrototypeStarglitter","RoyalSpear","SkywardSpine","StaffOfHoma","StaffOfTheScarletSands","TheCatch","VortexVanquisher","WavebreakersFin","WhiteTassel"],["AlleyHunter","AmosBow","AquaSimulacra","BlackcliffWarbow","CompoundBow","ElegyForTheEnd","EndOfTheLine","FadingTwilight","FavoniusWarbow","Hamayumi","HuntersBow","HuntersPath","KingsSquire","Messenger","MitternachtsWaltz","MouunsMoon","PolarStar","Predator","PrototypeCrescent","RavenBow","RecurveBow","RoyalBow","Rust","SacrificialBow","SeasonedHuntersBow","SharpshootersOath","SkywardHarp","Slingshot","TheStringless","TheViridescentHunt","ThunderingPulse","WindblumeOde"],["ApprenticesNotes","AThousandFloatingDreams","BlackcliffAgate","DodocoTales","EmeraldOrb","EverlastingMoonglow","EyeOfPerception","FavoniusCodex","Frostbearer","FruitOfFulfillment","HakushinRing","KagurasVerity","LostPrayerToTheSacredWinds","MagicGuide","MappaMare","MemoryOfDust","OathswornEye","OtherworldlyStory","PocketGrimoire","PrototypeAmber","RoyalGrimoire","SacrificialFragments","SkywardAtlas","SolarPearl","TheWidsith","ThrillingTalesOfDragonSlayers","TulaytullahsRemembrance","TwinNephrite","WanderingEvenstar","WineAndSong"]);var R=(0,i.Z)().mark(I),C=(0,i.Z)().mark(z);function K(e,r){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=new Set,c=new Set;function l(e,r){r?i.add(e):e.operands.forEach((function(e){return i.has(e)&&c.add(e)}))}var d=new Set;if(Z(e,(function(e){}),(function(e){var r=e.operation;switch(r){case"read":d.add(e.path[1]),l(e,!0);break;case"add":l(e,e.operands.every((function(e){return i.has(e)})));break;case"mul":var n=e.operands.filter((function(e){return"const"!==e.operation}));l(e,0===n.length||1===n.length&&i.has(n[0]));break;case"const":l(e,!0);break;case"res":case"threshold":case"sum_frac":case"max":case"min":l(e,!1);break;default:p(r)}})),(0,a.Z)(c).every((function(e){var r=e.operation;return"read"===r||"const"===r}))&&Object.keys(r.base).length===d.size)return{nodes:e,arts:r};var h=-1;function m(){for(;d.has("".concat(++h)););return"".concat(h)}e.forEach((function(e){return i.has(e)&&c.add(e)}));var b=(0,a.Z)(c).filter((function(e){return"const"!==e.operation})),g=new Map(b.map((function(e){return[e,n||"read"!==e.operation||"dyn"!==e.path[0]?(0,o.Z)((0,o.Z)({},w(["dyn","".concat(m())])),{},{accu:"add"}):e]})));function y(e){var r=A((0,a.Z)(g.keys()),{dyn:f(e,(function(e){return v(e)}))},(function(e){return!0}));return Object.fromEntries((0,a.Z)(g.values()).map((function(e,n){return[e.path[1],r[n].value]})))}for(var k={nodes:e=x(e,(function(e){var r;return null!==(r=g.get(e))&&void 0!==r?r:e}),(function(e){return e})),arts:{base:y(r.base),values:s(F,(function(e){return r.values[e].map((function(e){return{id:e.id,set:e.set,values:y(e.values)}}))}))}},S=Object.entries(y({})),M=0,E=Object.values(k.arts.values);M<E.length;M++){var O,B=E[M],j=(0,t.Z)(B);try{for(j.s();!(O=j.n()).done;){var T,V=O.value.values,D=(0,t.Z)(S);try{for(D.s();!(T=D.n()).done;){var P=(0,u.Z)(T.value,2),N=P[0],R=P[1];V[N]-=R}}catch(C){D.e(C)}finally{D.f()}}}catch(C){j.e(C)}finally{j.f()}}return k}function H(e,r){return{keys:e.keys,base:e.base,baseBuffer:e.baseBuffer,values:s(F,(function(n){var t=r[n],a=e.values[n];return t.map((function(e){return a[e]}))}))}}function I(e,r){var n,o,c,s,l,d,p;return(0,i.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:n=f(r.values,(function(e){return new Set(e.map((function(e){return e.set})))})),o=(0,t.Z)(e),i.prev=2,o.s();case 4:if((c=o.n()).done){i.next=19;break}s=c.value,l=function(){var e=(0,u.Z)(p[d],2),r=e[0],t=e[1],o=n[r];switch(t.kind){case"required":if((0,a.Z)(t.sets).every((function(e){return!o.has(e)})))return"continue|filter_loop";break;case"exclude":if((0,a.Z)(o).every((function(e){return t.sets.has(e)})))return"continue|filter_loop"}},d=0,p=Object.entries(s);case 8:if(!(d<p.length)){i.next=15;break}if("continue|filter_loop"!==l()){i.next=12;break}return i.abrupt("continue",17);case 12:d++,i.next=8;break;case 15:return i.next=17,s;case 17:i.next=4;break;case 19:i.next=24;break;case 21:i.prev=21,i.t0=i.catch(2),o.e(i.t0);case 24:return i.prev=24,o.f(),i.finish(24);case 27:case"end":return i.stop()}}),R,null,[[2,21,24,27]])}function W(e){return new Set(null!==e&&void 0!==e&&e.includes(2)?e.includes(4)?[0,1]:[0,1,4,5]:null!==e&&void 0!==e&&e.includes(4)?[0,1,2,3]:[0,1,2,3,4,5])}function z(e,r){var n,c,l,p,h,v,m,b,g,w,y,k,Z,x,S,M;return(0,i.Z)().wrap((function(E){for(;;)switch(E.prev=E.next){case 0:for(Z=function(e){var r,u,s,f,l,p,h,v,m,b,g;return(0,i.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:g=function(e){var r,n,s,f,p,h,v,m,b,Z,x,S,M,E;return(0,i.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:r=l.length-e,n=[],s=[],f=[],p=0,h=(0,t.Z)(c),i.prev=3,m=function(){var e=v.value,t=k[e],o=y[e];if(!t)return"continue";d(1,r).every((function(e){return!t.has(o+e)}))?f.push(e):t.has(o)?d(0,r).some((function(e){return!t.has(o+e)}))&&n.push(e):(p+=(0,a.Z)(t).find((function(e){return e>o}))-o,s.push(e))},h.s();case 6:if((v=h.n()).done){i.next=12;break}if("continue"!==m()){i.next=10;break}return i.abrupt("continue",10);case 10:i.next=6;break;case 12:i.next=17;break;case 14:i.prev=14,i.t0=i.catch(3),h.e(i.t0);case 17:return i.prev=17,h.f(),i.finish(17);case 20:if(!(p>r)){i.next=22;break}return i.abrupt("return");case 22:if(e!==l.length){i.next=26;break}return i.next=25,(0,o.Z)({},w);case 25:return i.abrupt("return");case 26:if(p!==r){i.next=47;break}b=(0,t.Z)(s),i.prev=28,b.s();case 30:if((Z=b.n()).done){i.next=38;break}return x=Z.value,y[x]++,w[F[l[e]]]={kind:"required",sets:new Set([x])},i.delegateYield(g(e+1),"t1",35);case 35:y[x]--;case 36:i.next=30;break;case 38:i.next=43;break;case 40:i.prev=40,i.t2=i.catch(28),b.e(i.t2);case 43:return i.prev=43,b.f(),i.finish(43);case 46:return i.abrupt("return");case 47:S=0,M=[].concat(n,s);case 48:if(!(S<M.length)){i.next=57;break}return E=M[S],y[E]++,w[F[l[e]]]={kind:"required",sets:new Set([E])},i.delegateYield(g(e+1),"t3",53);case 53:y[E]--;case 54:S++,i.next=48;break;case 57:return w[F[l[e]]]={kind:"exclude",sets:new Set([].concat(s,f,n))},i.delegateYield(g(e+1),"t4",59);case 59:case"end":return i.stop()}}),u,null,[[3,14,17,20],[28,40,43,46]])},b=function(e){var n,a,o;return(0,i.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e!==f.length){r.next=3;break}return r.delegateYield(g(0),"t0",2);case 2:return r.abrupt("return",r.t0);case 3:n=(0,t.Z)(c),r.prev=4,o=(0,i.Z)().mark((function r(){var n,t,o,u,c;return(0,i.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=a.value,!s.has(n)){r.next=3;break}return r.abrupt("return","continue");case 3:if(t=f[e].length,o=k[n],u=0,!o||o.has(t)){r.next=9;break}if(!((u=(null!==(c=d(t+1,5).find((function(e){return o.has(e)})))&&void 0!==c?c:6)-t)>m)){r.next=9;break}return r.abrupt("return","continue");case 9:return s.add(n),y[n]=f[e].length,f[e].forEach((function(e){return w[F[e]]={kind:"required",sets:new Set([n])}})),m-=u,r.delegateYield(b(e+1),"t0",14);case 14:m+=u,y[n]=0,s.delete(n);case 17:case"end":return r.stop()}}),r)})),n.s();case 7:if((a=n.n()).done){r.next=14;break}return r.delegateYield(o(),"t1",9);case 9:if("continue"!==r.t1){r.next=12;break}return r.abrupt("continue",12);case 12:r.next=7;break;case 14:r.next=19;break;case 16:r.prev=16,r.t2=r.catch(4),n.e(r.t2);case 19:return r.prev=19,n.f(),r.finish(19);case 22:case"end":return r.stop()}}),r,null,[[4,16,19,22]])},r=(0,i.Z)().mark(b),u=(0,i.Z)().mark(g),s=new Set,f=[],l=[],p=(0,t.Z)(e);try{for(p.s();!(h=p.n()).done;)v=h.value,f.push([]),5===v?l.push(f.length-1):f[v].push(f.length-1)}catch(Z){p.e(Z)}finally{p.f()}return f=f.filter((function(e){return e.length})).sort((function(e,r){return r.length-e.length})),m=l.length,n.delegateYield(b(0),"t0",10);case 10:case"end":return n.stop()}}),n)},v=function(e,r){if(!d(r+1,4).some((function(r){return 5!==e[r]})))return(e=(0,a.Z)(e))[r]=5,e.reduce((function(e,r){return 6*e+r}),0)},h=function(e,r,n){if(5!==e.length){var o,i=(0,t.Z)(r);try{var u=function(){var t=o.value;h([].concat((0,a.Z)(e),[t]),r,n.filter((function(e){return e!==t})))};for(i.s();!(o=i.n()).done;)u()}catch(c){i.e(c)}finally{i.f()}h([].concat((0,a.Z)(e),[e.length]),new Set([].concat((0,a.Z)(r),[e.length])),[].concat((0,a.Z)(n),[e.length]))}else l.has(n.length)&&p.push(e)},n=(0,i.Z)().mark(Z),c=(0,a.Z)(new Set(r)),l=W(e.rainbow),p=[],h([0],new Set([0]),[0]),m=function(e){var r,n=new Map,o=(0,t.Z)(p);try{for(o.s();!(r=o.n()).done;){var i,c=r.value,s=v(c,e);void 0!==s&&n.set(s,(null!==(i=n.get(s))&&void 0!==i?i:new Set(c.slice(0,e)).size+1)-1)}}catch(h){o.e(h)}finally{o.f()}var f,l=(0,t.Z)(n.entries());try{var d=function(){var r=(0,u.Z)(f.value,2),n=r[0];if(0===r[1]){var t=(0,a.Z)(p.find((function(r){return v(r,e)===n})));t[e]=5,p=p.filter((function(r){return v(r,e)!==n})),p.push(t)}};for(l.s();!(f=l.n()).done;)d()}catch(h){l.e(h)}finally{l.f()}},b=4;b>=0;b--)m(b);g={kind:"exclude",sets:new Set},w=s(F,(function(e){return g})),y=(0,o.Z)((0,o.Z)({},f(e,(function(e){return 0}))),s(c,(function(e){return 0}))),k=f(e,W),x=(0,t.Z)(p),E.prev=14,x.s();case 16:if((S=x.n()).done){E.next=21;break}return M=S.value,E.delegateYield(Z(M),"t0",19);case 19:E.next=16;break;case 21:E.next=26;break;case 23:E.prev=23,E.t1=E.catch(14),x.e(E.t1);case 26:return E.prev=26,x.f(),E.finish(26);case 29:case"end":return E.stop()}}),C,null,[[14,23,26,29]])}s(F,(function(e){return{kind:"exclude",sets:new Set}}));var G=n(15671),L=n(43144),q=n(4942);function _(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return r.flat()}function U(){return h.apply(void 0,arguments).map((function(e){return e.reduce((function(e,r){var n;return e.coeff*=r.coeff,(n=e.terms).push.apply(n,(0,a.Z)(r.terms)),e}),{coeff:1,terms:[]})}))}function Y(e){return[{coeff:e,terms:[]}]}function X(e){return[{coeff:1,terms:[e]}]}function J(e){var r=(0,a.Z)(e);r.forEach((function(e){return e.terms.sort()})),r.sort((function(e,r){var n=e.terms,t=r.terms;if(n.length!==t.length)return n.length-t.length;for(var a=0;a<n.length;a++)if(n[a]!==t[a])return n[a]<t[a]?-1:1;return 0}));for(var n=function(e){var n,t,a=r[e].terms,o=r[e+1].terms;if(a.length!==o.length)return"continue";a.every((function(e,r){return e===o[r]}))&&(r[e].coeff=(null!==(n=r[e].coeff)&&void 0!==n?n:0)+(null!==(t=r[e+1].coeff)&&void 0!==t?t:0),r.splice(e+1,1))},t=r.length-2;t>=0;t--)n(t);return r}function Q(e,r){for(var n=r.i,t=r.j,a=e[n][t],o=0;o<e.length;o++)if(o!==n)for(var i=0;i<e[0].length;i++)i!==t&&(e[o][i]-=e[n][i]*e[o][t]/a);for(var u=0;u<e.length;u++)u!==n&&(e[u][t]=-e[u][t]/a);for(var c=0;c<e[0].length;c++)c!==t&&(e[n][c]=e[n][c]/a);e[n][t]=1/a}function $(e){for(var r=e.length,n=e[0].length,t={i:-1,j:-1,cmp:1/0},a=0;a<n-1;a++)if(!(e[r-1][a]>=0)){for(var o=0;o<r-1;o++)if(e[o][a]>1e-5){var i=e[o][n-1]/e[o][a];i<t.cmp&&(t={i:o,j:a,cmp:i})}if(t.i<0)throw Error("UNBOUNDED FEASIBLE")}if(t.i<0)throw Error("NO PIVOTS (done)");return{i:t.i,j:t.j}}function ee(e){for(var r=e.length,n=e[0].length,t={i:-1,j:-1,cmp:1/0},a=0;a<r-1;a++)if(!(e[a][n-1]>=0)){for(var o=0;o<n-1;o++)if(e[a][o]<-1e-5){var i=e[a][n-1]/e[a][o];i<t.cmp&&(t={i:a,j:o,cmp:i})}if(t.i<0)throw Error("INFEASIBLE");return{i:t.i,j:t.j}}throw Error("NO PIVOTS (done)")}function re(e,r,n){var t=j([e],{},(function(e){return e.path[1]}),1);return[t([{id:"",values:r}])[0],t([{id:"",values:n}])[0]]}function ne(e,r,n){var t=function e(r){switch(r.operation){case"add":return b.apply(void 0,(0,a.Z)(r.operands.map((function(r){return e(r)}))));case"const":return v(-r.value);case"threshold":var n=(0,u.Z)(r.operands,4),t=n[0],o=n[1],i=n[2],c=n[3];if("const"===i.operation&&"const"===c.operation&&i.value<=c.value)return function(e,r,n,t,a){return{operation:"threshold",operands:[k(e),k(r),k(n),k(t)],info:a}}(t,o,-i.value,-c.value);throw console.log(r),Error("(res neg slope): threshold. Something went wrong.");default:throw console.log(r),Error("(res neg slope) Havent written logic to handle this")}}(e.operands[0]),o=re(t,r,n),i=(0,u.Z)(o,2),c=i[0],s=i[1],f=O.res,l=[f([-c]),f([-s])],d=l[0],p=l[1];return s>0&&c>-1.75?b(1,g(.5,t)):b((s*d-c*p)/(s-c),g((d-p)/(s-c),t))}function te(e,r,n){var t=e.nodes,o=e.terms,i={};Object.entries(t).forEach((function(e){var r=(0,u.Z)(e,2),n=r[0],t=r[1];"read"===t.operation&&(i[t.path[1]]=n)}));function c(e){switch(e.operation){case"const":return Y(e.value);case"read":return X(i[e.path[1]]);case"add":return _.apply(void 0,(0,a.Z)(e.operands.map(c)));case"mul":return U.apply(void 0,(0,a.Z)(e.operands.map(c)));case"threshold":var t=(0,u.Z)(e.operands,4),o=t[0],s=t[1],f=t[2],l=t[3];if("read"===o.operation&&"const"===s.operation&&"const"===l.operation&&"const"===f.operation){if(f.value<l.value)throw console.log(e),Error("Not Implemented (threshold must be increasing)");var d=o.path[1];if(r[d]>=s.value)return Y(f.value);if(n[d]<s.value)return Y(l.value);var p=(f.value-l.value)/(s.value-r[d]),h=U(Y(p),X(i[o.path[1]])),v=l.value-p*r[d];return 0===v?h:_(Y(v),h)}throw console.log(e),Error("Not Implemented (threshold must branch between constants)");case"res":return c(ne(e,r,n));case"min":case"max":var m=(0,u.Z)(e.operands,2),b=m[0],g=m[1];if("const"!==g.operation){var w=[g,b];b=w[0],g=w[1]}if("min"===e.operation)return c(b);if("const"===g.operation){var y=g.value,k=re(b,r,n),Z=(0,u.Z)(k,2),x=Z[0],S=Z[1];if(x>y)return c(b);if(y>S)return Y(y);var M=(S-y)/(S-x);return _(Y(y-M*x),U(Y(M),c(b)))}throw console.log(e),Error("Not Implemented (max between two non-constants)");case"sum_frac":var E=(0,u.Z)(e.operands,2),O=E[0],B=E[1];if("const"!==B.operation)throw Error("Not Implemented (non-constant sum_frac denominator)");var j=re(O,r,n),T=(0,u.Z)(j,2),V=T[0],A=T[1],F=B.value,D=Math.sqrt((V+F)*(A+F))-F,P=(F+D)*(F+D),N=F/P;return _(Y(D*D/P),U(Y(N),c(O)));default:throw console.log(e),Error("Not Implemented")}}var s=Object.fromEntries(Object.entries(t).filter((function(e){var r=(0,u.Z)(e,2);r[0];return"read"!==r[1].operation})).map((function(e){var r=(0,u.Z)(e,2);return[r[0],c(r[1])]}))),f=o.flatMap((function(e){var r=e.coeff,n=e.terms;return U.apply(void 0,[Y(r)].concat((0,a.Z)(n.map((function(e){var r;return null!==(r=s[e])&&void 0!==r?r:X(e)})))))}));f=(f=J(f)).map((function(e){var r=e.coeff,n=e.terms;return{coeff:r,terms:n=n.map((function(e){var r=t[e];if(!r||"read"!==r.operation)throw Error("MUST be a read node.");return r.path[1]}))}}));var l=f.map((function(e){var t=e.coeff,o=e.terms;if(0===o.length)return{w:{},c:t,err:0};if(1===o.length)return{w:(0,q.Z)({},o[0],t),c:0,err:0};var i=function(e){if(0===e.length)return{w:[],c:0,err:0};var r=e.length,n=e.map((function(e){return e.upper})),t=n.reduce((function(e,r){return e*r}),1);e=e.map((function(e){return{lower:e.lower/e.upper,upper:1}}));var o,i=h.apply(void 0,(0,a.Z)(e.map((function(e){return[e.lower,e.upper]})))).flatMap((function(e){var r=e.reduce((function(e,r){return e*r}),1);return[[].concat((0,a.Z)(e.map((function(e){return-e}))),[1,0,-r]),[].concat((0,a.Z)(e),[-1,-1,r])]})),u=[].concat((0,a.Z)(e.map((function(e){return 0}))),[0,1]);try{o=function(e,r){var n=r.length+1,t=r[0].length,a=Array(n).fill(0).map((function(e){return Array(t).fill(0)}));r.forEach((function(e,r){return e.forEach((function(e,n){return a[r][n]=e}))})),e.forEach((function(e,r){return a[n-1][r]=e}));for(var o=[];a.some((function(e,r){return r<n-1&&e[t-1]<0}));){var i=ee(a);o.push(i),Q(a,i)}for(;a[n-1].some((function(e,r){return r<t-1&&e<0}));){var u=$(a);o.push(u),Q(a,u)}return e.map((function(e,r){return function(e,r,n){var t=1;r.forEach((function(e){var r=e.i,a=e.j;1===t&&a===n?(n=r,t=0):0===t&&r===n&&(n=a,t=1)}));var a=e[0].length;return 0===t?e[n][a-1]:0}(a,o,r)}))}(u,i)}catch(c){throw console.log("ERROR on bounds",e),console.log("Possibly numerical instability issue."),c}return{w:o.slice(0,r).map((function(e,r){return e*t/n[r]})),c:-t*o[r],err:t*o[r+1]}}(o.map((function(e){return{lower:r[e],upper:n[e]}}))),u=i.w,c=i.c,s=i.err;return{w:u.reduce((function(e,r,n){var a;return e[o[n]]=r*t+(null!==(a=e[o[n]])&&void 0!==a?a:0),e}),{}),c:t*c,err:t*s+0}}));return l.reduce((function(e,r){return e.c+=r.c,e.err+=r.err,Object.entries(r.w).forEach((function(r){var n,t=(0,u.Z)(r,2),a=t[0],o=t[1];return e.w[a]=o+(null!==(n=e.w[a])&&void 0!==n?n:0)})),e}),{w:{},c:0,err:0})}function ae(e){if(1===e.length)return e[0];var r=(e=e.flatMap((function(e){return"add"===e.operation?e.operands:e}))).reduce((function(e,r){return"const"===r.operation?e+r.value:e}),0);return 0===(e=e.filter((function(e){return"const"!==e.operation}))).length?v(r):0===r?1===e.length?e[0]:b.apply(void 0,(0,a.Z)(e)):b.apply(void 0,(0,a.Z)(e).concat([v(r)]))}function oe(e){if(1===e.length)return e[0];var r=(e=e.flatMap((function(e){return"mul"===e.operation?e.operands:e}))).reduce((function(e,r){return"const"===r.operation?e*r.value:e}),1);return 0===(e=e.filter((function(e){return"const"!==e.operation}))).length?v(r):1===r?g.apply(void 0,(0,a.Z)(e)):g.apply(void 0,(0,a.Z)(e).concat([v(r)]))}function ie(e){return e.reduce((function(e,r){var n=r.filterVec;return e+F.reduce((function(e,r){return e*n[r].length}),1)}),0)}function ue(e){for(var r=(0,a.Z)(e[0].lower),n=(0,a.Z)(e[0].upper),t=(0,a.Z)(e[0].minw),o=(0,a.Z)(e[0].maxw),i=1;i<e.length;i++){for(var u=0;u<r.length;u++)r[u]=Math.min(r[u],e[i].lower[u]),n[u]=Math.max(n[u],e[i].upper[u]);for(var c=0;c<t.length;c++)t[c]=Math.min(t[c],e[i].minw[c]),o[c]=Math.max(o[c],e[i].maxw[c])}return{lower:r,upper:n,minw:t,maxw:o}}function ce(e,r){var n=[],t=[],a=[];r.forEach((function(r){var o=[],i=[];Object.entries(r.w).forEach((function(r){var n=(0,u.Z)(r,2),t=n[0],a=n[1];o.push(e.keys.indexOf(t)),i.push(a)})),n.push(o),t.push(i),a.push(o.reduce((function(r,n,t){return r+e.base[n]*i[t]}),r.c))})),e.baseBuffer=a,F.forEach((function(r){return e.values[r].forEach((function(e){return e.buffer=n.map((function(r,n){return r.reduce((function(r,a,o){return r+e.values[a]*t[n][o]}),0)}))}))}))}function se(e,r,n){var t=n.optimizationTarget,o=n.constraints,i=n.artSetExclusion,c=n.depth,s=n.filters,f=[].concat((0,a.Z)(o.map((function(e){return e.value}))),[t]),l=o.map((function(e){return e.min}));if(0!==(s=s.filter((function(e){var n=e.maxw;return!l.some((function(e,r){return n[r]<e}))&&!(n[l.length]<r)}))).length){var p=ue(s),h=p.lower,m=p.upper,w=Object.fromEntries(e.keys.map((function(e,r){return[e,h[r]]}))),y=Object.fromEntries(e.keys.map((function(e,r){return[e,m[r]]})));f=function(e,r,n){var t=Object.keys(r).filter((function(e){return Math.abs(r[e]-n[e])<1e-6}));return e.map((function(e){var a=e.nodes,o=e.terms,i=Object.entries(a),c=x(i.map((function(e){var r=(0,u.Z)(e,2);return r[0],r[1]})),(function(e){return e}),(function(e){switch(e.operation){case"read":return t.includes(e.path[1])?v(r[e.path[1]]):e;case"threshold":var a=(0,u.Z)(e.operands,4),o=a[0],i=a[1],c=a[2],s=a[3];if("const"===o.operation&&"const"===i.operation)return o.value>=i.value?c:s;if("read"!==o.operation||"const"!==i.operation)throw Error("Branch between non-read and non-const!!!");return r[o.path[1]]>=i.value?c:n[o.path[1]]<i.value?s:e;case"add":return ae(e.operands);case"mul":return oe(e.operands);case"res":case"sum_frac":case"min":case"max":return e.operands.every((function(e){return"const"===e.operation}))?v(O[e.operation](e.operands.map((function(e){return"const"===e.operation?e.value:NaN})))):e;default:return e}})),s={};c.forEach((function(e,r){if("const"===e.operation){var n=(0,u.Z)(i[r],1)[0];s[n]=e.value}}));var f=o.map((function(e){var r=e.coeff,n=e.terms.filter((function(e){return void 0===s[e]||(r*=s[e],!1)}));return 0===r?{coeff:0,terms:[]}:{coeff:r,terms:n}})),l=Object.fromEntries(c.map((function(e,r){return[i[r][0],e]})));return Object.keys(s).forEach((function(e){return delete l[e]})),{nodes:l,terms:J(f)}}))}(f,w,y);for(var k=j(o.map((function(e){return function(e){var r=e.nodes,n=e.terms;return b.apply(void 0,(0,a.Z)(n.map((function(e){var n=e.coeff,t=e.terms;return g.apply(void 0,[n].concat((0,a.Z)(t.map((function(e){return r[e]})))))}))))}(e.value)})),{},(function(e){return e.path[1]}),1),Z=k([{id:"",values:w}]),S=l.map((function(e,r){return e>Z[r]})),M=f.pop(),E=f.map((function(e,r){return{value:e,min:l[r]}})).filter((function(e,r){return S[r]})),B=E.map((function(e){return e.min})),T={},V=function(){var e=(0,u.Z)(P[A],2),r=e[0],n=e[1];if("uniqueKey"===r){T[r]=n;var t=D.filter((function(e){return y[e]>0})),a=0,o=0;if(t.forEach((function(e){var r=d(w[e],y[e]);i[e]&&(r=r.filter((function(r){return!i[e].includes(r)}))),(r.includes(4)||r.includes(5))&&a++,(r.includes(2)||r.includes(3))&&o++})),n.includes(5)&&0===a){if(0===o)return{v:void 0};if(n.includes(3)&&o<2)return{v:void 0}}return"continue"}var c=n.filter((function(e){return w[r]<=e&&e<=y[r]}));if(c.includes(w[r])&&c.includes(y[r]))return{v:void 0};c.length>0&&(T[r]=c)},A=0,P=Object.entries(i);A<P.length;A++){var N=V();if("continue"!==N&&"object"===typeof N)return N.v}var R=[].concat((0,a.Z)(E.map((function(e){return e.value}))),[M]).map((function(e){return te(e,w,y)}));ce(e,R);var C=s.map((function(r){var n=r.filterVec,t=r.lower,o=r.upper,i=H(e,r.filterVec),u=(0,a.Z)(i.baseBuffer),c=(0,a.Z)(i.baseBuffer);return F.forEach((function(e){for(var r=le(i.values[e]),n=r.minw,t=r.maxw,a=0;a<u.length;a++)u[a]+=n[a],c[a]+=t[a]})),{filterVec:n,lower:t,upper:o,minw:u,maxw:c}})).filter((function(e){var n=e.maxw;return!B.some((function(e,r){return n[r]<e}))&&!(n[l.length]<r)}));return{cache:!0,optimizationTarget:M,constraints:E,artSetExclusion:T,depth:c,lin:R,filters:C}}}function fe(e){for(var r=(0,a.Z)(e[0].values),n=(0,a.Z)(e[0].values),t=(0,a.Z)(e[0].buffer),o=(0,a.Z)(e[0].buffer),i=1;i<e.length;i++){for(var u=0;u<r.length;u++)r[u]=Math.min(r[u],e[i].values[u]),n[u]=Math.max(n[u],e[i].values[u]);for(var c=0;c<t.length;c++)t[c]=Math.min(t[c],e[i].buffer[c]),o[c]=Math.max(o[c],e[i].buffer[c])}return{lower:r,upper:n,minw:t,maxw:o}}function le(e){for(var r=(0,a.Z)(e[0].buffer),n=(0,a.Z)(e[0].buffer),t=1;t<e.length;t++)for(var o=0;o<r.length;o++)r[o]=Math.min(r[o],e[t].buffer[o]),n[o]=Math.max(n[o],e[t].buffer[o]);return{minw:r,maxw:n}}function de(e){var r=(0,a.Z)(e.base),n=(0,a.Z)(e.base),t=(0,a.Z)(e.baseBuffer),o=(0,a.Z)(e.baseBuffer);return Object.values(e.values).forEach((function(e){for(var a=fe(e),i=0;i<r.length;i++)r[i]+=a.lower[i],n[i]+=a.upper[i];for(var u=0;u<t.length;u++)t[u]+=a.minw[u],o[u]+=a.maxw[u]})),{lower:r,upper:n,minw:t,maxw:o}}var pe,he,ve,me=function(){function e(r,n){var t=this,a=r.arts,i=r.artsVec,u=r.optimizationTarget,c=r.constraints,s=r.plotBase,f=r.maxBuilds;(0,G.Z)(this,e),this.builds=[],this.buildValues=[],this.plotData=void 0,this.plotBase=void 0,this.threshold=-1/0,this.maxBuilds=void 0,this.min=void 0,this.arts=void 0,this.artsVec=void 0,this.nodes=void 0,this.callback=void 0,this.interimReport=function(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t.refresh(r),t.callback((0,o.Z)({command:"interim",buildValues:t.buildValues},e)),t.buildValues=[],e.tested=0,e.failed=0,e.skipped=0},this.arts=a,this.artsVec=i,this.min=c.map((function(e){return e.min})),this.maxBuilds=f,this.callback=n,this.nodes=c.map((function(e){return e.node})),this.nodes.push(u),s&&(this.plotData={},this.plotBase=s,this.nodes.push(s)),this.nodes=function(e,r){var n=A(e,r,arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return!1});return V(n=T(n))}(this.nodes,{},(function(e){return!1}))}return(0,L.Z)(e,[{key:"computeU",value:function(e,r){this.threshold<e&&(this.threshold=e);var n=r.filters,t=r.artSetExclusion,o=this,i=ie(n),c=ue(n),f=c.lower,l=c.upper,d=c.maxw;if(!(d[d.length-1]<this.threshold)){var p=(0,a.Z)(this.nodes),h=(0,a.Z)(this.min);void 0!==this.plotBase&&p.push(this.plotBase);var m=Object.fromEntries(this.artsVec.keys.map((function(e,r){return[e,f[r]]}))),b=Object.fromEntries(this.artsVec.keys.map((function(e,r){return[e,l[r]]})));p=function(e,r,n){var t=Object.keys(r).filter((function(e){return r[e]===n[e]}));return x(e,(function(e){return e}),(function(e){switch(e.operation){case"add":return ae(e.operands);case"mul":return oe(e.operands);case"read":return t.includes(e.path[1])?v(r[e.path[1]]):e;case"threshold":var a=(0,u.Z)(e.operands,4),o=a[0],i=a[1],c=a[2],s=a[3];if("const"===o.operation&&"const"===i.operation)return o.value>=i.value?c:s;if("read"===o.operation&&"const"===i.operation){if(r[o.path[1]]>=i.value)return c;if(n[o.path[1]]<i.value)return s}return e;case"min":case"max":case"res":case"sum_frac":return e.operands.every((function(e){return"const"===e.operation}))?v(O[e.operation](e.operands.map((function(e){return"const"===e.operation?e.value:NaN})))):e;default:return e}}))}(p,m,b);var g=K(p,this.arts);p=g.nodes;for(var w=g.arts,y=n.map((function(e){var r,n,t=(r=w,n=e.filterVec,{base:r.base,values:s(F,(function(e){var t=n[e],a=r.values[e];return t.map((function(e){return a[e]}))}))});return Object.values(t.values).sort((function(e,r){return e.length-r.length}))})),k=j(p,w.base,(function(e){return e.path[1]}),5),Z=Array(5),S={tested:0,failed:0,skipped:0},M=0;M<y.length;M++)Z.fill({id:"",values:{}}),E(M,y[M].length-1,{});return this.interimReport(S),this.threshold}function E(e,r,n){if(r<0){var a=k(Z);if(h.some((function(e,r){return e>a[r]}))||!function(e,r){if(!Object.entries(e).every((function(e){var n=(0,u.Z)(e,2),t=n[0],a=n[1];return!r[t]||!r[t].includes(a)})))return!1;if(!r.uniqueKey)return!0;var n=Object.values(e).reduce((function(e,r){return e+r%2}),0);return!r.uniqueKey.includes(n)}(n,t))return void S.failed++;var i,c=a[h.length],s=o.builds,f=o.buildValues,l=o.plotData;if(c>=o.threshold&&(i={value:c,artifactIds:Z.map((function(e){return e.id}))},s.push(i),f.push(c)),l){var d=a[h.length+1];(!l[d]||l[d].value<c)&&(i||(i={value:c,artifactIds:Z.map((function(e){return e.id}))}),i.plot=d,l[d]=i)}}else y[e][r].forEach((function(t){var a,o,i,u,c,s;Z[r]=t,n[null!==(a=t.set)&&void 0!==a?a:""]=1+(null!==(o=n[null!==(i=t.set)&&void 0!==i?i:""])&&void 0!==o?o:0),E(e,r-1,n),n[null!==(u=t.set)&&void 0!==u?u:""]-=1,0===n[null!==(c=t.set)&&void 0!==c?c:""]&&delete n[null!==(s=t.set)&&void 0!==s?s:""]})),0===r&&(S.tested+=y[e][r].length)}this.interimReport({tested:0,failed:0,skipped:i})}},{key:"refresh",value:function(e){var r,n=this.maxBuilds;Object.keys(null!==(r=this.plotData)&&void 0!==r?r:{}).length>=1e5&&(this.plotData=function(e){for(var r=.01,n=new Set(e.flatMap((function(e){return Object.values(e).map((function(e){return Math.round(e.plot/r)}))})));n.size>1500;)r*=2,n=new Set((0,a.Z)(n).map((function(e){return Math.round(e/2)})));var o,i={},u=(0,t.Z)(e);try{for(u.s();!(o=u.n()).done;)for(var c=o.value,s=0,f=Object.values(c);s<f.length;s++){var l=f[s],d=Math.round(l.plot/r)*r;(!i[d]||i[d].value<l.value)&&(i[d]=l)}}catch(p){u.e(p)}finally{u.f()}return i}([this.plotData])),this.builds=this.builds.sort((function(e,r){return r.value-e.value})).slice(0,n)}}]),e}(),be=function(){function e(r,n){var t,a,o=r.arts,i=r.artsVec,c=r.optimizationTarget,s=r.constraints,f=r.artSetExclusion;(0,G.Z)(this,e),this.min=void 0,this.arts=void 0,this.artsVec=void 0,this.nodes=void 0,this.artSet=void 0,this.subproblems=[],this.splitcounter=0,this.callback=void 0,this.arts=o,this.artsVec=i,this.min=s.map((function(e){return e.min})),this.nodes=s.map((function(e){return e.node})),this.callback=n,this.min.push(-1/0),this.nodes.push(c),this.artSet=(t=Object.entries(f),a=function(e){var r=(0,u.Z)(e,2),n=r[0],t=r[1];return"rainbow"===n?["uniqueKey",t.map((function(e){return e+1}))]:[n,t.flatMap((function(e){return 2===e?[2,3]:[4,5]}))]},Object.fromEntries(t.map((function(e,r){return a(e,r)}))))}return(0,L.Z)(e,[{key:"addSubProblem",value:function(e){var r=ie(e.filters);if(0!==r){var n=Math.max.apply(Math,(0,a.Z)(e.filters.map((function(e){var r=e.maxw;return r[r.length-1]}))));this.subproblems.push({count:r,upperBound:n,subproblem:e})}}},{key:"split",value:function(e){var r=this,n=e.threshold,t=e.minCount,a=e.maxIter,o=e.subproblem;n>this.min[this.min.length-1]&&(this.min[this.min.length-1]=n),o&&this.addSubProblem(o);for(var i=this.subproblems.reduce((function(e,r){return e+r.count}),0),u=0;u<a&&this.subproblems.length;){u+=1;var c=this.subproblems.pop(),s=c.count,f=c.subproblem;if(s<=t){var l=this.subproblems.reduce((function(e,r){return e+r.count}),0)+s;return this.callback({command:"interim",tested:0,failed:0,skipped:i-l,buildValues:void 0}),[f]}this.splitBNB(this.min[this.min.length-1],f).forEach((function(e){return r.addSubProblem(e)}))}var d=this.subproblems.reduce((function(e,r){return e+r.count}),0);return this.callback({command:"interim",tested:0,failed:0,skipped:i-d,buildValues:void 0}),[]}},{key:"popOne",value:function(){if(0!==this.subproblems.length){for(var e={i:-1,heur:-1/0},r=1;r<this.subproblems.length;r++){var n=this.subproblems[r].upperBound;n>e.heur&&(e={i:r,heur:n})}if(!(e.i<0))return this.subproblems.splice(e.i,1)[0].subproblem}}},{key:"splitBNB",value:function(e,r){var n=this;if(r.filters=r.filters.filter((function(r){var n=r.maxw;return n[n.length-1]>e})),0===r.filters.length)return[];var t=[];if(r.filters.length>50){var i=r.filters.sort((function(e,r){return e.maxw[e.maxw.length-1]-r.maxw[r.maxw.length-1]}));t=function(e,r){var n=e.length%r,t=Math.floor(e.length/r),a=0;return Array.from({length:r},(function(r,o){return e.slice(a,a+=t+(o<n?1:0))}))}(i,Math.ceil(i.length/50)).map((function(e){return(0,o.Z)((0,o.Z)({},r),{},{filters:e})}))}else{var u=ie(r.filters),c=function(e,r,n){var t=n.constraints,i=n.filters,u=n.lin;ce(e,u);for(var c=[].concat((0,a.Z)(t.map((function(e){return e.min}))),[r]),f=!1,l=function(r){var n=i[r],t=n.maxw,u=n.filterVec,l=s(F,(function(r){var n=le(u[r].map((function(n){return e.values[r][n]}))),o=n.minw,i=n.maxw,s=[];return t.forEach((function(n,f){var l=c[f]-t[f]+i[f];o[f]>l||s.push.apply(s,(0,a.Z)(u[r].filter((function(n){return e.values[r][n].buffer[f]<l}))))})),new Set(s)}));if(Object.values(l).every((function(e){return 0===e.size})))return"continue";f=!0;var d=s(F,(function(e){return u[e].filter((function(r){return!l[e].has(r)}))}));if(0===F.reduce((function(e,r){return e*d[r].length}),1))return i.splice(r,1),"continue";i[r]=(0,o.Z)({filterVec:d},de(H(e,d)))},d=i.length-1;d>=0;d--)l(d);return f}(this.artsVec,e,r),f=ie(r.filters);if(c&&0===ie(r.filters))return[];t=c&&u-f>.3*u?[r]:this.makeBranches(e,r)}var l=[];return t.forEach((function(r){var t=ie(r.filters);if(0!==t){var o=se(n.artsVec,e,r);if(void 0!==o){o.depth+=1;var i=Math.max.apply(Math,(0,a.Z)(o.filters.map((function(e){var r=e.maxw;return r[r.length-1]})))),u=o.lin;l.push({numBuilds:t,heur:i-u[u.length-1].err,subproblem:o})}}})),l.sort((function(e,r){return r.numBuilds-e.numBuilds})),l.map((function(e){return e.subproblem}))}},{key:"makeBranches",value:function(e,r){var n=this,t=r.constraints,i=r.lin,c=r.artSetExclusion,f=r.filters,l=ue(f),d=l.minw,p=l.maxw,v=l.lower,m=l.upper;this.splitcounter+=1;var b={flower:{kind:"id",ids:new Set},plume:{kind:"id",ids:new Set},sands:{kind:"id",ids:new Set},goblet:{kind:"id",ids:new Set},circlet:{kind:"id",ids:new Set}};f.forEach((function(e){F.forEach((function(r){var t=b[r].ids;e.filterVec[r].forEach((function(e){return t.add(n.arts.values[r][e].id)}))}))}));for(var g,w=function(e,r){return{keys:e.keys,base:e.base,baseBuffer:e.baseBuffer,values:s(F,(function(n){var t=r[n];switch(t.kind){case"id":return e.values[n].filter((function(e){return t.ids.has(e.id)}));case"exclude":return e.values[n].filter((function(e){return!t.sets.has(e.set)}));case"required":return e.values[n].filter((function(e){return t.sets.has(e.set)}))}}))}}(this.artsVec,b),y=[].concat((0,a.Z)(t.map((function(e){return e.min}))),[e]).map((function(e,r){return(e-d[r])/(p[r]-d[r])})),k=-1,Z=y.length-1;Z>=0;Z--)0!==Object.keys(i[Z].w).length&&(k<0&&(k=Z),y[k]<.5||y[Z]>y[k]&&(k=Z));if(k<0){var x=D.filter((function(e){return m[e]>0})),S={k:void 0,cnt:-1};x.forEach((function(e){var r=m[e];c[e]&&c[e].includes(r)&&(r=Math.min.apply(Math,(0,a.Z)(c[e]))-1),r>S.cnt&&(S={k:e,cnt:r})}));var M=this.artsVec.keys.indexOf(S.k);ce(this.artsVec,i),g=ge(M,this.artsVec,f,i)}else{var E=i[k],O=Object.keys(E.w),B={k:"",heur:-1};if(O.forEach((function(e){var r=n.artsVec.keys.indexOf(e),t=Object.entries(w.values).reduce((function(e,n){var t=(0,u.Z)(n,2),o=(t[0],t[1].map((function(e){return e.values[r]}))),i=Math.min.apply(Math,(0,a.Z)(o)),c=Math.max.apply(Math,(0,a.Z)(o));if(i===c)return e;var s=(i+c)/2,f=Math.max.apply(Math,(0,a.Z)(o.filter((function(e){return e<=s})))),l=Math.min.apply(Math,(0,a.Z)(o.filter((function(e){return e>s}))));return e+Math.min(c-f,l-i)}),0),o=E.w[e]*t*(D.includes(e)?5:1);o>B.heur&&(B={k:e,heur:o})})),""===B.k)throw console.log("===================== SHATTER BROKE ====================",i,w),Error("Shatter broke...");var j=this.artsVec.keys.indexOf(B.k),T=(v[j]+m[j])/2;ce(this.artsVec,i),g=D.includes(B.k)?ge(j,this.artsVec,f,i):function(e,r,n,t,i){var c=[],f=[];return t.forEach((function(t){var i=t.filterVec,l=function(e,r,n,t){var o=t.filterVec,i=5;n-=e.base[r];for(var c=F.map((function(n){return o[n].map((function(t){return{ix:t,v:e.values[n][t].values[r]}})).sort((function(e,r){return e.v-r.v}))})).map((function(e){return e.map((function(e){return{ixs:[e.ix],v:e.v}}))})),f=0;f<c.length;f+=1)for(var l=c[f],d=l.length-1;d>0;d-=1){var p;if(l[d].v===l[d-1].v)(p=l[d-1].ixs).push.apply(p,(0,a.Z)(l[d].ixs)),l.splice(d,1)}var h=c.map((function(e){return e[0].v})),v=c.map((function(e){return e[e.length-1].v-e[0].v}));v.every((function(e){return 0===e}))&&v.fill(1);var m=(n-h.reduce((function(e,r){return e+r})))/v.reduce((function(e,r){return e+r})),b=[];function g(e){for(var r=0,t=0,a=0;a<i;a++){var o,u,s,f,l=e[a];r+=null!==(o=null===(u=c[a][l-1])||void 0===u?void 0:u.v)&&void 0!==o?o:-1/0,t+=null!==(s=null===(f=c[a][l])||void 0===f?void 0:f.v)&&void 0!==s?s:1/0}return r-n<=1e-6&&n-t<=1e-6}function w(e){return e.reduce((function(e,r){return e*r}),1)+e.reduce((function(e,r,n){return e*(c[n].length-r)}),1)}if(c.forEach((function(e,r){for(var n=-1,t=0;t<e.length;t++)if(e[t].v>=h[r]+m*v[r]){n=t;break}n<0&&(n=e.length),b.push(n)})),!g(b))throw console.log("feas",b,g(b),w(b)),console.log({x0:h,v:v,coeff:m,targ:n}),console.log(c),Error("hmmm feas not working");var y=[[0,1],[0,-1],[1,1],[1,-1],[2,1],[2,-1],[3,1],[3,-1],[4,1],[4,-1]],k=[[0,1,-1,-1],[0,1,-1,1],[0,1,1,-1],[0,1,1,1],[0,2,-1,-1],[0,2,-1,1],[0,2,1,-1],[0,2,1,1],[0,3,-1,-1],[0,3,-1,1],[0,3,1,-1],[0,3,1,1],[0,4,-1,-1],[0,4,-1,1],[0,4,1,-1],[0,4,1,1],[1,2,-1,-1],[1,2,-1,1],[1,2,1,-1],[1,2,1,1],[1,3,-1,-1],[1,3,-1,1],[1,3,1,-1],[1,3,1,1],[1,4,-1,-1],[1,4,-1,1],[1,4,1,-1],[1,4,1,1],[2,3,-1,-1],[2,3,-1,1],[2,3,1,-1],[2,3,1,1],[2,4,-1,-1],[2,4,-1,1],[2,4,1,-1],[2,4,1,1],[3,4,-1,-1],[3,4,-1,1],[3,4,1,-1],[3,4,1,1]],Z=function(){var e={score:w(b)};if(y.forEach((function(r){var n=(0,u.Z)(r,2),t=n[0],o=n[1],i=(0,a.Z)(b);if(i[t]+=o,!(i[t]<0||i[t]>=c[t].length)&&g(i)){var s=i.reduce((function(e,r){return e*r}),1)+i.reduce((function(e,r,n){return e*(c[n].length-r)}),1);s>e.score&&(e={score:s,next:i})}})),k.forEach((function(r){var n=(0,u.Z)(r,4),t=n[0],o=n[1],i=n[2],s=n[3],f=(0,a.Z)(b);if(f[t]+=i,f[o]+=s,!(f[t]<0||f[t]>=c[t].length)&&!(f[o]<0||f[o]>=c[o].length)&&g(f)){var l=f.reduce((function(e,r){return e*r}),1)+f.reduce((function(e,r,n){return e*(c[n].length-r)}),1);l>e.score&&(e={score:l,next:f})}})),void 0===e.next)return"break";b=e.next};for(;;){if("break"===Z())break}return s(F,(function(e,r){return[c[r].slice(0,b[r]).flatMap((function(e){return e.ixs})),c[r].slice(b[r]).flatMap((function(e){return e.ixs}))]}))}(n,e,r,t),d=s(F,(function(e){return l[e].filter((function(e){return e.length>0})).map((function(r){var t=i[e].map((function(r){return n.values[e][r]}));return(0,o.Z)({slotArts:t,ixs:r},fe(t))}))}));h(d.flower,d.plume,d.sands,d.goblet,d.circlet).forEach((function(t){var a=(0,u.Z)(t,5),o=a[0],i=a[1],s=a[2],l=a[3],d=a[4],p=o.lower.map((function(e,r){return t.reduce((function(e,n){return e+n.lower[r]}),n.base[r])})),h=o.upper.map((function(e,r){return t.reduce((function(e,n){return e+n.upper[r]}),n.base[r])})),v=o.maxw.map((function(e,r){return t.reduce((function(e,n){return e+n.maxw[r]}),n.baseBuffer[r])})),m=o.minw.map((function(e,r){return t.reduce((function(e,n){return e+n.minw[r]}),n.baseBuffer[r])})),b={filterVec:{flower:o.ixs,plume:i.ixs,sands:s.ixs,goblet:l.ixs,circlet:d.ixs},lower:p,upper:h,minw:m,maxw:v};h[e]-r>r-p[e]?c.push(b):f.push(b)}))})),[c,f]}(j,T,this.artsVec,f)}return g.map((function(e){return(0,o.Z)((0,o.Z)({},r),{},{filters:e,cache:!0})}))}}]),e}();function ge(e,r,n,t){function a(e,n,t){var a=t.map((function(n){return r.values[e][n]}));return(0,o.Z)((0,o.Z)({set:n},fe(a)),{},{ixs:t})}var i=[],c=[],f=[];return n.forEach((function(n){var t=n.filterVec,o=s(F,(function(n){var o=r.values[n],i=t[n].filter((function(r){return 0===o[r].values[e]})),u=t[n].filter((function(r){return 1===o[r].values[e]})),c=[];return i.length>0&&c.push(a(n,0,i)),u.length>0&&c.push(a(n,1,u)),c}));h(o.flower,o.plume,o.sands,o.goblet,o.circlet).forEach((function(e){var n=(0,u.Z)(e,5),t=n[0],a=n[1],o=n[2],s=n[3],l=n[4],d=t.lower.map((function(n,t){return e.reduce((function(e,r){return e+r.lower[t]}),r.base[t])})),p=t.upper.map((function(n,t){return e.reduce((function(e,r){return e+r.upper[t]}),r.base[t])})),h=t.maxw.map((function(n,t){return e.reduce((function(e,r){return e+r.maxw[t]}),r.baseBuffer[t])})),v=t.minw.map((function(n,t){return e.reduce((function(e,r){return e+r.minw[t]}),r.baseBuffer[t])})),m={filterVec:{flower:t.ixs,plume:a.ixs,sands:o.ixs,goblet:s.ixs,circlet:l.ixs},lower:d,upper:p,minw:v,maxw:h};switch(e.reduce((function(e,r){return e+r.set}),0)){case 0:case 1:i.push(m);break;case 2:case 3:c.push(m);break;case 4:case 5:f.push(m);break;default:throw Error("Unreachable")}}))})),[i,c,f]}onmessage=function(e){var r,n=e.data,i=n.command;switch(i){case"setup":pe=n.id;var u="split".concat(pe),c="compute".concat(pe);he=new be(n,(function(e){return postMessage((0,o.Z)({id:pe,source:u},e))})),ve=new me(n,(function(e){return postMessage((0,o.Z)({id:pe,source:c},e))})),r={command:"iterate"};break;case"split":r={command:"split",subproblems:he.split(n),ready:0===he.subproblems.length};break;case"iterate":var f=n.threshold,l=n.subproblem;ve.computeU(f,l),r={command:"iterate"};break;case"finalize":ve.refresh(!0);var d=ve,h=d.builds,v=d.plotData;r={command:"finalize",builds:h,plotData:v};break;case"count":if("break"===function(){var e,o=n.exclusion,i=ve.arts,u=I(z(o,(0,a.Z)(new Set(Object.values(i.values).flatMap((function(e){return e.map((function(e){return e.set}))}))))),i),c=n.arts.map((function(e){return 0})),f=(0,t.Z)(u);try{var l=function(){var r=e.value;n.arts.forEach((function(e,n){return c[n]+=function(e){return F.reduce((function(r,n){return r*e.values[n].length}),1)}(function(e,r){return{base:e.base,values:s(F,(function(n){var t=r[n];switch(t.kind){case"id":return e.values[n].filter((function(e){return t.ids.has(e.id)}));case"exclude":return e.values[n].filter((function(e){return!t.sets.has(e.set)}));case"required":return e.values[n].filter((function(e){return t.sets.has(e.set)}))}}))}}(e,r))}))};for(f.s();!(e=f.n()).done;)l()}catch(d){f.e(d)}finally{f.f()}return r={command:"count",counts:c},"break"}())break;case"share":var m=he.popOne();r={command:"share",subproblem:m,sender:n.sender};break;default:p(i)}postMessage((0,o.Z)({id:pe},r))}}},r={};function n(t){var a=r[t];if(void 0!==a)return a.exports;var o=r[t]={exports:{}};return e[t](o,o.exports,n),o.exports}n.m=e,n.x=function(){var e=n.O(void 0,[221],(function(){return n(67023)}));return e=n.O(e)},function(){var e=[];n.O=function(r,t,a,o){if(!t){var i=1/0;for(f=0;f<e.length;f++){t=e[f][0],a=e[f][1],o=e[f][2];for(var u=!0,c=0;c<t.length;c++)(!1&o||i>=o)&&Object.keys(n.O).every((function(e){return n.O[e](t[c])}))?t.splice(c--,1):(u=!1,o<i&&(i=o));if(u){e.splice(f--,1);var s=a();void 0!==s&&(r=s)}}return r}o=o||0;for(var f=e.length;f>0&&e[f-1][2]>o;f--)e[f]=e[f-1];e[f]=[t,a,o]}}(),n.d=function(e,r){for(var t in r)n.o(r,t)&&!n.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})},n.f={},n.e=function(e){return Promise.all(Object.keys(n.f).reduce((function(r,t){return n.f[t](e,r),r}),[]))},n.u=function(e){return"static/js/"+e+".45b11d4b.chunk.js"},n.miniCssF=function(e){},n.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},n.p="/genshin-optimizer/",function(){var e={204:1};n.f.i=function(r,t){e[r]||importScripts(n.p+n.u(r))};var r=self.webpackChunkgenshin_optimizer=self.webpackChunkgenshin_optimizer||[],t=r.push.bind(r);r.push=function(r){var a=r[0],o=r[1],i=r[2];for(var u in o)n.o(o,u)&&(n.m[u]=o[u]);for(i&&i(n);a.length;)e[a.pop()]=1;t(r)}}(),function(){var e=n.x;n.x=function(){return n.e(221).then(e)}}();n.x()}();
//# sourceMappingURL=204.6f0dc135.chunk.js.map