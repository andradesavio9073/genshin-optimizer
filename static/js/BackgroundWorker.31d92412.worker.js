/*! For license information please see BackgroundWorker.31d92412.worker.js.LICENSE.txt */
!function(){"use strict";function e(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function r(r,t){if(r){if("string"===typeof r)return e(r,t);var n=Object.prototype.toString.call(r).slice(8,-1);return"Object"===n&&r.constructor&&(n=r.constructor.name),"Map"===n||"Set"===n?Array.from(r):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?e(r,t):void 0}}function t(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=r(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var a=0,o=function(){};return{s:o,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return u=e.done,e},e:function(e){c=!0,i=e},f:function(){try{u||null==n.return||n.return()}finally{if(c)throw i}}}}function n(t){return function(r){if(Array.isArray(r))return e(r)}(t)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||r(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function o(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function i(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?o(Object(t),!0).forEach((function(r){a(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function c(){c=function(){return e};var e={},r=Object.prototype,t=r.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",i=n.toStringTag||"@@toStringTag";function s(e,r,t){return Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}),e[r]}try{s({},"")}catch(B){s=function(e,r,t){return e[r]=t}}function f(e,r,t,n){var a=r&&r.prototype instanceof h?r:h,o=Object.create(a.prototype),i=new O(n||[]);return o._invoke=function(e,r,t){var n="suspendedStart";return function(a,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===a)throw o;return j()}for(t.method=a,t.arg=o;;){var i=t.delegate;if(i){var u=x(i,t);if(u){if(u===p)continue;return u}}if("next"===t.method)t.sent=t._sent=t.arg;else if("throw"===t.method){if("suspendedStart"===n)throw n="completed",t.arg;t.dispatchException(t.arg)}else"return"===t.method&&t.abrupt("return",t.arg);n="executing";var c=l(e,r,t);if("normal"===c.type){if(n=t.done?"completed":"suspendedYield",c.arg===p)continue;return{value:c.arg,done:t.done}}"throw"===c.type&&(n="completed",t.method="throw",t.arg=c.arg)}}}(e,t,i),o}function l(e,r,t){try{return{type:"normal",arg:e.call(r,t)}}catch(B){return{type:"throw",arg:B}}}e.wrap=f;var p={};function h(){}function d(){}function v(){}var m={};s(m,a,(function(){return this}));var b=Object.getPrototypeOf,w=b&&b(b(M([])));w&&w!==r&&t.call(w,a)&&(m=w);var g=v.prototype=h.prototype=Object.create(m);function y(e){["next","throw","return"].forEach((function(r){s(e,r,(function(e){return this._invoke(r,e)}))}))}function k(e,r){function n(a,o,i,c){var s=l(e[a],e,o);if("throw"!==s.type){var f=s.arg,p=f.value;return p&&"object"==u(p)&&t.call(p,"__await")?r.resolve(p.__await).then((function(e){n("next",e,i,c)}),(function(e){n("throw",e,i,c)})):r.resolve(p).then((function(e){f.value=e,i(f)}),(function(e){return n("throw",e,i,c)}))}c(s.arg)}var a;this._invoke=function(e,t){function o(){return new r((function(r,a){n(e,t,r,a)}))}return a=a?a.then(o,o):o()}}function x(e,r){var t=e.iterator[r.method];if(void 0===t){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=void 0,x(e,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var n=l(t,e.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,p;var a=n.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function E(e){var r={tryLoc:e[0]};1 in e&&(r.catchLoc=e[1]),2 in e&&(r.finallyLoc=e[2],r.afterLoc=e[3]),this.tryEntries.push(r)}function S(e){var r=e.completion||{};r.type="normal",delete r.arg,e.completion=r}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function M(e){if(e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function r(){for(;++n<e.length;)if(t.call(e,n))return r.value=e[n],r.done=!1,r;return r.value=void 0,r.done=!0,r};return o.next=o}}return{next:j}}function j(){return{value:void 0,done:!0}}return d.prototype=v,s(g,"constructor",v),s(v,"constructor",d),d.displayName=s(v,i,"GeneratorFunction"),e.isGeneratorFunction=function(e){var r="function"==typeof e&&e.constructor;return!!r&&(r===d||"GeneratorFunction"===(r.displayName||r.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,s(e,i,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},y(k.prototype),s(k.prototype,o,(function(){return this})),e.AsyncIterator=k,e.async=function(r,t,n,a,o){void 0===o&&(o=Promise);var i=new k(f(r,t,n,a),o);return e.isGeneratorFunction(t)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},y(g),s(g,i,"Generator"),s(g,a,(function(){return this})),s(g,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var r=[];for(var t in e)r.push(t);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=M,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!e)for(var r in this)"t"===r.charAt(0)&&t.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(t,n){return i.type="throw",i.arg=e,r.next=t,n&&(r.method="next",r.arg=void 0),!!n}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],i=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var u=t.call(o,"catchLoc"),c=t.call(o,"finallyLoc");if(u&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,r){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&t.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=r&&r<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=r,o?(this.method="next",this.next=o.finallyLoc,p):this.complete(i)},complete:function(e,r){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&r&&(this.next=r),p},finish:function(e){for(var r=this.tryEntries.length-1;r>=0;--r){var t=this.tryEntries[r];if(t.finallyLoc===e)return this.complete(t.completion,t.afterLoc),S(t),p}},catch:function(e){for(var r=this.tryEntries.length-1;r>=0;--r){var t=this.tryEntries[r];if(t.tryLoc===e){var n=t.completion;if("throw"===n.type){var a=n.arg;S(t)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,t){return this.delegate={iterator:M(e),resultName:r,nextLoc:t},"next"===this.method&&(this.arg=void 0),p}},e}function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,r){var t=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var n,a,o=[],i=!0,u=!1;try{for(t=t.call(e);!(i=(n=t.next()).done)&&(o.push(n.value),!r||o.length!==r);i=!0);}catch(c){u=!0,a=c}finally{try{i||null==t.return||t.return()}finally{if(u)throw a}}return o}}(e,t)||r(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,r){if(e&&r)return!Array.isArray(r)&&console.error(r),r.reduce((function(e,r){return null===e||void 0===e?void 0:e[r]}),e)}function l(e,r){return Object.fromEntries(e.map((function(e,t){return[e,r(e,t)]})))}function p(e,r){return Object.fromEntries(Object.entries(e).map((function(e,t){var n=s(e,2),a=n[0],o=n[1];return[a,r(o,a,t)]})))}var h=c().mark((function e(r,t){var n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=r;case 1:if(!(n<=t)){e.next=7;break}return e.next=4,n;case 4:n++,e.next=1;break;case 7:case"end":return e.stop()}}),e)}));function d(e,r){return n(h(e,r))}function v(e){throw new Error("Should not reach this with value ".concat(e))}function m(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];return r.reduce((function(e,r){return e.flatMap((function(e){return r.map((function(r){return[e,[r]].flat()}))}))}),[[]])}b(NaN,{key:"TODO"}),w(1),w(0),b("none");function b(e,r){return{operation:"const",operands:[],value:e,info:r}}function w(e,r){return e>=Number.MAX_VALUE/100&&(e=1/0),e<=-Number.MAX_VALUE/100&&(e=-1/0),b(e,i({key:"_"},r))}function g(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];return{operation:"add",operands:x(r)}}function y(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];return{operation:"mul",operands:x(r)}}function k(e,r){return{operation:"read",operands:[],path:e,info:r,type:"number"}}function x(e){return e.map((function(e){return"object"===typeof e?e:b(e)}))}function E(e){return"object"!==typeof e?b(e):e}function S(e,r,t){var n=new Set,a=new Set;e.forEach((function e(o){a.has(o)||(n.has(o)?console.error("Found cyclical dependency during formula traversal"):(n.add(o),r(o),o.operands.forEach(e),t(o),n.delete(o),a.add(o)))}))}function O(e,r,t){var n=new Set,a=new Map,o=new Map;function u(e){var c=a.get(e);if(c)return c;c=r(e);var s=o.get(c);return s||(n.has(c)?(console.error("Found cyclical dependency during formula mapping"),b(NaN)):(n.add(c),s=t(function(e){var r=e.operands.map(u);return M(r,e.operands)?e:i(i({},e),{},{operands:r})}(c),e),n.delete(c),a.set(e,s),o.set(c,s),s))}var c=e.map(u);return M(c,e)?e:c}function M(e,r){return void 0===e?void 0===r:void 0!==r&&(e.length===r.length&&e.every((function(e,t){return e===r[t]})))}var j={min:function(e){return Math.min.apply(Math,n(e))},max:function(e){return Math.max.apply(Math,n(e))},add:function(e){return e.reduce((function(e,r){return e+r}),0)},mul:function(e){return e.reduce((function(e,r){return e*r}),1)}},B=i(i({},j),{},{res:function(e){var r=s(e,1)[0];return r<0?1-r/2:r>=.75?1/(4*r+1):1-r},sum_frac:function(e){return e[0]/e.reduce((function(e,r){return e+r}))},threshold:function(e){var r=s(e,4),t=r[0],n=r[1],a=r[2],o=r[3];return t>=n?a:o}}),A=new Set(Object.keys(j));function P(e,r){var t=new Set,a=new Set,o=new Map;S(e,(function(e){}),(function(e){var n=e.operation;switch(n){case"read":if("number"!==e.type||e.accu&&"add"!==e.accu)throw new Error("Unsupported ".concat(n," node in precompute"));var i=r(e);t.add(i),o.set(e,i);break;case"add":case"min":case"max":case"mul":case"threshold":case"res":case"sum_frac":o.set(e,{ins:e.operands.map((function(e){return o.get(e)}))});break;case"const":if("number"!==typeof e.value)throw new Error("Found string constant while precomputing");var u=e.value;a.add(u),o.set(e,u);break;case"match":case"lookup":case"subscript":case"prio":case"small":case"data":throw new Error("Unsupported ".concat(n," node in precompute"));default:v(n)}}));var i=new Map,u=n(t),c=e.length,f=n(a),p=[];e.forEach((function(e,r){i.set(e,r),"const"===e.operation&&i.set(e.value,r)})),u.forEach((function(r,t){return i.set(r,t+e.length)}));var h=e.length+u.length;f.forEach((function(e){return i.has(e)||i.set(e,h++)})),o.forEach((function(e,r){"object"===typeof e?(i.has(r)||i.set(r,h++),p.push({out:i.get(r),ins:r.operands.map((function(e){return i.get(e)})),op:B[r.operation],buff:Array(r.operands.length).fill(0)})):i.set(r,i.get(e))}));var d=new Float64Array(h).fill(0);a.forEach((function(e){return d[i.get(e)]=e}));var m=e.map((function(e,r){var t=i.get(e);return t!==r?[t,r]:void 0})).filter((function(e){return e})),b=m.length?function(){m.forEach((function(e){var r=s(e,2),t=r[0],n=r[1];return d[n]=d[t]}))}:void 0;return[function(){return p.forEach((function(e){var r=e.out,t=e.ins,n=e.op,a=e.buff;t.forEach((function(e,r){return a[r]=d[e]})),d[r]=n(a)})),null===b||void 0===b||b(),d},l(u,(function(e,r){return c+r})),d]}function T(e){return O(e,(function(e){return e}),(function(e){var r=e;if(A.has(e.operation)){var t=e,n=t.operation,a=!1,o=t.operands.flatMap((function(e){return e.operation===n?(a=!0,e.operands):[e]}));r=a?i(i({},t),{},{operands:o}):t}return r}))}function V(e){function r(e){var r,n=new Map,a=t(e);try{for(a.s();!(r=a.n()).done;){var o,i=r.value;n.set(i,(null!==(o=n.get(i))&&void 0!==o?o:0)+1)}}catch(u){a.e(u)}finally{a.f()}return n}for(var a={common:{counts:new Map,formulas:new Set,operation:"add"}},o=function(){for(var o,u=void 0,c={operation:a.common.operation,operands:(o=a.common.counts,n(o).flatMap((function(e){var r=s(e,2),t=r[0],n=r[1];return Array(n).fill(t)})))},f=new Map,l=0,p=Object.keys(j);l<p.length;l++){var h=p[l];f.set(h,[])}if(e=O(e,(function(e){if(a.common.formulas.has(e)){var r=e,t=new Map(a.common.counts),n=r.operands.filter((function(e){var r=t.get(e);return!r||(t.set(e,r-1),!1)}));return n.length?(n.push(c),i(i({},r),{},{operands:n})):c}return e}),(function(e){if(!A.has(e.operation))return e;var n=e;if(u){if(u.operation===n.operation){var a,o=r(n.operands),i=new Map,c=u.counts,l=0,p=t(o.entries());try{for(p.s();!(a=p.n()).done;){var h,d=s(a.value,2),v=d[0],m=d[1],b=Math.min(m,null!==(h=c.get(v))&&void 0!==h?h:0);b?(i.set(v,b),l+=b):i.delete(v)}}catch(N){p.e(N)}finally{p.f()}l>1&&(u.counts=i,u.formulas.add(n))}}else{var w,g=f.get(n.operation),y=r(n.operands),k=t(g);try{for(k.s();!(w=k.n()).done;){var x,E=s(w.value,2),S=E[0],O=E[1],M=0,j=new Map,B=t(O.entries());try{for(B.s();!(x=B.n()).done;){var P,T=s(x.value,2),V=T[0],L=T[1],F=Math.min(L,null!==(P=y.get(V))&&void 0!==P?P:0);F&&(j.set(V,F),M+=F)}}catch(N){B.e(N)}finally{B.f()}if(M>1){u={counts:j,formulas:new Set([n,S]),operation:n.operation},f.clear();break}}}catch(N){k.e(N)}finally{k.f()}u||g.push([n,y])}return n})),!u)return"break";a.common=u};;){if("break"===o())break}return e}function L(e,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return!1},o={data:[],processed:new Map},u=new Map([[o,new Map]]);function c(e,r){var l,p=r.processed.get(e);if(p)return p;var h,d=e.operation;switch(d){case"const":return e;case"add":case"mul":case"max":case"min":var m=B[d],w=[],g=e.operands.filter((function(e){var t=c(e,r);return"const"!==t.operation||(w.push(t.value),!1)})).map((function(e){return c(e,r)})),y=m(w);if(isFinite(y)){if("mul"===d&&0===y){h=b(y);break}}else if("mul"!==d&&("max"!==d||y>0)&&("min"!==d||y<0)){h=b(y);break}y!==m([])&&g.push(b(y)),h=g.length<=1?null!==(l=g[0])&&void 0!==l?l:b(m([])):{operation:d,operands:g};break;case"res":case"sum_frac":var k=e.operands.map((function(e){return c(e,r)})),x=B[d];h=k.every((function(e){return"const"===e.operation}))?b(x(k.map((function(e){return e.value})))):i(i({},e),{},{operands:k});break;case"lookup":var E=c(e.operands[0],r);if("const"===E.operation){var S,O=null!==(S=e.table[E.value])&&void 0!==S?S:e.operands[1];if(O){h=c(O,r);break}}throw new Error("Unsupported ".concat(d," node while folding"));case"prio":var M=e.operands.find((function(e){var t=c(e,r);if("const"!==t.operation)throw new Error("Unsupported ".concat(d," node while folding"));return void 0!==t.value}));h=M?c(M,r):b(void 0);break;case"small":var j,A,P=void 0,T=t(e.operands);try{for(T.s();!(A=T.n()).done;){var V,L=c(A.value,r);if("const"!==L.operation)throw new Error("Unsupported ".concat(d," node while folding"));(void 0===(null===(V=P)||void 0===V?void 0:V.value)||void 0!==L.value&&L.value<P.value)&&(P=L)}}catch(J){T.e(J)}finally{T.f()}h=null!==(j=P)&&void 0!==j?j:b(void 0);break;case"match":var F=s(e.operands.map((function(e){return c(e,r)})),4),N=F[0],D=F[1],I=F[2],_=F[3];if("const"!==N.operation||"const"!==D.operation)throw new Error("Unsupported ".concat(d," node while folding"));h=N.value===D.value?I:_;break;case"threshold":var R=s(e.operands.map((function(e){return c(e,r)})),4),G=R[0],H=R[1],W=R[2],C=R[3];h="const"===G.operation&&"const"===H.operation?G.value>=H.value?W:C:i(i({},e),{},{operands:[G,H,W,C]});break;case"subscript":var U=s(e.operands.map((function(e){return c(e,r)})),1)[0];h="const"===U.operation?b(e.list[U.value]):i(i({},e),{},{operands:[U]});break;case"read":var q=r.data.map((function(r){return f(r,e.path)})).filter((function(e){return e}));if(0===q.length)if(a(e)){var z=e.accu;h=void 0===z||"small"===z?"string"===e.type?b(void 0):b(NaN):b(B[z]([]))}else h=e;else h=void 0===e.accu||1===q.length?c(q[q.length-1],r):c({operation:e.accu,operands:q},r);break;case"data":e.reset&&(r=o);var K=u.get(r),Y=K.get(e.data);Y||(Y={data:[].concat(n(r.data),[e.data]),processed:new Map},u.set(Y,new Map),K.set(e.data,Y)),h=c(e.operands[0],Y);break;default:v(d)}return r.processed.set(e,h),h}var l={data:[r],processed:new Map};return u.set(l,new Map),u.get(o).set(r,l),e.map((function(e){return c(e,l)}))}var F=["flower","plume","sands","goblet","circlet"],N=(["physical"].concat(["anemo","geo","electro","hydro","pyro","cryo"]),["Adventurer","ArchaicPetra","Berserker","BlizzardStrayer","BloodstainedChivalry","BraveHeart","CrimsonWitchOfFlames","DefendersWill","EchoesOfAnOffering","EmblemOfSeveredFate","Gambler","GladiatorsFinale","HeartOfDepth","HuskOfOpulentDreams","Instructor","Lavawalker","LuckyDog","MaidenBeloved","MartialArtist","NoblesseOblige","OceanHuedClam","PaleFlame","PrayersForDestiny","PrayersForIllumination","PrayersForWisdom","PrayersToSpringtime","ResolutionOfSojourner","RetracingBolide","Scholar","ShimenawasReminiscence","TenacityOfTheMillelith","TheExile","ThunderingFury","Thundersoother","TinyMiracle","TravelingDoctor","VermillionHereafter","ViridescentVenerer","WanderersTroupe"]),D=([].concat(["AmenomaKageuchi","AquilaFavonia","BlackcliffLongsword","CinnabarSpindle","CoolSteel","KagotsurubeIsshin","DarkIronSword","DullBlade","FavoniusSword","FesteringDesire","FilletBlade","FreedomSworn","HaranGeppakuFutsu","HarbingerOfDawn","IronSting","LionsRoar","MistsplitterReforged","PrimordialJadeCutter","PrototypeRancour","RoyalLongsword","SacrificialSword","SilverSword","SkyriderSword","SkywardBlade","SummitShaper","SwordOfDescension","TheAlleyFlash","TheBlackSword","TheFlute","TravelersHandySword"],["Akuoumaru","BlackcliffSlasher","BloodtaintedGreatsword","DebateClub","FavoniusGreatsword","FerrousShadow","KatsuragikiriNagamasa","LithicBlade","LuxuriousSeaLord","OldMercsPal","PrototypeArchaic","Rainslasher","RedhornStonethresher","RoyalGreatsword","SacrificialGreatsword","SerpentSpine","SkyriderGreatsword","SkywardPride","SnowTombedStarsilver","SongOfBrokenPines","TheBell","TheUnforged","WasterGreatsword","Whiteblind","WhiteIronGreatsword","WolfsGravestone"],["BeginnersProtector","BlackcliffPole","BlackTassel","CalamityQueller","CrescentPike","Deathmatch","DragonsBane","DragonspineSpear","EngulfingLightning","FavoniusLance","Halberd","IronPoint","KitainCrossSpear","LithicSpear","PrimordialJadeWingedSpear","PrototypeStarglitter","RoyalSpear","SkywardSpine","StaffOfHoma","TheCatch","VortexVanquisher","WavebreakersFin","WhiteTassel"],["AlleyHunter","AmosBow","AquaSimulacra","BlackcliffWarbow","CompoundBow","ElegyForTheEnd","FadingTwilight","FavoniusWarbow","Hamayumi","HuntersBow","Messenger","MitternachtsWaltz","MouunsMoon","PolarStar","Predator","PrototypeCrescent","RavenBow","RecurveBow","RoyalBow","Rust","SacrificialBow","SeasonedHuntersBow","SharpshootersOath","SkywardHarp","Slingshot","TheStringless","TheViridescentHunt","ThunderingPulse","WindblumeOde"],["ApprenticesNotes","BlackcliffAgate","DodocoTales","EmeraldOrb","EverlastingMoonglow","EyeOfPerception","FavoniusCodex","Frostbearer","HakushinRing","KagurasVerity","LostPrayerToTheSacredWinds","MagicGuide","MappaMare","MemoryOfDust","OathswornEye","OtherworldlyStory","PocketGrimoire","PrototypeAmber","RoyalGrimoire","SacrificialFragments","SkywardAtlas","SolarPearl","TheWidsith","ThrillingTalesOfDragonSlayers","TwinNephrite","WineAndSong"]),c().mark(G)),I=c().mark(W);function _(e,r){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=new Set,u=new Set;function c(e,r){r?o.add(e):e.operands.forEach((function(e){var r=e;o.has(r)&&u.add(r)}))}var f=new Set;if(S(e,(function(e){}),(function(e){var r=e.operation;switch(r){case"read":if("number"!==e.type||"dyn"!==e.path[0]||"add"!==e.accu)throw new Error("Found unsupported ".concat(r," node at path ").concat(e.path," when computing affine nodes"));f.add(e.path[1]),c(e,!0);break;case"add":c(e,e.operands.every((function(e){return o.has(e)})));break;case"mul":var t=e.operands.filter((function(e){return"const"!==e.operation}));c(e,0===t.length||1===t.length&&o.has(t[0]));break;case"const":if("string"===typeof e.value||void 0===e.value)throw new Error("Found constant ".concat(e.value," while compacting"));c(e,!0);break;case"res":case"threshold":case"sum_frac":case"max":case"min":c(e,!1);break;case"data":case"subscript":case"lookup":case"match":case"prio":case"small":throw new Error("Found unsupported ".concat(r," node when computing affine nodes"));default:v(r)}})),n(u).every((function(e){var r=e.operation;return"read"===r||"const"===r}))&&Object.keys(r.base).length===f.size)return{nodes:e,arts:r};var h=-1;function d(){for(;f.has("".concat(++h)););return"".concat(h)}e.forEach((function(e){return o.has(e)&&u.add(e)}));var m=n(u).filter((function(e){return"const"!==e.operation})),w=new Map(m.map((function(e){return[e,a||"read"!==e.operation||"dyn"!==e.path[0]?i(i({},k(["dyn","".concat(d())])),{},{accu:"add"}):e]})));function g(e){var r=L(n(w.keys()),{dyn:p(e,(function(e){return b(e)}))},(function(e){return!0}));return Object.fromEntries(n(w.values()).map((function(e,t){return[e.path[1],r[t].value]})))}for(var y={nodes:e=O(e,(function(e){var r;return null!==(r=w.get(e))&&void 0!==r?r:e}),(function(e){return e})),arts:{base:g(r.base),values:l(F,(function(e){return r.values[e].map((function(e){return{id:e.id,set:e.set,values:g(e.values)}}))}))}},x=Object.entries(g({})),E=0,M=Object.values(y.arts.values);E<M.length;E++){var j,B=M[E],A=t(B);try{for(A.s();!(j=A.n()).done;){var P,T=j.value.values,V=t(x);try{for(V.s();!(P=V.n()).done;){var N=s(P.value,2),D=N[0],I=N[1];T[D]-=I}}catch(_){V.e(_)}finally{V.f()}}}catch(_){A.e(_)}finally{A.f()}}return y}function R(e,r){return{keys:e.keys,base:e.base,baseBuffer:e.baseBuffer,values:l(F,(function(t){var n=r[t],a=e.values[t];return n.map((function(e){return a[e]}))}))}}function G(e,r){var a,o,i,u,f,l,h;return c().wrap((function(c){for(;;)switch(c.prev=c.next){case 0:a=p(r.values,(function(e){return new Set(e.map((function(e){return e.set})))})),o=t(e),c.prev=2,o.s();case 4:if((i=o.n()).done){c.next=19;break}u=i.value,f=function(){var e=s(h[l],2),r=e[0],t=e[1],o=a[r];switch(t.kind){case"required":if(n(t.sets).every((function(e){return!o.has(e)})))return"continue|filter_loop";break;case"exclude":if(n(o).every((function(e){return t.sets.has(e)})))return"continue|filter_loop"}},l=0,h=Object.entries(u);case 8:if(!(l<h.length)){c.next=15;break}if("continue|filter_loop"!==f()){c.next=12;break}return c.abrupt("continue",17);case 12:l++,c.next=8;break;case 15:return c.next=17,u;case 17:c.next=4;break;case 19:c.next=24;break;case 21:c.prev=21,c.t0=c.catch(2),o.e(c.t0);case 24:return c.prev=24,o.f(),c.finish(24);case 27:case"end":return c.stop()}}),D,null,[[2,21,24,27]])}function H(e){return new Set(null!==e&&void 0!==e&&e.includes(2)?e.includes(4)?[0,1]:[0,1,4,5]:null!==e&&void 0!==e&&e.includes(4)?[0,1,2,3]:[0,1,2,3,4,5])}function W(e,r){var a,o,u,f,h,v,m,b,w,g,y,k,x,E,S,O;return c().wrap((function(M){for(;;)switch(M.prev=M.next){case 0:for(x=function(e){var r,u,s,f,l,p,h,v,m,b,w;return c().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:w=function(e){var r,a,s,f,p,h,v,m,b,x,E,S,O,M;return c().wrap((function(u){for(;;)switch(u.prev=u.next){case 0:r=l.length-e,a=[],s=[],f=[],p=0,h=t(o),u.prev=3,m=function(){var e=v.value,t=k[e],o=y[e];if(!t)return"continue";d(1,r).every((function(e){return!t.has(o+e)}))?f.push(e):t.has(o)?d(0,r).some((function(e){return!t.has(o+e)}))&&a.push(e):(p+=n(t).find((function(e){return e>o}))-o,s.push(e))},h.s();case 6:if((v=h.n()).done){u.next=12;break}if("continue"!==m()){u.next=10;break}return u.abrupt("continue",10);case 10:u.next=6;break;case 12:u.next=17;break;case 14:u.prev=14,u.t0=u.catch(3),h.e(u.t0);case 17:return u.prev=17,h.f(),u.finish(17);case 20:if(!(p>r)){u.next=22;break}return u.abrupt("return");case 22:if(e!==l.length){u.next=26;break}return u.next=25,i({},g);case 25:return u.abrupt("return");case 26:if(p!==r){u.next=47;break}b=t(s),u.prev=28,b.s();case 30:if((x=b.n()).done){u.next=38;break}return E=x.value,y[E]++,g[F[l[e]]]={kind:"required",sets:new Set([E])},u.delegateYield(w(e+1),"t1",35);case 35:y[E]--;case 36:u.next=30;break;case 38:u.next=43;break;case 40:u.prev=40,u.t2=u.catch(28),b.e(u.t2);case 43:return u.prev=43,b.f(),u.finish(43);case 46:return u.abrupt("return");case 47:S=0,O=[].concat(a,s);case 48:if(!(S<O.length)){u.next=57;break}return M=O[S],y[M]++,g[F[l[e]]]={kind:"required",sets:new Set([M])},u.delegateYield(w(e+1),"t3",53);case 53:y[M]--;case 54:S++,u.next=48;break;case 57:return g[F[l[e]]]={kind:"exclude",sets:new Set([].concat(s,f,a))},u.delegateYield(w(e+1),"t4",59);case 59:case"end":return u.stop()}}),u,null,[[3,14,17,20],[28,40,43,46]])},b=function(e){var n,a,i;return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e!==f.length){r.next=3;break}return r.delegateYield(w(0),"t0",2);case 2:return r.abrupt("return",r.t0);case 3:n=t(o),r.prev=4,i=c().mark((function r(){var t,n,o,i,u;return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t=a.value,!s.has(t)){r.next=3;break}return r.abrupt("return","continue");case 3:if(n=f[e].length,o=k[t],i=0,!o||o.has(n)){r.next=9;break}if(!((i=(null!==(u=d(n+1,5).find((function(e){return o.has(e)})))&&void 0!==u?u:6)-n)>m)){r.next=9;break}return r.abrupt("return","continue");case 9:return s.add(t),y[t]=f[e].length,f[e].forEach((function(e){return g[F[e]]={kind:"required",sets:new Set([t])}})),m-=i,r.delegateYield(b(e+1),"t0",14);case 14:m+=i,y[t]=0,s.delete(t);case 17:case"end":return r.stop()}}),r)})),n.s();case 7:if((a=n.n()).done){r.next=14;break}return r.delegateYield(i(),"t1",9);case 9:if("continue"!==r.t1){r.next=12;break}return r.abrupt("continue",12);case 12:r.next=7;break;case 14:r.next=19;break;case 16:r.prev=16,r.t2=r.catch(4),n.e(r.t2);case 19:return r.prev=19,n.f(),r.finish(19);case 22:case"end":return r.stop()}}),r,null,[[4,16,19,22]])},r=c().mark(b),u=c().mark(w),s=new Set,f=[],l=[],p=t(e);try{for(p.s();!(h=p.n()).done;)v=h.value,f.push([]),5===v?l.push(f.length-1):f[v].push(f.length-1)}catch(x){p.e(x)}finally{p.f()}return f=f.filter((function(e){return e.length})).sort((function(e,r){return r.length-e.length})),m=l.length,a.delegateYield(b(0),"t0",10);case 10:case"end":return a.stop()}}),a)},v=function(e,r){if(!d(r+1,4).some((function(r){return 5!==e[r]})))return(e=n(e))[r]=5,e.reduce((function(e,r){return 6*e+r}),0)},h=function(e,r,a){if(5!==e.length){var o,i=t(r);try{var c=function(){var t=o.value;h([].concat(n(e),[t]),r,a.filter((function(e){return e!==t})))};for(i.s();!(o=i.n()).done;)c()}catch(s){i.e(s)}finally{i.f()}h([].concat(n(e),[e.length]),new Set([].concat(n(r),[e.length])),[].concat(n(a),[e.length]))}else u.has(a.length)&&f.push(e)},a=c().mark(x),o=n(new Set(r)),u=H(e.rainbow),f=[],h([0],new Set([0]),[0]),m=function(e){var r,a=new Map,o=t(f);try{for(o.s();!(r=o.n()).done;){var i,u=r.value,c=v(u,e);void 0!==c&&a.set(c,(null!==(i=a.get(c))&&void 0!==i?i:new Set(u.slice(0,e)).size+1)-1)}}catch(d){o.e(d)}finally{o.f()}var l,p=t(a.entries());try{var h=function(){var r=s(l.value,2),t=r[0];if(0===r[1]){var a=n(f.find((function(r){return v(r,e)===t})));a[e]=5,f=f.filter((function(r){return v(r,e)!==t})),f.push(a)}};for(p.s();!(l=p.n()).done;)h()}catch(d){p.e(d)}finally{p.f()}},b=4;b>=0;b--)m(b);w={kind:"exclude",sets:new Set},g=l(F,(function(e){return w})),y=i(i({},p(e,(function(e){return 0}))),l(o,(function(e){return 0}))),k=p(e,H),E=t(f),M.prev=14,E.s();case 16:if((S=E.n()).done){M.next=21;break}return O=S.value,M.delegateYield(x(O),"t0",19);case 19:M.next=16;break;case 21:M.next=26;break;case 23:M.prev=23,M.t1=M.catch(14),E.e(M.t1);case 26:return M.prev=26,E.f(),M.finish(26);case 29:case"end":return M.stop()}}),I,null,[[14,23,26,29]])}l(F,(function(e){return{kind:"exclude",sets:new Set}}));function C(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function U(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function q(e,r,t){return r&&U(e.prototype,r),t&&U(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function z(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];return r.flat()}function K(){return m.apply(void 0,arguments).map((function(e){return e.reduce((function(e,r){var t;return e.coeff*=r.coeff,(t=e.terms).push.apply(t,n(r.terms)),e}),{coeff:1,terms:[]})}))}function Y(e){return[{coeff:e,terms:[]}]}function J(e){return[{coeff:1,terms:[e]}]}function X(e){var r=n(e);r.forEach((function(e){return e.terms.sort()})),r.sort((function(e,r){var t=e.terms,n=r.terms;if(t.length!==n.length)return t.length-n.length;for(var a=0;a<t.length;a++)if(t[a]!==n[a])return t[a]<n[a]?-1:1;return 0}));for(var t=function(e){var t,n,a=r[e].terms,o=r[e+1].terms;if(a.length!==o.length)return"continue";a.every((function(e,r){return e===o[r]}))&&(r[e].coeff=(null!==(t=r[e].coeff)&&void 0!==t?t:0)+(null!==(n=r[e+1].coeff)&&void 0!==n?n:0),r.splice(e+1,1))},a=r.length-2;a>=0;a--)t(a);return r}function Q(e,r){for(var t=r.i,n=r.j,a=e[t][n],o=0;o<e.length;o++)if(o!==t)for(var i=0;i<e[0].length;i++)i!==n&&(e[o][i]-=e[t][i]*e[o][n]/a);for(var u=0;u<e.length;u++)u!==t&&(e[u][n]=-e[u][n]/a);for(var c=0;c<e[0].length;c++)c!==n&&(e[t][c]=e[t][c]/a);e[t][n]=1/a}function $(e){for(var r=e.length,t=e[0].length,n={i:-1,j:-1,cmp:1/0},a=0;a<t-1;a++)if(!(e[r-1][a]>=0)){for(var o=0;o<r-1;o++)if(e[o][a]>1e-5){var i=e[o][t-1]/e[o][a];i<n.cmp&&(n={i:o,j:a,cmp:i})}if(n.i<0)throw Error("UNBOUNDED FEASIBLE")}if(n.i<0)throw Error("NO PIVOTS (done)");return{i:n.i,j:n.j}}function Z(e){for(var r=e.length,t=e[0].length,n={i:-1,j:-1,cmp:1/0},a=0;a<r-1;a++)if(!(e[a][t-1]>=0)){for(var o=0;o<t-1;o++)if(e[a][o]<-1e-5){var i=e[a][t-1]/e[a][o];i<n.cmp&&(n={i:a,j:o,cmp:i})}if(n.i<0)throw Error("INFEASIBLE");return{i:n.i,j:n.j}}throw Error("NO PIVOTS (done)")}function ee(e,r,t){var n=s(P([e],(function(e){return e.path[1]})),3),a=n[0],o=n[1],i=n[2];oe(r,o,i);var u=a()[0];return oe(t,o,i),[u,a()[0]]}function re(e,r,t){var a=function e(r){switch(r.operation){case"add":return g.apply(void 0,n(r.operands.map((function(r){return e(r)}))));case"const":return b(-r.value);case"threshold":var t=s(r.operands,4),a=t[0],o=t[1],i=t[2],u=t[3];if("const"===i.operation&&"const"===u.operation&&i.value<=u.value)return c=a,f=o,l=-i.value,p=-u.value,{operation:"threshold",operands:[E(c),E(f),E(l),E(p)],info:h};throw console.log(r),Error("(res neg slope): threshold. Something went wrong.");default:throw console.log(r),Error("(res neg slope) Havent written logic to handle this")}var c,f,l,p,h}(e.operands[0]),o=s(ee(a,r,t),2),i=o[0],u=o[1],c=B.res,f=[c([-i]),c([-u])],l=f[0],p=f[1];return u>0&&i>-1.75?g(1,y(.5,a)):g((u*l-i*p)/(u-i),y((l-p)/(u-i),a))}function te(e,r,t){var o=e.nodes,i=e.terms,u={};Object.entries(o).forEach((function(e){var r=s(e,2),t=r[0],n=r[1];"read"===n.operation&&(u[n.path[1]]=t)}));function c(e){switch(e.operation){case"const":return Y(e.value);case"read":return J(u[e.path[1]]);case"add":return z.apply(void 0,n(e.operands.map(c)));case"mul":return K.apply(void 0,n(e.operands.map(c)));case"threshold":var a=s(e.operands,4),o=a[0],i=a[1],f=a[2],l=a[3];if("read"===o.operation&&"const"===i.operation&&"const"===l.operation&&"const"===f.operation){if(f.value<l.value)throw console.log(e),Error("Not Implemented (threshold must be increasing)");var p=o.path[1];if(r[p]>=i.value)return Y(f.value);if(t[p]<i.value)return Y(l.value);var h=K(Y((f.value-l.value)/(i.value-r[p])),J(u[o.path[1]]));return 0===l.value?h:z(Y(l.value),h)}throw console.log(e),Error("Not Implemented (threshold must branch between constants)");case"res":return c(re(e,r,t));case"min":case"max":var d=s(e.operands,2),v=d[0],m=d[1];if("const"!==m.operation){var b=[m,v];v=b[0],m=b[1]}if("min"===e.operation)return c(v);if("const"===m.operation){var w=m.value,g=s(ee(v,r,t),2),y=g[0],k=g[1];if(y>w)return c(v);if(w>k)return Y(w);var x=(k-w)/(k-y);return z(Y(w-y),K(Y(x),c(v)))}throw console.log(e),Error("Not Implemented (max between two non-constants)");case"sum_frac":var E=s(e.operands,2),S=E[0],O=E[1];if("const"!==O.operation)throw Error("Not Implemented (non-constant sum_frac denominator)");var M=s(ee(S,r,t),2),j=M[0],B=M[1],A=O.value,P=Math.sqrt((j+A)*(B+A))-A,T=(A+P)*(A+P),V=A/T;return z(Y(P*P/T),K(Y(V),c(S)));default:throw console.log(e),Error("Not Implemented")}}var f=Object.fromEntries(Object.entries(o).filter((function(e){var r=s(e,2);r[0];return"read"!==r[1].operation})).map((function(e){var r=s(e,2);return[r[0],c(r[1])]}))),l=i.flatMap((function(e){var r=e.coeff,t=e.terms;return K.apply(void 0,[Y(r)].concat(n(t.map((function(e){var r;return null!==(r=f[e])&&void 0!==r?r:J(e)})))))}));l=(l=X(l)).map((function(e){var r=e.coeff,t=e.terms;return{coeff:r,terms:t=t.map((function(e){var r=o[e];if(!r||"read"!==r.operation)throw Error("MUST be a read node.");return r.path[1]}))}}));var p=l.map((function(e){var o=e.coeff,i=e.terms;if(0===i.length)return{w:{},c:o,err:0};if(1===i.length)return{w:a({},i[0],o),c:0,err:0};var u=function(e){if(0===e.length)return{w:[],c:0,err:0};var r=e.length,t=e.map((function(e){return e.upper})),a=t.reduce((function(e,r){return e*r}),1);e=e.map((function(e){return{lower:e.lower/e.upper,upper:1}}));var o,i=m.apply(void 0,n(e.map((function(e){return[e.lower,e.upper]})))).flatMap((function(e){var r=e.reduce((function(e,r){return e*r}),1);return[[].concat(n(e.map((function(e){return-e}))),[1,0,-r]),[].concat(n(e),[-1,-1,r])]})),u=[].concat(n(e.map((function(e){return 0}))),[0,1]);try{o=function(e,r){var t=r.length+1,n=r[0].length,a=Array(t).fill(0).map((function(e){return Array(n).fill(0)}));r.forEach((function(e,r){return e.forEach((function(e,t){return a[r][t]=e}))})),e.forEach((function(e,r){return a[t-1][r]=e}));for(var o=[];a.some((function(e,r){return r<t-1&&e[n-1]<0}));){var i=Z(a);o.push(i),Q(a,i)}for(;a[t-1].some((function(e,r){return r<n-1&&e<0}));){var u=$(a);o.push(u),Q(a,u)}return e.map((function(e,r){return function(e,r,t){var n=1;r.forEach((function(e){var r=e.i,a=e.j;1===n&&a===t?(t=r,n=0):0===n&&r===t&&(t=a,n=1)}));var a=e[0].length;return 0===n?e[t][a-1]:0}(a,o,r)}))}(u,i)}catch(c){throw console.log("ERROR on bounds",e),console.log("Possibly numerical instability issue."),c}return{w:o.slice(0,r).map((function(e,r){return e*a/t[r]})),c:-a*o[r],err:a*o[r+1]}}(i.map((function(e){return{lower:r[e],upper:t[e]}}))),c=u.w,s=u.c,f=u.err;return{w:c.reduce((function(e,r,t){var n;return e[i[t]]=r*o+(null!==(n=e[i[t]])&&void 0!==n?n:0),e}),{}),c:o*s,err:o*f+0}}));return p.reduce((function(e,r){return e.c+=r.c,e.err+=r.err,Object.entries(r.w).forEach((function(r){var t,n=s(r,2),a=n[0],o=n[1];return e.w[a]=o+(null!==(t=e.w[a])&&void 0!==t?t:0)})),e}),{w:{},c:0,err:0})}function ne(e){if(1===e.length)return e[0];var r=(e=e.flatMap((function(e){return"add"===e.operation?e.operands:e}))).reduce((function(e,r){return"const"===r.operation?e+r.value:e}),0);return 0===(e=e.filter((function(e){return"const"!==e.operation}))).length?b(r):0===r?1===e.length?e[0]:g.apply(void 0,n(e)):g.apply(void 0,n(e).concat([b(r)]))}function ae(e){if(1===e.length)return e[0];var r=(e=e.flatMap((function(e){return"mul"===e.operation?e.operands:e}))).reduce((function(e,r){return"const"===r.operation?e*r.value:e}),1);return 0===(e=e.filter((function(e){return"const"!==e.operation}))).length?b(r):1===r?y.apply(void 0,n(e)):y.apply(void 0,n(e).concat([b(r)]))}function oe(e,r,t){Object.entries(e).filter((function(e){var t=s(e,1)[0];return void 0!==r[t]})).forEach((function(e){var n=s(e,2),a=n[0],o=n[1];return t[r[a]]=o}))}function ie(e){return e.reduce((function(e,r){var t=r.filterVec;return e+F.reduce((function(e,r){return e*t[r].length}),1)}),0)}function ue(e){for(var r=n(e[0].lower),t=n(e[0].upper),a=n(e[0].minw),o=n(e[0].maxw),i=1;i<e.length;i++){for(var u=0;u<r.length;u++)r[u]=Math.min(r[u],e[i].lower[u]),t[u]=Math.max(t[u],e[i].upper[u]);for(var c=0;c<a.length;c++)a[c]=Math.min(a[c],e[i].minw[c]),o[c]=Math.max(o[c],e[i].maxw[c])}return{lower:r,upper:t,minw:a,maxw:o}}function ce(e,r){var t=[],n=[],a=[];r.forEach((function(r){var o=[],i=[];Object.entries(r.w).forEach((function(r){var t=s(r,2),n=t[0],a=t[1];o.push(e.keys.indexOf(n)),i.push(a)})),t.push(o),n.push(i),a.push(o.reduce((function(r,t,n){return r+e.base[t]*i[n]}),r.c))})),e.baseBuffer=a,F.forEach((function(r){return e.values[r].forEach((function(e){return e.buffer=t.map((function(r,t){return r.reduce((function(r,a,o){return r+e.values[a]*n[t][o]}),0)}))}))}))}function se(e,r,t){var a=t.optimizationTarget,o=t.constraints,i=t.artSetExclusion,u=t.depth,c=t.filters,f=[].concat(n(o.map((function(e){return e.value}))),[a]),l=o.map((function(e){return e.min}));if(0!==(c=c.filter((function(e){var t=e.maxw;return!l.some((function(e,r){return t[r]<e}))&&!(t[l.length]<r)}))).length){var p=ue(c),h=p.lower,v=p.upper,m=Object.fromEntries(e.keys.map((function(e,r){return[e,h[r]]}))),w=Object.fromEntries(e.keys.map((function(e,r){return[e,v[r]]})));f=function(e,r,t){var n=Object.keys(r).filter((function(e){return Math.abs(r[e]-t[e])<1e-6}));return e.map((function(e){var a=e.nodes,o=e.terms,i=Object.entries(a),u=O(i.map((function(e){var r=s(e,2);return r[0],r[1]})),(function(e){return e}),(function(e){switch(e.operation){case"read":return n.includes(e.path[1])?b(r[e.path[1]]):e;case"threshold":var a=s(e.operands,4),o=a[0],i=a[1],u=a[2],c=a[3];if("const"===o.operation&&"const"===i.operation)return o.value>=i.value?u:c;if("read"!==o.operation||"const"!==i.operation)throw Error("Branch between non-read and non-const!!!");return r[o.path[1]]>=i.value?u:t[o.path[1]]<i.value?c:e;case"add":return ne(e.operands);case"mul":return ae(e.operands);case"res":case"sum_frac":case"min":case"max":return e.operands.every((function(e){return"const"===e.operation}))?b(B[e.operation](e.operands.map((function(e){return"const"===e.operation?e.value:NaN})))):e;default:return e}})),c={};u.forEach((function(e,r){if("const"===e.operation){var t=s(i[r],1)[0];c[t]=e.value}}));var f=o.map((function(e){var r=e.coeff,t=e.terms.filter((function(e){return void 0===c[e]||(r*=c[e],!1)}));return 0===r?{coeff:0,terms:[]}:{coeff:r,terms:t}})),l=Object.fromEntries(u.map((function(e,r){return[i[r][0],e]})));return Object.keys(c).forEach((function(e){return delete l[e]})),{nodes:l,terms:X(f)}}))}(f,m,w);var k=P(o.map((function(e){return function(e){var r=e.nodes,t=e.terms;return g.apply(void 0,n(t.map((function(e){var t=e.coeff,a=e.terms;return y.apply(void 0,[t].concat(n(a.map((function(e){return r[e]})))))}))))}(e.value)})),(function(e){return e.path[1]})),x=s(k,3),E=x[0],S=x[1],M=x[2];oe(m,S,M);for(var j=E(),A=l.map((function(e,r){return e>j[r]})),T=f.pop(),V=f.map((function(e,r){return{value:e,min:l[r]}})).filter((function(e,r){return A[r]})),L=V.map((function(e){return e.min})),D={},I=function(){var e=s(G[_],2),r=e[0],t=e[1];if("uniqueKey"===r){D[r]=t;var n=N.filter((function(e){return w[e]>0})),a=0,o=0;if(n.forEach((function(e){var r=d(m[e],w[e]);i[e]&&(r=r.filter((function(r){return!i[e].includes(r)}))),(r.includes(4)||r.includes(5))&&a++,(r.includes(2)||r.includes(3))&&o++})),t.includes(5)&&0===a){if(0===o)return{v:void 0};if(t.includes(3)&&o<2)return{v:void 0}}return"continue"}var u=t.filter((function(e){return m[r]<=e&&e<=w[r]}));if(u.includes(m[r])&&u.includes(w[r]))return{v:void 0};u.length>0&&(D[r]=u)},_=0,G=Object.entries(i);_<G.length;_++){var H=I();if("continue"!==H&&"object"===typeof H)return H.v}var W=[].concat(n(V.map((function(e){return e.value}))),[T]).map((function(e){return te(e,m,w)}));ce(e,W);var C=c.map((function(r){var t=r.filterVec,a=r.lower,o=r.upper,i=R(e,r.filterVec),u=n(i.baseBuffer),c=n(i.baseBuffer);return F.forEach((function(e){for(var r=le(i.values[e]),t=r.minw,n=r.maxw,a=0;a<u.length;a++)u[a]+=t[a],c[a]+=n[a]})),{filterVec:t,lower:a,upper:o,minw:u,maxw:c}})).filter((function(e){var t=e.maxw;return!L.some((function(e,r){return t[r]<e}))&&!(t[l.length]<r)}));return{cache:!0,optimizationTarget:T,constraints:V,artSetExclusion:D,depth:u,lin:W,filters:C}}}function fe(e){for(var r=n(e[0].values),t=n(e[0].values),a=n(e[0].buffer),o=n(e[0].buffer),i=1;i<e.length;i++){for(var u=0;u<r.length;u++)r[u]=Math.min(r[u],e[i].values[u]),t[u]=Math.max(t[u],e[i].values[u]);for(var c=0;c<a.length;c++)a[c]=Math.min(a[c],e[i].buffer[c]),o[c]=Math.max(o[c],e[i].buffer[c])}return{lower:r,upper:t,minw:a,maxw:o}}function le(e){for(var r=n(e[0].buffer),t=n(e[0].buffer),a=1;a<e.length;a++)for(var o=0;o<r.length;o++)r[o]=Math.min(r[o],e[a].buffer[o]),t[o]=Math.max(t[o],e[a].buffer[o]);return{minw:r,maxw:t}}function pe(e){var r=n(e.base),t=n(e.base),a=n(e.baseBuffer),o=n(e.baseBuffer);return Object.values(e.values).forEach((function(e){for(var n=fe(e),i=0;i<r.length;i++)r[i]+=n.lower[i],t[i]+=n.upper[i];for(var u=0;u<a.length;u++)a[u]+=n.minw[u],o[u]+=n.maxw[u]})),{lower:r,upper:t,minw:a,maxw:o}}var he,de,ve,me=function(){function e(r,t){var n=this,a=r.arts,o=r.artsVec,u=r.optimizationTarget,c=r.filters,s=r.plotBase,f=r.maxBuilds;C(this,e),this.builds=[],this.buildValues=[],this.plotData=void 0,this.plotBase=void 0,this.threshold=-1/0,this.maxBuilds=void 0,this.min=void 0,this.arts=void 0,this.artsVec=void 0,this.nodes=void 0,this.callback=void 0,this.interimReport=function(e){n.refresh(!1),n.callback(i({command:"interim",buildValues:n.buildValues},e)),n.buildValues=[],e.tested=0,e.failed=0,e.skipped=0},this.arts=a,this.artsVec=o,this.min=c.map((function(e){return e.min})),this.maxBuilds=f,this.callback=t,this.nodes=c.map((function(e){return e.value})),this.nodes.push(u),s&&(this.plotData={},this.plotBase=s,this.nodes.push(s)),this.nodes=function(e,r){return V(e=T(e=L(e,r,arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return!1})))}(this.nodes,{},(function(e){return!1}))}return q(e,[{key:"computeU",value:function(e,r){this.threshold<e&&(this.threshold=e);var a=r.filters,o=r.artSetExclusion,i=(r.depth,this),u=ie(a),c=ue(a),f=c.lower,p=c.upper,h=c.maxw;if(!(h[h.length-1]<this.threshold)){var d=n(this.nodes),v=n(this.min);void 0!==this.plotBase&&d.push(this.plotBase);var m=Object.fromEntries(this.artsVec.keys.map((function(e,r){return[e,f[r]]}))),w=Object.fromEntries(this.artsVec.keys.map((function(e,r){return[e,p[r]]})));d=function(e,r,t){var n=Object.keys(r).filter((function(e){return r[e]===t[e]}));return O(e,(function(e){return e}),(function(e){switch(e.operation){case"add":return ne(e.operands);case"mul":return ae(e.operands);case"read":return n.includes(e.path[1])?b(r[e.path[1]]):e;case"threshold":var a=s(e.operands,4),o=a[0],i=a[1],u=a[2],c=a[3];if("const"===o.operation&&"const"===i.operation)return o.value>=i.value?u:c;if("read"===o.operation&&"const"===i.operation){if(r[o.path[1]]>=i.value)return u;if(t[o.path[1]]<i.value)return c}return e;case"min":case"max":case"res":case"sum_frac":return e.operands.every((function(e){return"const"===e.operation}))?b(B[e.operation](e.operands.map((function(e){return"const"===e.operation?e.value:NaN})))):e;default:return e}}))}(d,m,w);var g=_(d,this.arts);d=g.nodes;for(var y=g.arts,k=s(P(d,(function(e){return e.path[1]})),3),x=k[0],E=k[1],S=k[2],M=a.map((function(e){var r,t,n=(r=g.arts,t=e.filterVec,{base:r.base,values:l(F,(function(e){var n=t[e],a=r.values[e];return n.map((function(e){return a[e]}))}))});return Object.values(n.values).sort((function(e,r){return e.length-r.length})).map((function(e){return e.map((function(e){return{id:e.id,set:e.set,values:Object.entries(e.values).map((function(e){var r=s(e,2),t=r[0],n=r[1];return{key:E[t],value:n,cache:0}})).filter((function(e){var r=e.key,t=e.value;return void 0!==r&&0!==t}))}}))}))})),j={tested:0,failed:0,skipped:0},A=[],T=0,V=Object.entries(y.base);T<V.length;T++){var L=s(V[T],2),N=L[0],D=L[1],I=E[N];void 0!==I&&(S[I]=D)}for(var R=0;R<M.length;R++)A=Array(M[0].length).fill(""),G(R,M[R].length-1,{});return this.interimReport(j),this.threshold}function G(e,r,a){if(r<0){var u=x();if(v.some((function(e,r){return e>u[r]}))||!function(e,r){if(!Object.entries(e).every((function(e){var t=s(e,2),n=t[0],a=t[1];return!r[n]||!r[n].includes(a)})))return!1;if(!r.uniqueKey)return!0;var t=Object.values(e).reduce((function(e,r){return e+r%2}),0);return!r.uniqueKey.includes(t)}(a,o))return void j.failed++;var c,f=u[v.length],l=i.builds,p=i.buildValues,h=i.plotData;if(f>=i.threshold&&(c={value:f,artifactIds:n(A)},l.push(c),p.push(f)),h){var d=u[v.length+1];(!h[d]||h[d].value<f)&&(c||(c={value:f,artifactIds:n(A)}),c.plot=d,h[d]=c)}}else M[e][r].forEach((function(n){var o,i,u,c,s,f;A[r]=n.id;var l,p=t(n.values);try{for(p.s();!(l=p.n()).done;){var h=l.value,d=h.key,v=h.value;h.cache=S[d],S[d]+=v}}catch(k){p.e(k)}finally{p.f()}a[null!==(o=n.set)&&void 0!==o?o:""]=1+(null!==(i=a[null!==(u=n.set)&&void 0!==u?u:""])&&void 0!==i?i:0),G(e,r-1,a),a[null!==(c=n.set)&&void 0!==c?c:""]-=1,0===a[null!==(s=n.set)&&void 0!==s?s:""]&&delete a[null!==(f=n.set)&&void 0!==f?f:""];var m,b=t(n.values);try{for(b.s();!(m=b.n()).done;){var w=m.value,g=w.key,y=w.cache;S[g]=y}}catch(k){b.e(k)}finally{b.f()}})),0===r&&(j.tested+=M[e][r].length)}this.interimReport({tested:0,failed:0,skipped:u})}},{key:"refresh",value:function(e){var r,a=this.maxBuilds;Object.keys(null!==(r=this.plotData)&&void 0!==r?r:{}).length>=1e5&&(this.plotData=function(e){for(var r=.01,a=new Set(e.flatMap((function(e){return Object.values(e).map((function(e){return Math.round(e.plot/r)}))})));a.size>1500;)r*=2,a=new Set(n(a).map((function(e){return Math.round(e/2)})));var o,i={},u=t(e);try{for(u.s();!(o=u.n()).done;)for(var c=o.value,s=0,f=Object.values(c);s<f.length;s++){var l=f[s],p=Math.round(l.plot/r)*r;(!i[p]||i[p].value<l.value)&&(i[p]=l)}}catch(h){u.e(h)}finally{u.f()}return i}([this.plotData])),this.builds=this.builds.sort((function(e,r){return r.value-e.value})).slice(0,a)}}]),e}(),be=function(){function e(r,t){var n,a,o=r.arts,i=r.artsVec,u=r.optimizationTarget,c=r.filters,f=r.artSetExclusion;C(this,e),this.min=void 0,this.arts=void 0,this.artsVec=void 0,this.nodes=void 0,this.artSet=void 0,this.subproblems=[],this.splitcounter=0,this.callback=void 0,this.arts=o,this.artsVec=i,this.min=c.map((function(e){return e.min})),this.nodes=c.map((function(e){return e.value})),this.callback=t,this.min.push(-1/0),this.nodes.push(u),this.artSet=(n=Object.entries(f),a=function(e){var r=s(e,2),t=r[0],n=r[1];return"rainbow"===t?["uniqueKey",n.map((function(e){return e+1}))]:[t,n.flatMap((function(e){return 2===e?[2,3]:[4,5]}))]},Object.fromEntries(n.map((function(e){return a(e)}))))}return q(e,[{key:"addSubProblem",value:function(e){var r=ie(e.filters);if(0!==r){var t=Math.max.apply(Math,n(e.filters.map((function(e){var r=e.maxw;return r[r.length-1]}))));this.subproblems.push({count:r,upperBound:t,subproblem:e})}}},{key:"split",value:function(e){var r=this,t=e.threshold,n=e.minCount,a=e.maxIter,o=e.subproblem;t>this.min[this.min.length-1]&&(this.min[this.min.length-1]=t),o&&this.addSubProblem(o);for(var i=this.subproblems.reduce((function(e,r){return e+r.count}),0),u=0;u<a&&this.subproblems.length;){u+=1;var c=this.subproblems.pop(),s=c.count,f=c.subproblem;if(s<=n){var l=this.subproblems.reduce((function(e,r){return e+r.count}),0)+s;return this.callback({command:"interim",tested:0,failed:0,skipped:i-l,buildValues:void 0}),[f]}this.splitBNB(this.min[this.min.length-1],f).forEach((function(e){return r.addSubProblem(e)}))}var p=this.subproblems.reduce((function(e,r){return e+r.count}),0);return this.callback({command:"interim",tested:0,failed:0,skipped:i-p,buildValues:void 0}),[]}},{key:"popOne",value:function(){if(0!==this.subproblems.length){for(var e={i:-1,heur:-1/0},r=1;r<this.subproblems.length;r++){var t=this.subproblems[r].upperBound;t>e.heur&&(e={i:r,heur:t})}if(!(e.i<0))return this.subproblems.splice(e.i,1)[0].subproblem}}},{key:"splitBNB",value:function(e,r){var t=this;if(r.filters=r.filters.filter((function(r){var t=r.maxw;return t[t.length-1]>e})),0===r.filters.length)return[];var a=[];if(r.filters.length>50){var o=r.filters.sort((function(e,r){return e.maxw[e.maxw.length-1]-r.maxw[r.maxw.length-1]}));a=function(e,r){var t=e.length%r,n=Math.floor(e.length/r),a=0;return Array.from({length:r},(function(r,o){return e.slice(a,a+=n+(o<t?1:0))}))}(o,Math.ceil(o.length/50)).map((function(e){return i(i({},r),{},{filters:e})}))}else{var u=ie(r.filters),c=function(e,r,t){var a=t.constraints,o=t.filters,u=t.lin;ce(e,u);for(var c=[].concat(n(a.map((function(e){return e.min}))),[r]),s=!1,f=function(r){var t=o[r],a=t.maxw,u=t.filterVec,f=l(F,(function(r){var t=le(u[r].map((function(t){return e.values[r][t]}))),o=t.minw,i=t.maxw,s=[];return a.forEach((function(t,f){var l=c[f]-a[f]+i[f];o[f]>l||s.push.apply(s,n(u[r].filter((function(t){return e.values[r][t].buffer[f]<l}))))})),new Set(s)}));if(Object.values(f).every((function(e){return 0===e.size})))return"continue";s=!0;var p=l(F,(function(e){return u[e].filter((function(r){return!f[e].has(r)}))}));if(0===F.reduce((function(e,r){return e*p[r].length}),1))return o.splice(r,1),"continue";o[r]=i({filterVec:p},pe(R(e,p)))},p=o.length-1;p>=0;p--)f(p);return s}(this.artsVec,e,r),s=ie(r.filters);if(c&&0===ie(r.filters))return[];a=c&&u-s>.3*u?[r]:this.makeBranches(e,r)}var f=[];return a.forEach((function(r){var a=ie(r.filters);if(0!==a){var o=se(t.artsVec,e,r);if(void 0!==o){o.depth+=1;var i=Math.max.apply(Math,n(o.filters.map((function(e){var r=e.maxw;return r[r.length-1]})))),u=o.lin;f.push({numBuilds:a,heur:i-u[u.length-1].err,subproblem:o})}}})),f.sort((function(e,r){return r.numBuilds-e.numBuilds})),f.map((function(e){return e.subproblem}))}},{key:"makeBranches",value:function(e,r){var t=this,a=r.constraints,o=r.lin,u=r.artSetExclusion,c=r.filters,f=ue(c),p=f.minw,h=f.maxw,d=f.lower,v=f.upper;this.splitcounter+=1;var b={flower:{kind:"id",ids:new Set},plume:{kind:"id",ids:new Set},sands:{kind:"id",ids:new Set},goblet:{kind:"id",ids:new Set},circlet:{kind:"id",ids:new Set}};c.forEach((function(e){F.forEach((function(r){var n=b[r].ids;e.filterVec[r].forEach((function(e){return n.add(t.arts.values[r][e].id)}))}))}));for(var w,g=function(e,r){return{keys:e.keys,base:e.base,baseBuffer:e.baseBuffer,values:l(F,(function(t){var n=r[t];switch(n.kind){case"id":return e.values[t].filter((function(e){return n.ids.has(e.id)}));case"exclude":return e.values[t].filter((function(e){return!n.sets.has(e.set)}));case"required":return e.values[t].filter((function(e){return n.sets.has(e.set)}))}}))}}(this.artsVec,b),y=[].concat(n(a.map((function(e){return e.min}))),[e]).map((function(e,r){return(e-p[r])/(h[r]-p[r])})),k=-1,x=y.length-1;x>=0;x--)0!==Object.keys(o[x].w).length&&(k<0&&(k=x),y[k]<.5||y[x]>y[k]&&(k=x));if(k<0){var E=N.filter((function(e){return v[e]>0})),S={k:void 0,cnt:-1};E.forEach((function(e){var r=v[e];u[e]&&u[e].includes(r)&&(r=Math.min.apply(Math,n(u[e]))-1),r>S.cnt&&(S={k:e,cnt:r})}));var O=this.artsVec.keys.indexOf(S.k);ce(this.artsVec,o),w=we(O,this.artsVec,c,o)}else{var M=o[k],j=Object.keys(M.w),B={k:"",heur:-1};if(j.forEach((function(e){var r=t.artsVec.keys.indexOf(e),a=Object.entries(g.values).reduce((function(e,t){var a=s(t,2),o=(a[0],a[1].map((function(e){return e.values[r]}))),i=Math.min.apply(Math,n(o)),u=Math.max.apply(Math,n(o));if(i===u)return e;var c=(i+u)/2,f=Math.max.apply(Math,n(o.filter((function(e){return e<=c})))),l=Math.min.apply(Math,n(o.filter((function(e){return e>c}))));return e+Math.min(u-f,l-i)}),0),o=M.w[e]*a*(N.includes(e)?5:1);o>B.heur&&(B={k:e,heur:o})})),""===B.k)throw console.log("===================== SHATTER BROKE ====================",o,g),Error("Shatter broke...");var A=this.artsVec.keys.indexOf(B.k),P=(d[A]+v[A])/2;ce(this.artsVec,o),w=N.includes(B.k)?we(A,this.artsVec,c,o):function(e,r,t,a,o){var u=[],c=[];return a.forEach((function(a){var o=a.filterVec,f=function(e,r,t,a){var o=a.filterVec,i=5;t-=e.base[r];for(var u=F.map((function(t){return o[t].map((function(n){return{ix:n,v:e.values[t][n].values[r]}})).sort((function(e,r){return e.v-r.v}))})).map((function(e){return e.map((function(e){return{ixs:[e.ix],v:e.v}}))})),c=0;c<u.length;c+=1)for(var f=u[c],p=f.length-1;p>0;p-=1){var h;if(f[p].v==f[p-1].v)(h=f[p-1].ixs).push.apply(h,n(f[p].ixs)),f.splice(p,1)}var d=u.map((function(e){return e[0].v})),v=u.map((function(e){return e[e.length-1].v-e[0].v}));v.every((function(e){return 0===e}))&&v.fill(1);var m=(t-d.reduce((function(e,r){return e+r})))/v.reduce((function(e,r){return e+r})),b=[];function w(e){for(var r=0,n=0,a=0;a<i;a++){var o,c,s,f,l=e[a];r+=null!==(o=null===(c=u[a][l-1])||void 0===c?void 0:c.v)&&void 0!==o?o:-1/0,n+=null!==(s=null===(f=u[a][l])||void 0===f?void 0:f.v)&&void 0!==s?s:1/0}return r-t<=1e-6&&t-n<=1e-6}function g(e){return e.reduce((function(e,r){return e*r}),1)+e.reduce((function(e,r,t){return e*(u[t].length-r)}),1)}if(u.forEach((function(e,r){for(var t=-1,n=0;n<e.length;n++)if(e[n].v>=d[r]+m*v[r]){t=n;break}t<0&&(t=e.length),b.push(t)})),!w(b))throw console.log("feas",b,w(b),g(b)),console.log({x0:d,v:v,coeff:m,targ:t}),console.log(u),Error("hmmm feas not working");var y=[[0,1],[0,-1],[1,1],[1,-1],[2,1],[2,-1],[3,1],[3,-1],[4,1],[4,-1]],k=[[0,1,-1,-1],[0,1,-1,1],[0,1,1,-1],[0,1,1,1],[0,2,-1,-1],[0,2,-1,1],[0,2,1,-1],[0,2,1,1],[0,3,-1,-1],[0,3,-1,1],[0,3,1,-1],[0,3,1,1],[0,4,-1,-1],[0,4,-1,1],[0,4,1,-1],[0,4,1,1],[1,2,-1,-1],[1,2,-1,1],[1,2,1,-1],[1,2,1,1],[1,3,-1,-1],[1,3,-1,1],[1,3,1,-1],[1,3,1,1],[1,4,-1,-1],[1,4,-1,1],[1,4,1,-1],[1,4,1,1],[2,3,-1,-1],[2,3,-1,1],[2,3,1,-1],[2,3,1,1],[2,4,-1,-1],[2,4,-1,1],[2,4,1,-1],[2,4,1,1],[3,4,-1,-1],[3,4,-1,1],[3,4,1,-1],[3,4,1,1]],x=function(){var e={score:g(b)};if(y.forEach((function(r){var t=s(r,2),a=t[0],o=t[1],i=n(b);if(i[a]+=o,!(i[a]<0||i[a]>=u[a].length)&&w(i)){var c=i.reduce((function(e,r){return e*r}),1)+i.reduce((function(e,r,t){return e*(u[t].length-r)}),1);c>e.score&&(e={score:c,next:i})}})),k.forEach((function(r){var t=s(r,4),a=t[0],o=t[1],i=t[2],c=t[3],f=n(b);if(f[a]+=i,f[o]+=c,!(f[a]<0||f[a]>=u[a].length)&&!(f[o]<0||f[o]>=u[o].length)&&w(f)){var l=f.reduce((function(e,r){return e*r}),1)+f.reduce((function(e,r,t){return e*(u[t].length-r)}),1);l>e.score&&(e={score:l,next:f})}})),void 0===e.next)return"break";b=e.next};for(;;){if("break"===x())break}return l(F,(function(e,r){return[u[r].slice(0,b[r]).flatMap((function(e){return e.ixs})),u[r].slice(b[r]).flatMap((function(e){return e.ixs}))]}))}(t,e,r,a),p=l(F,(function(e){return f[e].filter((function(e){return e.length>0})).map((function(r){var n=o[e].map((function(r){return t.values[e][r]}));return i({slotArts:n,ixs:r},fe(n))}))}));m(p.flower,p.plume,p.sands,p.goblet,p.circlet).forEach((function(n){var a=s(n,5),o=a[0],i=a[1],f=a[2],l=a[3],p=a[4],h=o.lower.map((function(e,r){return n.reduce((function(e,t){return e+t.lower[r]}),t.base[r])})),d=o.upper.map((function(e,r){return n.reduce((function(e,t){return e+t.upper[r]}),t.base[r])})),v=o.maxw.map((function(e,r){return n.reduce((function(e,t){return e+t.maxw[r]}),t.baseBuffer[r])})),m=o.minw.map((function(e,r){return n.reduce((function(e,t){return e+t.minw[r]}),t.baseBuffer[r])})),b={filterVec:{flower:o.ixs,plume:i.ixs,sands:f.ixs,goblet:l.ixs,circlet:p.ixs},lower:h,upper:d,minw:m,maxw:v};d[e]-r>r-h[e]?u.push(b):c.push(b)}))})),[u,c]}(A,P,this.artsVec,c)}return w.map((function(e){return i(i({},r),{},{filters:e,cache:!0})}))}}]),e}();function we(e,r,t,n){function a(e,t,n){return i(i({set:t},fe(n.map((function(t){return r.values[e][t]})))),{},{ixs:n})}var o=[],u=[],c=[];return t.forEach((function(t){var n=t.filterVec,i=l(F,(function(t){var o=r.values[t],i=n[t].filter((function(r){return 0===o[r].values[e]})),u=n[t].filter((function(r){return 1===o[r].values[e]})),c=[];return i.length>0&&c.push(a(t,0,i)),u.length>0&&c.push(a(t,1,u)),c}));m(i.flower,i.plume,i.sands,i.goblet,i.circlet).forEach((function(e){var t=s(e,5),n=t[0],a=t[1],i=t[2],f=t[3],l=t[4],p=n.lower.map((function(t,n){return e.reduce((function(e,r){return e+r.lower[n]}),r.base[n])})),h=n.upper.map((function(t,n){return e.reduce((function(e,r){return e+r.upper[n]}),r.base[n])})),d=n.maxw.map((function(t,n){return e.reduce((function(e,r){return e+r.maxw[n]}),r.baseBuffer[n])})),v=n.minw.map((function(t,n){return e.reduce((function(e,r){return e+r.minw[n]}),r.baseBuffer[n])})),m={filterVec:{flower:n.ixs,plume:a.ixs,sands:i.ixs,goblet:f.ixs,circlet:l.ixs},lower:p,upper:h,minw:v,maxw:d};switch(e.reduce((function(e,r){return e+r.set}),0)){case 0:case 1:o.push(m);break;case 2:case 3:u.push(m);break;case 4:case 5:c.push(m);break;default:throw Error("Unreachable")}}))})),[o,u,c]}onmessage=function(e){var r,a=e.data,o=a.command;switch(o){case"setup":he=a.id;var u=function(e){return postMessage(i({id:he},e))};de=new be(a,u),ve=new me(a,u),r={command:"iterate"};break;case"split":r={command:"split",subproblems:de.split(a),ready:0===de.subproblems.length};break;case"iterate":var c=a.threshold,s=a.subproblem;ve.computeU(c,s),r={command:"iterate"};break;case"finalize":ve.refresh(!0);var f=ve,p=f.builds,h=f.plotData;r={command:"finalize",builds:p,plotData:h};break;case"count":if("break"===function(){var e,o=a.exclusion,i=ve.arts,u=G(W(o,n(new Set(Object.values(i.values).flatMap((function(e){return e.map((function(e){return e.set}))}))))),i),c=a.arts.map((function(e){return 0})),s=t(u);try{var f=function(){var r=e.value;a.arts.forEach((function(e,t){return c[t]+=function(e){return F.reduce((function(r,t){return r*e.values[t].length}),1)}(function(e,r){return{base:e.base,values:l(F,(function(t){var n=r[t];switch(n.kind){case"id":return e.values[t].filter((function(e){return n.ids.has(e.id)}));case"exclude":return e.values[t].filter((function(e){return!n.sets.has(e.set)}));case"required":return e.values[t].filter((function(e){return n.sets.has(e.set)}))}}))}}(e,r))}))};for(s.s();!(e=s.n()).done;)f()}catch(p){s.e(p)}finally{s.f()}return r={command:"count",counts:c},"break"}())break;case"share":var d=de.popOne();r={command:"share",subproblem:d,sender:a.sender};break;default:v(o)}postMessage(i({id:he},r))}}();
//# sourceMappingURL=BackgroundWorker.31d92412.worker.js.map