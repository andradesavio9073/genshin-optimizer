/*! For license information please see BackgroundWorker.56afc2e0.worker.js.LICENSE.txt */
!function(){"use strict";function e(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function r(r,t){if(r){if("string"===typeof r)return e(r,t);var n=Object.prototype.toString.call(r).slice(8,-1);return"Object"===n&&r.constructor&&(n=r.constructor.name),"Map"===n||"Set"===n?Array.from(r):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?e(r,t):void 0}}function t(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=r(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var a=0,o=function(){};return{s:o,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return u=e.done,e},e:function(e){c=!0,i=e},f:function(){try{u||null==n.return||n.return()}finally{if(c)throw i}}}}function n(t){return function(r){if(Array.isArray(r))return e(r)}(t)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||r(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function o(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function i(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?o(Object(t),!0).forEach((function(r){a(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function c(){c=function(){return e};var e={},r=Object.prototype,t=r.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",i=n.toStringTag||"@@toStringTag";function s(e,r,t){return Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}),e[r]}try{s({},"")}catch(T){s=function(e,r,t){return e[r]=t}}function l(e,r,t,n){var a=r&&r.prototype instanceof h?r:h,o=Object.create(a.prototype),i=new O(n||[]);return o._invoke=function(e,r,t){var n="suspendedStart";return function(a,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===a)throw o;return M()}for(t.method=a,t.arg=o;;){var i=t.delegate;if(i){var u=E(i,t);if(u){if(u===p)continue;return u}}if("next"===t.method)t.sent=t._sent=t.arg;else if("throw"===t.method){if("suspendedStart"===n)throw n="completed",t.arg;t.dispatchException(t.arg)}else"return"===t.method&&t.abrupt("return",t.arg);n="executing";var c=f(e,r,t);if("normal"===c.type){if(n=t.done?"completed":"suspendedYield",c.arg===p)continue;return{value:c.arg,done:t.done}}"throw"===c.type&&(n="completed",t.method="throw",t.arg=c.arg)}}}(e,t,i),o}function f(e,r,t){try{return{type:"normal",arg:e.call(r,t)}}catch(T){return{type:"throw",arg:T}}}e.wrap=l;var p={};function h(){}function d(){}function v(){}var m={};s(m,a,(function(){return this}));var b=Object.getPrototypeOf,y=b&&b(b(j([])));y&&y!==r&&t.call(y,a)&&(m=y);var g=v.prototype=h.prototype=Object.create(m);function w(e){["next","throw","return"].forEach((function(r){s(e,r,(function(e){return this._invoke(r,e)}))}))}function k(e,r){function n(a,o,i,c){var s=f(e[a],e,o);if("throw"!==s.type){var l=s.arg,p=l.value;return p&&"object"==u(p)&&t.call(p,"__await")?r.resolve(p.__await).then((function(e){n("next",e,i,c)}),(function(e){n("throw",e,i,c)})):r.resolve(p).then((function(e){l.value=e,i(l)}),(function(e){return n("throw",e,i,c)}))}c(s.arg)}var a;this._invoke=function(e,t){function o(){return new r((function(r,a){n(e,t,r,a)}))}return a=a?a.then(o,o):o()}}function E(e,r){var t=e.iterator[r.method];if(void 0===t){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=void 0,E(e,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var n=f(t,e.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,p;var a=n.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function S(e){var r={tryLoc:e[0]};1 in e&&(r.catchLoc=e[1]),2 in e&&(r.finallyLoc=e[2],r.afterLoc=e[3]),this.tryEntries.push(r)}function x(e){var r=e.completion||{};r.type="normal",delete r.arg,e.completion=r}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function j(e){if(e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function r(){for(;++n<e.length;)if(t.call(e,n))return r.value=e[n],r.done=!1,r;return r.value=void 0,r.done=!0,r};return o.next=o}}return{next:M}}function M(){return{value:void 0,done:!0}}return d.prototype=v,s(g,"constructor",v),s(v,"constructor",d),d.displayName=s(v,i,"GeneratorFunction"),e.isGeneratorFunction=function(e){var r="function"==typeof e&&e.constructor;return!!r&&(r===d||"GeneratorFunction"===(r.displayName||r.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,s(e,i,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},w(k.prototype),s(k.prototype,o,(function(){return this})),e.AsyncIterator=k,e.async=function(r,t,n,a,o){void 0===o&&(o=Promise);var i=new k(l(r,t,n,a),o);return e.isGeneratorFunction(t)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},w(g),s(g,i,"Generator"),s(g,a,(function(){return this})),s(g,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var r=[];for(var t in e)r.push(t);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=j,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!e)for(var r in this)"t"===r.charAt(0)&&t.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(t,n){return i.type="throw",i.arg=e,r.next=t,n&&(r.method="next",r.arg=void 0),!!n}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],i=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var u=t.call(o,"catchLoc"),c=t.call(o,"finallyLoc");if(u&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,r){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&t.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=r&&r<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=r,o?(this.method="next",this.next=o.finallyLoc,p):this.complete(i)},complete:function(e,r){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&r&&(this.next=r),p},finish:function(e){for(var r=this.tryEntries.length-1;r>=0;--r){var t=this.tryEntries[r];if(t.finallyLoc===e)return this.complete(t.completion,t.afterLoc),x(t),p}},catch:function(e){for(var r=this.tryEntries.length-1;r>=0;--r){var t=this.tryEntries[r];if(t.tryLoc===e){var n=t.completion;if("throw"===n.type){var a=n.arg;x(t)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,t){return this.delegate={iterator:j(e),resultName:r,nextLoc:t},"next"===this.method&&(this.arg=void 0),p}},e}function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,r){var t=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var n,a,o=[],i=!0,u=!1;try{for(t=t.call(e);!(i=(n=t.next()).done)&&(o.push(n.value),!r||o.length!==r);i=!0);}catch(c){u=!0,a=c}finally{try{i||null==t.return||t.return()}finally{if(u)throw a}}return o}}(e,t)||r(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,r){if(e&&r)return!Array.isArray(r)&&console.error(r),r.reduce((function(e,r){return null===e||void 0===e?void 0:e[r]}),e)}function f(e,r){return Object.fromEntries(e.map((function(e,t){return[e,r(e,t)]})))}function p(e,r){return Object.fromEntries(e.map((function(e){return r(e)})))}function h(e,r){return Object.fromEntries(Object.entries(e).map((function(e,t){var n=s(e,2),a=n[0],o=n[1];return[a,r(o,a,t)]})))}var d=c().mark((function e(r,t){var n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=r;case 1:if(!(n<=t)){e.next=7;break}return e.next=4,n;case 4:n++,e.next=1;break;case 7:case"end":return e.stop()}}),e)}));function v(e,r){return n(d(e,r))}function m(e){throw new Error("Should not reach this with value ".concat(e))}function b(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];return r.reduce((function(e,r){return e.flatMap((function(e){return r.map((function(r){return[e,[r]].flat()}))}))}),[[]])}y(NaN,{key:"TODO"}),g(1),g(0);function y(e,r){return{operation:"const",operands:[],value:e,info:r}}function g(e,r){return e>=Number.MAX_VALUE/100&&(e=1/0),e<=-Number.MAX_VALUE/100&&(e=-1/0),y(e,i({key:"_"},r))}function w(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];return{operation:"add",operands:S(r)}}function k(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];return{operation:"mul",operands:S(r)}}function E(e,r){return{operation:"read",operands:[],path:e,info:r,type:"number"}}function S(e){return e.map((function(e){return"object"===typeof e?e:y(e)}))}function x(e){return"object"!==typeof e?y(e):e}function O(e,r,t){var n=new Set,a=new Set;e.forEach((function e(o){a.has(o)||(n.has(o)?console.error("Found cyclical dependency during formula traversal"):(n.add(o),r(o),o.operands.forEach(e),t(o),n.delete(o),a.add(o)))}))}function j(e,r,t){var n=new Set,a=new Map,o=new Map;function u(e){var c=a.get(e);if(c)return c;c=r(e);var s=o.get(c);return s||(n.has(c)?(console.error("Found cyclical dependency during formula mapping"),y(NaN)):(n.add(c),s=t(function(e){var r=e.operands.map(u);return M(r,e.operands)?e:i(i({},e),{},{operands:r})}(c),e),n.delete(c),a.set(e,s),o.set(c,s),s))}var c=e.map(u);return M(c,e)?e:c}function M(e,r){return void 0===e?void 0===r:void 0!==r&&(e.length===r.length&&e.every((function(e,t){return e===r[t]})))}var T={min:function(e){return Math.min.apply(Math,n(e))},max:function(e){return Math.max.apply(Math,n(e))},add:function(e){return e.reduce((function(e,r){return e+r}),0)},mul:function(e){return e.reduce((function(e,r){return e*r}),1)}},P=i(i({},T),{},{res:function(e){var r=s(e,1)[0];return r<0?1-r/2:r>=.75?1/(4*r+1):1-r},sum_frac:function(e){return e[0]/e.reduce((function(e,r){return e+r}))},threshold:function(e){var r=s(e,4),t=r[0],n=r[1],a=r[2],o=r[3];return t>=n?a:o}});new Set(Object.keys(T));function B(e,r){var t=new Set,a=new Set,o=new Map;O(e,(function(e){}),(function(e){var n=e.operation;switch(n){case"read":if("number"!==e.type||e.accu&&"add"!==e.accu)throw new Error("Unsupported ".concat(n," node in precompute"));var i=r(e);t.add(i),o.set(e,i);break;case"add":case"min":case"max":case"mul":case"threshold":case"res":case"sum_frac":o.set(e,{ins:e.operands.map((function(e){return o.get(e)}))});break;case"const":if("number"!==typeof e.value)throw new Error("Found string constant while precomputing");var u=e.value;a.add(u),o.set(e,u);break;case"match":case"lookup":case"subscript":case"prio":case"small":case"data":throw new Error("Unsupported ".concat(n," node in precompute"));default:m(n)}}));var i=new Map,u=n(t),c=e.length,l=n(a),p=[];e.forEach((function(e,r){i.set(e,r),"const"===e.operation&&i.set(e.value,r)})),u.forEach((function(r,t){return i.set(r,t+e.length)}));var h=e.length+u.length;l.forEach((function(e){return i.has(e)||i.set(e,h++)})),o.forEach((function(e,r){"object"===typeof e?(i.has(r)||i.set(r,h++),p.push({out:i.get(r),ins:r.operands.map((function(e){return i.get(e)})),op:P[r.operation],buff:Array(r.operands.length).fill(0)})):i.set(r,i.get(e))}));var d=new Float64Array(h).fill(0);a.forEach((function(e){return d[i.get(e)]=e}));var v=e.map((function(e,r){var t=i.get(e);return t!==r?[t,r]:void 0})).filter((function(e){return e})),b=v.length?function(){v.forEach((function(e){var r=s(e,2),t=r[0],n=r[1];return d[n]=d[t]}))}:void 0;return[function(){return p.forEach((function(e){var r=e.out,t=e.ins,n=e.op,a=e.buff;t.forEach((function(e,r){return a[r]=d[e]})),d[r]=n(a)})),null===b||void 0===b||b(),d},f(u,(function(e,r){return c+r})),d]}function A(e,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return!1},o={data:[],processed:new Map},u=new Map([[o,new Map]]);function c(e,r){var f,p=r.processed.get(e);if(p)return p;var h,d=e.operation;switch(d){case"const":return e;case"add":case"mul":case"max":case"min":var v=P[d],b=[],g=e.operands.filter((function(e){var t=c(e,r);return"const"!==t.operation||(b.push(t.value),!1)})).map((function(e){return c(e,r)})),w=v(b);if(isFinite(w)){if("mul"===d&&0===w){h=y(w);break}}else if("mul"!==d&&("max"!==d||w>0)&&("min"!==d||w<0)){h=y(w);break}w!==v([])&&g.push(y(w)),h=g.length<=1?null!==(f=g[0])&&void 0!==f?f:y(v([])):{operation:d,operands:g};break;case"res":case"sum_frac":var k=e.operands.map((function(e){return c(e,r)})),E=P[d];h=k.every((function(e){return"const"===e.operation}))?y(E(k.map((function(e){return e.value})))):i(i({},e),{},{operands:k});break;case"lookup":var S=c(e.operands[0],r);if("const"===S.operation){var x,O=null!==(x=e.table[S.value])&&void 0!==x?x:e.operands[1];if(O){h=c(O,r);break}}throw new Error("Unsupported ".concat(d," node while folding"));case"prio":var j=e.operands.find((function(e){var t=c(e,r);if("const"!==t.operation)throw new Error("Unsupported ".concat(d," node while folding"));return void 0!==t.value}));h=j?c(j,r):y(void 0);break;case"small":var M,T,B=void 0,A=t(e.operands);try{for(A.s();!(T=A.n()).done;){var L,F=c(T.value,r);if("const"!==F.operation)throw new Error("Unsupported ".concat(d," node while folding"));(void 0===(null===(L=B)||void 0===L?void 0:L.value)||void 0!==F.value&&F.value<B.value)&&(B=F)}}catch(J){A.e(J)}finally{A.f()}h=null!==(M=B)&&void 0!==M?M:y(void 0);break;case"match":var N=s(e.operands.map((function(e){return c(e,r)})),4),D=N[0],C=N[1],I=N[2],_=N[3];if("const"!==D.operation||"const"!==C.operation)throw new Error("Unsupported ".concat(d," node while folding"));h=D.value===C.value?I:_;break;case"threshold":var R=s(e.operands.map((function(e){return c(e,r)})),4),G=R[0],H=R[1],V=R[2],W=R[3];h="const"===G.operation&&"const"===H.operation?G.value>=H.value?V:W:i(i({},e),{},{operands:[G,H,V,W]});break;case"subscript":var z=s(e.operands.map((function(e){return c(e,r)})),1)[0];h="const"===z.operation?y(e.list[z.value]):i(i({},e),{},{operands:[z]});break;case"read":var q=r.data.map((function(r){return l(r,e.path)})).filter((function(e){return e}));if(0===q.length)if(a(e)){var U=e.accu;h=void 0===U||"small"===U?"string"===e.type?y(void 0):y(NaN):y(P[U]([]))}else h=e;else h=void 0===e.accu||1===q.length?c(q[q.length-1],r):c({operation:e.accu,operands:q},r);break;case"data":e.reset&&(r=o);var Y=u.get(r),K=Y.get(e.data);K||(K={data:[].concat(n(r.data),[e.data]),processed:new Map},u.set(K,new Map),Y.set(e.data,K)),h=c(e.operands[0],K);break;default:m(d)}return r.processed.set(e,h),h}var f={data:[r],processed:new Map};return u.set(f,new Map),u.get(o).set(r,f),e.map((function(e){return c(e,f)}))}var L=["flower","plume","sands","goblet","circlet"],F=(["physical"].concat(["anemo","geo","electro","hydro","pyro","cryo"]),["Adventurer","ArchaicPetra","Berserker","BlizzardStrayer","BloodstainedChivalry","BraveHeart","CrimsonWitchOfFlames","DefendersWill","EchoesOfAnOffering","EmblemOfSeveredFate","Gambler","GladiatorsFinale","HeartOfDepth","HuskOfOpulentDreams","Instructor","Lavawalker","LuckyDog","MaidenBeloved","MartialArtist","NoblesseOblige","OceanHuedClam","PaleFlame","PrayersForDestiny","PrayersForIllumination","PrayersForWisdom","PrayersToSpringtime","ResolutionOfSojourner","RetracingBolide","Scholar","ShimenawasReminiscence","TenacityOfTheMillelith","TheExile","ThunderingFury","Thundersoother","TinyMiracle","TravelingDoctor","VermillionHereafter","ViridescentVenerer","WanderersTroupe"]),N=([].concat(["AmenomaKageuchi","AquilaFavonia","BlackcliffLongsword","CinnabarSpindle","CoolSteel","DarkIronSword","DullBlade","FavoniusSword","FesteringDesire","FilletBlade","FreedomSworn","HaranGeppakuFutsu","HarbingerOfDawn","IronSting","LionsRoar","MistsplitterReforged","PrimordialJadeCutter","PrototypeRancour","RoyalLongsword","SacrificialSword","SilverSword","SkyriderSword","SkywardBlade","SummitShaper","SwordOfDescension","TheAlleyFlash","TheBlackSword","TheFlute","TravelersHandySword"],["Akuoumaru","BlackcliffSlasher","BloodtaintedGreatsword","DebateClub","FavoniusGreatsword","FerrousShadow","KatsuragikiriNagamasa","LithicBlade","LuxuriousSeaLord","OldMercsPal","PrototypeArchaic","Rainslasher","RedhornStonethresher","RoyalGreatsword","SacrificialGreatsword","SerpentSpine","SkyriderGreatsword","SkywardPride","SnowTombedStarsilver","SongOfBrokenPines","TheBell","TheUnforged","WasterGreatsword","Whiteblind","WhiteIronGreatsword","WolfsGravestone"],["BeginnersProtector","BlackcliffPole","BlackTassel","CalamityQueller","CrescentPike","Deathmatch","DragonsBane","DragonspineSpear","EngulfingLightning","FavoniusLance","Halberd","IronPoint","KitainCrossSpear","LithicSpear","PrimordialJadeWingedSpear","PrototypeStarglitter","RoyalSpear","SkywardSpine","StaffOfHoma","TheCatch","VortexVanquisher","WavebreakersFin","WhiteTassel"],["AlleyHunter","AmosBow","AquaSimulacra","BlackcliffWarbow","CompoundBow","ElegyForTheEnd","FadingTwilight","FavoniusWarbow","Hamayumi","HuntersBow","Messenger","MitternachtsWaltz","MouunsMoon","PolarStar","Predator","PrototypeCrescent","RavenBow","RecurveBow","RoyalBow","Rust","SacrificialBow","SeasonedHuntersBow","SharpshootersOath","SkywardHarp","Slingshot","TheStringless","TheViridescentHunt","ThunderingPulse","WindblumeOde"],["ApprenticesNotes","BlackcliffAgate","DodocoTales","EmeraldOrb","EverlastingMoonglow","EyeOfPerception","FavoniusCodex","Frostbearer","HakushinRing","KagurasVerity","LostPrayerToTheSacredWinds","MagicGuide","MappaMare","MemoryOfDust","OathswornEye","OtherworldlyStory","PocketGrimoire","PrototypeAmber","RoyalGrimoire","SacrificialFragments","SkywardAtlas","SolarPearl","TheWidsith","ThrillingTalesOfDragonSlayers","TwinNephrite","WineAndSong"]),c().mark(R)),D=c().mark(H);function C(e,r){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=new Set,u=new Set;function c(e,r){r?o.add(e):e.operands.forEach((function(e){var r=e;o.has(r)&&u.add(r)}))}var l=new Set;if(O(e,(function(e){}),(function(e){var r=e.operation;switch(r){case"read":if("number"!==e.type||"dyn"!==e.path[0]||"add"!==e.accu)throw new Error("Found unsupported ".concat(r," node at path ").concat(e.path," when computing affine nodes"));l.add(e.path[1]),c(e,!0);break;case"add":c(e,e.operands.every((function(e){return o.has(e)})));break;case"mul":var t=e.operands.filter((function(e){return"const"!==e.operation}));c(e,0===t.length||1===t.length&&o.has(t[0]));break;case"const":if("string"===typeof e.value||void 0===e.value)throw new Error("Found constant ".concat(e.value," while compacting"));c(e,!0);break;case"res":case"threshold":case"sum_frac":case"max":case"min":c(e,!1);break;case"data":case"subscript":case"lookup":case"match":case"prio":case"small":throw new Error("Found unsupported ".concat(r," node when computing affine nodes"));default:m(r)}})),n(u).every((function(e){var r=e.operation;return"read"===r||"const"===r}))&&Object.keys(r.base).length===l.size)return{nodes:e,arts:r};var p=-1;function d(){for(;l.has("".concat(++p)););return"".concat(p)}e.forEach((function(e){return o.has(e)&&u.add(e)}));var v=n(u).filter((function(e){return"const"!==e.operation})),b=new Map(v.map((function(e){return[e,a||"read"!==e.operation||"dyn"!==e.path[0]?i(i({},E(["dyn","".concat(d())])),{},{accu:"add"}):e]})));function g(e){var r=A(n(b.keys()),{dyn:h(e,(function(e){return y(e)}))},(function(e){return!0}));return Object.fromEntries(n(b.values()).map((function(e,t){return[e.path[1],r[t].value]})))}for(var w={nodes:e=j(e,(function(e){var r;return null!==(r=b.get(e))&&void 0!==r?r:e}),(function(e){return e})),arts:{base:g(r.base),values:f(L,(function(e){return r.values[e].map((function(e){return{id:e.id,set:e.set,values:g(e.values)}}))}))}},k=Object.entries(g({})),S=0,x=Object.values(w.arts.values);S<x.length;S++){var M,T=x[S],P=t(T);try{for(P.s();!(M=P.n()).done;){var B,F=M.value.values,N=t(k);try{for(N.s();!(B=N.n()).done;){var D=s(B.value,2),C=D[0],I=D[1];F[C]-=I}}catch(_){N.e(_)}finally{N.f()}}}catch(_){P.e(_)}finally{P.f()}}return w}function I(e,r){return{base:e.base,values:f(L,(function(t){var n=r[t];switch(n.kind){case"id":return e.values[t].filter((function(e){return n.ids.has(e.id)}));case"exclude":return e.values[t].filter((function(e){return!n.sets.has(e.set)}));case"required":return e.values[t].filter((function(e){return n.sets.has(e.set)}))}}))}}function _(e){return L.reduce((function(r,t){return r*e.values[t].length}),1)}function R(e,r){var a,o,i,u,l,f,p;return c().wrap((function(c){for(;;)switch(c.prev=c.next){case 0:a=h(r.values,(function(e){return new Set(e.map((function(e){return e.set})))})),o=t(e),c.prev=2,o.s();case 4:if((i=o.n()).done){c.next=19;break}u=i.value,l=function(){var e=s(p[f],2),r=e[0],t=e[1],o=a[r];switch(t.kind){case"required":if(n(t.sets).every((function(e){return!o.has(e)})))return"continue|filter_loop";break;case"exclude":if(n(o).every((function(e){return t.sets.has(e)})))return"continue|filter_loop"}},f=0,p=Object.entries(u);case 8:if(!(f<p.length)){c.next=15;break}if("continue|filter_loop"!==l()){c.next=12;break}return c.abrupt("continue",17);case 12:f++,c.next=8;break;case 15:return c.next=17,u;case 17:c.next=4;break;case 19:c.next=24;break;case 21:c.prev=21,c.t0=c.catch(2),o.e(c.t0);case 24:return c.prev=24,o.f(),c.finish(24);case 27:case"end":return c.stop()}}),N,null,[[2,21,24,27]])}function G(e){return new Set(null!==e&&void 0!==e&&e.includes(2)?e.includes(4)?[0,1]:[0,1,4,5]:null!==e&&void 0!==e&&e.includes(4)?[0,1,2,3]:[0,1,2,3,4,5])}function H(e,r){var a,o,u,l,p,d,m,b,y,g,w,k,E,S,x,O;return c().wrap((function(j){for(;;)switch(j.prev=j.next){case 0:for(E=function(e){var r,u,s,l,f,p,h,d,m,b,y;return c().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:y=function(e){var r,a,s,l,p,h,d,m,b,E,S,x,O,j;return c().wrap((function(u){for(;;)switch(u.prev=u.next){case 0:r=f.length-e,a=[],s=[],l=[],p=0,h=t(o),u.prev=3,m=function(){var e=d.value,t=k[e],o=w[e];if(!t)return"continue";v(1,r).every((function(e){return!t.has(o+e)}))?l.push(e):t.has(o)?v(0,r).some((function(e){return!t.has(o+e)}))&&a.push(e):(p+=n(t).find((function(e){return e>o}))-o,s.push(e))},h.s();case 6:if((d=h.n()).done){u.next=12;break}if("continue"!==m()){u.next=10;break}return u.abrupt("continue",10);case 10:u.next=6;break;case 12:u.next=17;break;case 14:u.prev=14,u.t0=u.catch(3),h.e(u.t0);case 17:return u.prev=17,h.f(),u.finish(17);case 20:if(!(p>r)){u.next=22;break}return u.abrupt("return");case 22:if(e!==f.length){u.next=26;break}return u.next=25,i({},g);case 25:return u.abrupt("return");case 26:if(p!==r){u.next=47;break}b=t(s),u.prev=28,b.s();case 30:if((E=b.n()).done){u.next=38;break}return S=E.value,w[S]++,g[L[f[e]]]={kind:"required",sets:new Set([S])},u.delegateYield(y(e+1),"t1",35);case 35:w[S]--;case 36:u.next=30;break;case 38:u.next=43;break;case 40:u.prev=40,u.t2=u.catch(28),b.e(u.t2);case 43:return u.prev=43,b.f(),u.finish(43);case 46:return u.abrupt("return");case 47:x=0,O=[].concat(a,s);case 48:if(!(x<O.length)){u.next=57;break}return j=O[x],w[j]++,g[L[f[e]]]={kind:"required",sets:new Set([j])},u.delegateYield(y(e+1),"t3",53);case 53:w[j]--;case 54:x++,u.next=48;break;case 57:return g[L[f[e]]]={kind:"exclude",sets:new Set([].concat(s,l,a))},u.delegateYield(y(e+1),"t4",59);case 59:case"end":return u.stop()}}),u,null,[[3,14,17,20],[28,40,43,46]])},b=function(e){var n,a,i;return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e!==l.length){r.next=3;break}return r.delegateYield(y(0),"t0",2);case 2:return r.abrupt("return",r.t0);case 3:n=t(o),r.prev=4,i=c().mark((function r(){var t,n,o,i,u;return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t=a.value,!s.has(t)){r.next=3;break}return r.abrupt("return","continue");case 3:if(n=l[e].length,o=k[t],i=0,!o||o.has(n)){r.next=9;break}if(!((i=(null!==(u=v(n+1,5).find((function(e){return o.has(e)})))&&void 0!==u?u:6)-n)>m)){r.next=9;break}return r.abrupt("return","continue");case 9:return s.add(t),w[t]=l[e].length,l[e].forEach((function(e){return g[L[e]]={kind:"required",sets:new Set([t])}})),m-=i,r.delegateYield(b(e+1),"t0",14);case 14:m+=i,w[t]=0,s.delete(t);case 17:case"end":return r.stop()}}),r)})),n.s();case 7:if((a=n.n()).done){r.next=14;break}return r.delegateYield(i(),"t1",9);case 9:if("continue"!==r.t1){r.next=12;break}return r.abrupt("continue",12);case 12:r.next=7;break;case 14:r.next=19;break;case 16:r.prev=16,r.t2=r.catch(4),n.e(r.t2);case 19:return r.prev=19,n.f(),r.finish(19);case 22:case"end":return r.stop()}}),r,null,[[4,16,19,22]])},r=c().mark(b),u=c().mark(y),s=new Set,l=[],f=[],p=t(e);try{for(p.s();!(h=p.n()).done;)d=h.value,l.push([]),5===d?f.push(l.length-1):l[d].push(l.length-1)}catch(E){p.e(E)}finally{p.f()}return l=l.filter((function(e){return e.length})).sort((function(e,r){return r.length-e.length})),m=f.length,a.delegateYield(b(0),"t0",10);case 10:case"end":return a.stop()}}),a)},d=function(e,r){if(!v(r+1,4).some((function(r){return 5!==e[r]})))return(e=n(e))[r]=5,e.reduce((function(e,r){return 6*e+r}),0)},p=function(e,r,a){if(5!==e.length){var o,i=t(r);try{var c=function(){var t=o.value;p([].concat(n(e),[t]),r,a.filter((function(e){return e!==t})))};for(i.s();!(o=i.n()).done;)c()}catch(s){i.e(s)}finally{i.f()}p([].concat(n(e),[e.length]),new Set([].concat(n(r),[e.length])),[].concat(n(a),[e.length]))}else u.has(a.length)&&l.push(e)},a=c().mark(E),o=n(new Set(r)),u=G(e.rainbow),l=[],p([0],new Set([0]),[0]),m=function(e){var r,a=new Map,o=t(l);try{for(o.s();!(r=o.n()).done;){var i,u=r.value,c=d(u,e);void 0!==c&&a.set(c,(null!==(i=a.get(c))&&void 0!==i?i:new Set(u.slice(0,e)).size+1)-1)}}catch(v){o.e(v)}finally{o.f()}var f,p=t(a.entries());try{var h=function(){var r=s(f.value,2),t=r[0];if(0===r[1]){var a=n(l.find((function(r){return d(r,e)===t})));a[e]=5,l=l.filter((function(r){return d(r,e)!==t})),l.push(a)}};for(p.s();!(f=p.n()).done;)h()}catch(v){p.e(v)}finally{p.f()}},b=4;b>=0;b--)m(b);y={kind:"exclude",sets:new Set},g=f(L,(function(e){return y})),w=i(i({},h(e,(function(e){return 0}))),f(o,(function(e){return 0}))),k=h(e,G),S=t(l),j.prev=14,S.s();case 16:if((x=S.n()).done){j.next=21;break}return O=x.value,j.delegateYield(E(O),"t0",19);case 19:j.next=16;break;case 21:j.next=26;break;case 23:j.prev=23,j.t1=j.catch(14),S.e(j.t1);case 26:return j.prev=26,S.f(),j.finish(26);case 29:case"end":return j.stop()}}),D,null,[[14,23,26,29]])}f(L,(function(e){return{kind:"exclude",sets:new Set}}));function V(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function W(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function z(e,r,t){return r&&W(e.prototype,r),t&&W(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function q(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];return r.flat()}function U(){return b.apply(void 0,arguments).map((function(e){return e.reduce((function(e,r){var t;return e.coeff*=r.coeff,(t=e.terms).push.apply(t,n(r.terms)),e}),{coeff:1,terms:[]})}))}function Y(e){return[{coeff:e,terms:[]}]}function K(e){return[{coeff:1,terms:[e]}]}function J(e){var r=n(e);r.forEach((function(e){return e.terms.sort()})),r.sort((function(e,r){var t=e.terms,n=r.terms;if(t.length!==n.length)return t.length-n.length;for(var a=0;a<t.length;a++)if(t[a]!==n[a])return t[a]<n[a]?-1:1;return 0}));for(var t=function(e){var t,n,a=r[e].terms,o=r[e+1].terms;if(a.length!==o.length)return"continue";a.every((function(e,r){return e===o[r]}))&&(r[e].coeff=(null!==(t=r[e].coeff)&&void 0!==t?t:0)+(null!==(n=r[e+1].coeff)&&void 0!==n?n:0),r.splice(e+1,1))},a=r.length-2;a>=0;a--)t(a);return r}function X(e){var r=e.nodes,t=e.terms;return w.apply(void 0,n(t.map((function(e){var t=e.coeff,a=e.terms;return k.apply(void 0,[t].concat(n(a.map((function(e){return r[e]})))))}))))}function Q(e,r){for(var t=r.i,n=r.j,a=e[t][n],o=0;o<e.length;o++)if(o!==t)for(var i=0;i<e[0].length;i++)i!==n&&(e[o][i]-=e[t][i]*e[o][n]/a);for(var u=0;u<e.length;u++)u!==t&&(e[u][n]=-e[u][n]/a);for(var c=0;c<e[0].length;c++)c!==n&&(e[t][c]=e[t][c]/a);e[t][n]=1/a}function $(e){for(var r=e.length,t=e[0].length,n={i:-1,j:-1,cmp:1/0},a=0;a<t-1;a++)if(!(e[r-1][a]>=0)){for(var o=0;o<r-1;o++)if(e[o][a]>1e-5){var i=e[o][t-1]/e[o][a];i<n.cmp&&(n={i:o,j:a,cmp:i})}if(n.i<0)throw Error("UNBOUNDED FEASIBLE")}if(n.i<0)throw Error("NO PIVOTS (done)");return{i:n.i,j:n.j}}function Z(e){for(var r=e.length,t=e[0].length,n={i:-1,j:-1,cmp:1/0},a=0;a<r-1;a++)if(!(e[a][t-1]>=0)){for(var o=0;o<t-1;o++)if(e[a][o]<-1e-5){var i=e[a][t-1]/e[a][o];i<n.cmp&&(n={i:a,j:o,cmp:i})}if(n.i<0)throw Error("INFEASIBLE");return{i:n.i,j:n.j}}throw Error("NO PIVOTS (done)")}function ee(e,r,t){var n=s(B([e],(function(e){return e.path[1]})),3),a=n[0],o=n[1],i=n[2];he(r,o,i);var u=a()[0];return he(t,o,i),[u,a()[0]]}function re(e,r,t){var a=function e(r){switch(r.operation){case"add":return w.apply(void 0,n(r.operands.map((function(r){return e(r)}))));case"const":return y(-r.value);case"threshold":var t=s(r.operands,4),a=t[0],o=t[1],i=t[2],u=t[3];if("const"===i.operation&&"const"===u.operation&&i.value<=u.value)return c=a,l=o,f=-i.value,p=-u.value,{operation:"threshold",operands:[x(c),x(l),x(f),x(p)],info:h};throw console.log(r),Error("(res neg slope): threshold. Something went wrong.");default:throw console.log(r),Error("(res neg slope) Havent written logic to handle this")}var c,l,f,p,h}(e.operands[0]),o=s(ee(a,r,t),2),i=o[0],u=o[1],c=P.res,l=[c([-i]),c([-u])],f=l[0],p=l[1];return u>0&&i>-1.75?w(1,k(.5,a)):w((u*f-i*p)/(u-i),k((f-p)/(u-i),a))}function te(e,r,t){var o=e.nodes,i=e.terms,u={};Object.entries(o).forEach((function(e){var r=s(e,2),t=r[0],n=r[1];"read"===n.operation&&(u[n.path[1]]=t)}));function c(e){switch(e.operation){case"const":return Y(e.value);case"read":return K(u[e.path[1]]);case"add":return q.apply(void 0,n(e.operands.map(c)));case"mul":return U.apply(void 0,n(e.operands.map(c)));case"threshold":var a=s(e.operands,4),o=a[0],i=a[1],l=a[2],f=a[3];if("read"===o.operation&&"const"===i.operation&&"const"===f.operation&&"const"===l.operation){if(l.value<f.value)throw console.log(e),Error("Not Implemented (threshold must be increasing)");var p=o.path[1];if(r[p]>=i.value)return Y(l.value);if(t[p]<i.value)return Y(f.value);var h=U(Y((l.value-f.value)/(i.value-r[p])),K(u[o.path[1]]));return 0===f.value?h:q(Y(f.value),h)}throw console.log(e),Error("Not Implemented (threshold must branch between constants)");case"res":return c(re(e,r,t));case"min":case"max":var d=s(e.operands,2),v=d[0],m=d[1];if("const"!==m.operation){var b=[m,v];v=b[0],m=b[1]}if("min"===e.operation)return c(v);if("const"===m.operation){var y=m.value,g=s(ee(v,r,t),2),w=g[0],k=g[1];if(w>y)return c(v);if(y>k)return Y(y);var E=(k-y)/(k-w);return q(Y(y-w),U(Y(E),c(v)))}throw console.log(e),Error("Not Implemented (max between two non-constants)");case"sum_frac":var S=s(e.operands,2),x=S[0],O=S[1];if("const"!==O.operation)throw Error("Not Implemented (non-constant sum_frac denominator)");var j=s(ee(x,r,t),2),M=j[0],T=j[1],P=O.value,B=Math.sqrt((M+P)*(T+P))-P,A=(P+B)*(P+B),L=P/A;return q(Y(B*B/A),U(Y(L),c(x)));default:throw console.log(e),Error("Not Implemented")}}var l=Object.fromEntries(Object.entries(o).filter((function(e){var r=s(e,2);r[0];return"read"!==r[1].operation})).map((function(e){var r=s(e,2);return[r[0],c(r[1])]}))),f=i.flatMap((function(e){var r=e.coeff,t=e.terms;return U.apply(void 0,[Y(r)].concat(n(t.map((function(e){var r;return null!==(r=l[e])&&void 0!==r?r:K(e)})))))}));f=(f=J(f)).map((function(e){var r=e.coeff,t=e.terms;return{coeff:r,terms:t=t.map((function(e){var r=o[e];if(!r||"read"!==r.operation)throw Error("MUST be a read node.");return r.path[1]}))}}));var p=f.map((function(e){var o=e.coeff,i=e.terms;if(0===i.length)return{w:{},c:o,err:0};if(1===i.length)return{w:a({},i[0],o),c:0,err:0};var u=function(e){if(0===e.length)return{w:[],c:0,err:0};var r=e.length,t=e.map((function(e){return e.upper})),a=t.reduce((function(e,r){return e*r}),1);e=e.map((function(e){return{lower:e.lower/e.upper,upper:1}}));var o,i=b.apply(void 0,n(e.map((function(e){return[e.lower,e.upper]})))).flatMap((function(e){var r=e.reduce((function(e,r){return e*r}),1);return[[].concat(n(e.map((function(e){return-e}))),[1,0,-r]),[].concat(n(e),[-1,-1,r])]})),u=[].concat(n(e.map((function(e){return 0}))),[0,1]);try{o=function(e,r){var t=r.length+1,n=r[0].length,a=Array(t).fill(0).map((function(e){return Array(n).fill(0)}));r.forEach((function(e,r){return e.forEach((function(e,t){return a[r][t]=e}))})),e.forEach((function(e,r){return a[t-1][r]=e}));for(var o=[];a.some((function(e,r){return r<t-1&&e[n-1]<0}));){var i=Z(a);o.push(i),Q(a,i)}for(;a[t-1].some((function(e,r){return r<n-1&&e<0}));){var u=$(a);o.push(u),Q(a,u)}return e.map((function(e,r){return function(e,r,t){var n=1;r.forEach((function(e){var r=e.i,a=e.j;1===n&&a===t?(t=r,n=0):0===n&&r===t&&(t=a,n=1)}));var a=e[0].length;return 0===n?e[t][a-1]:0}(a,o,r)}))}(u,i)}catch(c){throw console.log("ERROR on bounds",e),console.log("Possibly numerical instability issue."),c}return{w:o.slice(0,r).map((function(e,r){return e*a/t[r]})),c:-a*o[r],err:a*o[r+1]}}(i.map((function(e){return{lower:r[e],upper:t[e]}}))),c=u.w,s=u.c,l=u.err;return{w:c.reduce((function(e,r,t){var n;return e[i[t]]=r*o+(null!==(n=e[i[t]])&&void 0!==n?n:0),e}),{}),c:o*s,err:o*l+0}}));return p.reduce((function(e,r){return e.c+=r.c,e.err+=r.err,Object.entries(r.w).forEach((function(r){var t,n=s(r,2),a=n[0],o=n[1];return e.w[a]=o+(null!==(t=e.w[a])&&void 0!==t?t:0)})),e}),{w:{},c:0,err:0})}function ne(e,r){return oe([r],[e.base])[0]+r.c+Object.entries(e.values).reduce((function(e,t){var n=s(t,2),a=(n[0],n[1]);return e+oe([r],a.map((function(e){return e.values})))[0]}),0)}function ae(e,r){return r.map((function(r){return e.map((function(e){var t=e.w;return Object.entries(t).reduce((function(e,t){var n,a=s(t,2),o=a[0];return e+a[1]*(null!==(n=r[o])&&void 0!==n?n:0)}),0)}))}))}function oe(e,r){return e.map((function(e){var t=e.w;return Math.max.apply(Math,n(r.map((function(e){return Object.entries(t).reduce((function(r,t){var n,a=s(t,2),o=a[0];return r+a[1]*(null!==(n=e[o])&&void 0!==n?n:0)}),0)}))))}))}function ie(e){if(1===e.length)return e[0];var r=(e=e.flatMap((function(e){return"add"===e.operation?e.operands:e}))).reduce((function(e,r){return"const"===r.operation?e+r.value:e}),0);return 0===(e=e.filter((function(e){return"const"!==e.operation}))).length?y(r):0===r?w.apply(void 0,n(e)):w.apply(void 0,n(e).concat([y(r)]))}function ue(e){if(1===e.length)return e[0];var r=(e=e.flatMap((function(e){return"mul"===e.operation?e.operands:e}))).reduce((function(e,r){return"const"===r.operation?e*r.value:e}),1);return 0===(e=e.filter((function(e){return"const"!==e.operation}))).length?y(r):1===r?k.apply(void 0,n(e)):k.apply(void 0,n(e).concat([y(r)]))}function ce(e){if(0===e.length)return{statsMin:{},statsMax:{}};var r=Object.keys(e[0].values),t={},n={},a=new Set;r.forEach((function(e){t[e]=1/0,n[e]=-1/0}));for(var o=0;o<e.length;o++){for(var i=0;i<r.length;i++){var u=r[i];t[u]=Math.min(e[o].values[u],t[u]),n[u]=Math.max(e[o].values[u],n[u])}e[o].set&&a.add(e[o].set)}if(a.forEach((function(e){n[e]=1,t[e]=0})),1===a.size){var c=s(a,1)[0];t[c]=1}return{statsMin:t,statsMax:n}}function se(e){var r=i({},e.base),t=i({},e.base);return Object.entries(e.values).forEach((function(e){var n=s(e,2),a=(n[0],ce(n[1])),o=a.statsMin,i=a.statsMax;Object.keys(o).forEach((function(e){var n,a;r[e]=o[e]+(null!==(n=r[e])&&void 0!==n?n:0),t[e]=i[e]+(null!==(a=t[e])&&void 0!==a?a:0)}))})),{statsMin:r,statsMax:t}}function le(e,r,t){var n=Object.keys(r).filter((function(e){return r[e]===t[e]}));return j(e,(function(e){return e}),(function(e){switch(e.operation){case"add":return ie(e.operands);case"mul":return ue(e.operands);case"read":return n.includes(e.path[1])?y(r[e.path[1]]):e;case"threshold":var a=s(e.operands,4),o=a[0],i=a[1],u=a[2],c=a[3];if("const"===o.operation&&"const"===i.operation)return o.value>=i.value?u:c;if("read"===o.operation&&"const"===i.operation){if(r[o.path[1]]>=i.value)return u;if(t[o.path[1]]<i.value)return c}return e;case"min":case"max":case"res":case"sum_frac":return e.operands.every((function(e){return"const"===e.operation}))?y(P[e.operation](e.operands.map((function(e){return"const"===e.operation?e.value:NaN})))):e;default:return e}}))}function fe(e,r,t){var n=Object.keys(r).filter((function(e){return r[e]===t[e]}));return e.map((function(e){var a=e.nodes,o=e.terms,i=Object.entries(a),u=j(i.map((function(e){var r=s(e,2);r[0];return r[1]})),(function(e){return e}),(function(e){switch(e.operation){case"read":return n.includes(e.path[1])?y(r[e.path[1]]):e;case"threshold":var a=s(e.operands,4),o=a[0],i=a[1],u=a[2],c=a[3];if("const"===o.operation&&"const"===i.operation)return o.value>=i.value?u:c;if("read"!==o.operation||"const"!==i.operation)throw Error("Branch between non-read and non-const!!!");return r[o.path[1]]>=i.value?u:t[o.path[1]]<i.value?c:e;case"add":return ie(e.operands);case"mul":return ue(e.operands);case"res":case"sum_frac":return e.operands.every((function(e){return"const"===e.operation}))?y(P[e.operation](e.operands.map((function(e){return"const"===e.operation?e.value:NaN})))):e;case"min":case"max":return e.operands.every((function(e){return"const"===e.operation}))?y(P[e.operation](e.operands.map((function(e){return"const"===e.operation?e.value:NaN})))):e;default:return e}})),c={};u.forEach((function(e,r){if("const"===e.operation){var t=s(i[r],1)[0];c[t]=e.value}}));var l=o.map((function(e){var r=e.coeff,t=e.terms.filter((function(e){return void 0===c[e]||(r*=c[e],!1)}));return 0===r?{coeff:0,terms:[]}:{coeff:r,terms:t}})),f=Object.fromEntries(u.map((function(e,r){return[i[r][0],e]})));return Object.keys(c).forEach((function(e){return delete f[e]})),{nodes:f,terms:J(l)}}))}function pe(e){var r=e.f,t=e.a,n=e.cachedCompute;if(void 0===r)return i({maxEst:n.lin.map((function(e){return ne(t,e)}))},n);var a=n.lower,o=n.upper,u=r.map((function(e){var r=te(e,a,o);return{maxEst:ne(t,r),lin:r}}));return{maxEst:u.map((function(e){return e.maxEst})),lin:u.map((function(e){return e.lin})),lower:a,upper:o}}function he(e,r,t){Object.entries(e).filter((function(e){var t=s(e,1)[0];return void 0!==r[t]})).forEach((function(e){var n=s(e,2),a=n[0],o=n[1];return t[r[a]]=o}))}var de,ve,me,be=function(){function e(r,t){var n=this,a=r.arts,o=r.optimizationTarget,u=r.filters,c=r.plotBase,s=r.maxBuilds;V(this,e),this.builds=[],this.buildValues=[],this.plotData=void 0,this.plotBase=void 0,this.threshold=-1/0,this.maxBuilds=void 0,this.min=void 0,this.arts=void 0,this.nodes=void 0,this.callback=void 0,this.interimReport=function(e){n.refresh(!1),n.callback(i({command:"interim",buildValues:n.buildValues},e)),n.buildValues=[],e.tested=0,e.failed=0,e.skipped=0},this.arts=a,this.min=u.map((function(e){return e.min})),this.maxBuilds=s,this.callback=t,this.nodes=u.map((function(e){return e.value})),this.nodes.push(o),c&&(this.plotData={},this.plotBase=c,this.nodes.push(c))}return z(e,[{key:"compute",value:function(e,r){this.threshold<e&&(this.threshold=e);r.optimizationTarget;var a=r.constraints,o=r.filter,i=r.artSetExclusion,u=(r.depth,this.interimReport),c=this,l=I(this.arts,o),f=_(l);if(!(r.cache&&r.cachedCompute.maxEst[r.cachedCompute.maxEst.length-1]<this.threshold)){var p=n(this.nodes),h=n(this.min);void 0!==this.plotBase&&p.push(this.plotBase);var d=se(l),v=d.statsMin,m=d.statsMax,b=C(p=le(p,v,m),l);p=b.nodes,l=b.arts;for(var y=B(p,(function(e){return e.path[1]})),g=s(y,3),w=g[0],k=g[1],E=g[2],S=Object.values(l.values).sort((function(e,r){return e.length-r.length})).map((function(e){return e.map((function(e){return{id:e.id,set:e.set,values:Object.entries(e.values).map((function(e){var r=s(e,2),t=r[0],n=r[1];return{key:k[t],value:n,cache:0}})).filter((function(e){var r=e.key,t=e.value;return void 0!==r&&0!==t}))}}))})),x=Array(S.length).fill(""),O={tested:0,failed:0,skipped:f-_(l)},j=-1/0,M=0,T=Object.entries(l.base);M<T.length;M++){var P=s(T[M],2),A=P[0],L=P[1],F=k[A];void 0!==F&&(E[F]=L)}return N(S.length-1,{}),this.interimReport(O),this.threshold}function N(e,r){if(e<0){var o=w();j=Math.max(o[a.length],j);var l=Object.entries(i).every((function(e){var t=s(e,2),n=t[0];return!t[1].includes(r[n])}));if(l&&void 0!==i.uniqueKey){var f=Object.values(r).reduce((function(e,r){return e+r%2}),0);l=!i.uniqueKey.includes(f)}if(l&&h.every((function(e,r){return e<=o[r]}))){var p,d=o[h.length],v=c.builds,m=c.plotData;if(d>=c.threshold&&(p={value:d,artifactIds:n(x)},v.push(p),c.buildValues.push(d)),m){var b=o[h.length+1];(!m[b]||m[b].value<d)&&(p||(p={value:d,artifactIds:n(x)}),p.plot=b,m[b]=p)}}else O.failed+=1}else S[e].forEach((function(n){var a,o,i,u,c,s;x[e]=n.id;var l,f=t(n.values);try{for(f.s();!(l=f.n()).done;){var p=l.value,h=p.key,d=p.value;p.cache=E[h],E[h]+=d}}catch(w){f.e(w)}finally{f.f()}r[null!==(a=n.set)&&void 0!==a?a:""]=1+(null!==(o=r[null!==(i=n.set)&&void 0!==i?i:""])&&void 0!==o?o:0),N(e-1,r),r[null!==(u=n.set)&&void 0!==u?u:""]-=1,0===r[null!==(c=n.set)&&void 0!==c?c:""]&&delete r[null!==(s=n.set)&&void 0!==s?s:""];var v,m=t(n.values);try{for(m.s();!(v=m.n()).done;){var b=v.value,y=b.key,g=b.cache;E[y]=g}}catch(w){m.e(w)}finally{m.f()}})),0===e&&(O.tested+=S[0].length,O.tested>8192&&u(O))}this.interimReport({tested:0,failed:0,skipped:f})}},{key:"refresh",value:function(e){var r,a=this.maxBuilds;Object.keys(null!==(r=this.plotData)&&void 0!==r?r:{}).length>=1e5&&(this.plotData=function(e){for(var r=.01,a=new Set(e.flatMap((function(e){return Object.values(e).map((function(e){return Math.round(e.plot/r)}))})));a.size>1500;)r*=2,a=new Set(n(a).map((function(e){return Math.round(e/2)})));var o,i={},u=t(e);try{for(u.s();!(o=u.n()).done;)for(var c=o.value,s=0,l=Object.values(c);s<l.length;s++){var f=l[s],p=Math.round(f.plot/r)*r;(!i[p]||i[p].value<f.value)&&(i[p]=f)}}catch(h){u.e(h)}finally{u.f()}return i}([this.plotData])),this.builds=this.builds.sort((function(e,r){return r.value-e.value})).slice(0,a)}}]),e}(),ye=function(){function e(r,t){var n=r.arts,a=r.optimizationTarget,o=r.filters,i=r.artSetExclusion;V(this,e),this.min=void 0,this.arts=void 0,this.nodes=void 0,this.artSet=void 0,this.subproblems=[],this.callback=void 0,this.arts=n,this.min=o.map((function(e){return e.min})),this.nodes=o.map((function(e){return e.value})),this.callback=t,this.min.push(-1/0),this.nodes.push(a),this.artSet=p(Object.entries(i),(function(e){var r=s(e,2),t=r[0],n=r[1];return"rainbow"===t?["uniqueKey",n.map((function(e){return e+1}))]:[t,n.flatMap((function(e){return 2===e?[2,3]:[4,5]}))]}))}return z(e,[{key:"addSubProblem",value:function(e){var r=_(I(this.arts,e.filter));if(0!==r){var t=e.cache?e.cachedCompute.maxEst[e.cachedCompute.maxEst.length-1]:0;this.subproblems.push({count:r,heur:t,subproblem:e})}}},{key:"split",value:function(e){var r=this,t=e.threshold,n=e.minCount,a=e.maxIter,o=e.subproblem;t>this.min[this.min.length-1]&&(this.min[this.min.length-1]=t),o&&this.addSubProblem(o);for(var i=this.subproblems.reduce((function(e,r){return e+r.count}),0),u=0;u<a&&this.subproblems.length;){u+=1;var c=this.subproblems.pop(),s=c.count,l=c.subproblem;if(s<=n){var f=this.subproblems.reduce((function(e,r){return e+r.count}),0)+s;return this.callback({command:"interim",tested:0,failed:0,skipped:i-f,buildValues:void 0}),[l]}this.splitBNB(this.min[this.min.length-1],l).forEach((function(e){return r.addSubProblem(e)}))}var p=this.subproblems.reduce((function(e,r){return e+r.count}),0);return this.callback({command:"interim",tested:0,failed:0,skipped:i-p,buildValues:void 0}),[]}},{key:"popOne",value:function(){if(0!==this.subproblems.length){for(var e={i:-1,heur:-1/0},r=1;r<this.subproblems.length;r++){var t=this.subproblems[r],n=t.heur;t.subproblem;n>e.heur&&(e={i:r,heur:n})}if(!(e.i<0))return this.subproblems.splice(e.i,1)[0].subproblem}}},{key:"splitBNB",value:function(e,r){var t=I(this.arts,r.filter);if(!1===r.cache){var a=se(t),o=a.statsMin,u=a.statsMax,c=ge(r,o,u);if(void 0===c)return[];var l=pe({f:[].concat(n(c.constraints.map((function(e){return e.value}))),[c.optimizationTarget]),a:t,cachedCompute:{lower:o,upper:u}});if(c.constraints.some((function(e,r){var t=e.min;return l.maxEst[r]<t})))return[];if(l.maxEst[l.maxEst.length-1]<e)return[];r=i(i({},c),{},{cache:!0,cachedCompute:l})}var h=r.cachedCompute,d=h.maxEst,v=h.lin;if(d[d.length-1]<=e)return[];var m=function(e,r,t){var a=t.constraints,o=t.cachedCompute.lin,u=(t.artSetExclusion,oe(o,[e.base])),c=oe(o,[e.base]);Object.entries(e.values).forEach((function(e){var r=s(e,2),t=(r[0],r[1]),a=ae(o,t.map((function(e){return e.values})));u.forEach((function(e,r){c[r]+=Math.max.apply(Math,n(a.map((function(e){return e[r]})))),u[r]+=Math.min.apply(Math,n(a.map((function(e){return e[r]}))))}))}));for(var l=[].concat(n(a.map((function(e){return e.min}))),[r]).map((function(e,r){return(e-u[r])/(c[r]-u[r])})),f=-1,p=l.length-1;p>=0;p--)0!==Object.keys(o[p].w).length&&(f<0&&(f=p),l[f]<.5||l[p]>l[f]&&(f=p));if(f<0)return we(e,t);var h=o[f],d=Object.keys(h.w),v={k:"",heur:-1};if(d.forEach((function(r){var t=Object.entries(e.values).reduce((function(e,t){var a=s(t,2),o=(a[0],a[1].map((function(e){return e.values[r]}))),i=Math.min.apply(Math,n(o)),u=Math.max.apply(Math,n(o));if(i===u)return e;var c=(i+u)/2,l=Math.max.apply(Math,n(o.filter((function(e){return e<=c})))),f=Math.min.apply(Math,n(o.filter((function(e){return e>c}))));return e+Math.min(u-l,f-i)}),0),a=h.w[r]*t;a>v.heur&&(v={k:r,heur:a})})),""===v.k)throw console.log(t,ge(t,t.cachedCompute.lower,t.cachedCompute.upper,!0)),console.log("===================== SHATTER BROKE ====================",o,e),Error("Shatter broke...");var m=Object.fromEntries(Object.entries(e.values).map((function(e){var r=s(e,2),t=r[0],a=r[1].map((function(e){return e.values[v.k]}));return[t,(Math.min.apply(Math,n(a))+Math.max.apply(Math,n(a)))/2]}))),b=Object.fromEntries(Object.entries(e.values).map((function(e){var r=s(e,2),t=r[0],n=r[1],a=n.filter((function(e){return e.values[v.k]<m[t]})),u=n.filter((function(e){return!(e.values[v.k]<m[t])})),c=[a,u],l=[oe(o,a.map((function(e){return e.values}))),oe(o,u.map((function(e){return e.values})))];return[t,[0,1].filter((function(e){return c[e].length>0})).map((function(e){return i(i({arts:c[e]},ce(c[e])),{},{ww:l[e]})}))]})));return b}(t,e,r),y=oe(v,[t.base]).map((function(e,r){return e+v[r].c})),g=[];return b(m.flower,m.plume,m.sands,m.goblet,m.circlet).forEach((function(a){var o=s(a,5),u={flower:o[0],plume:o[1],sands:o[2],goblet:o[3],circlet:o[4]},c={base:i({},t.base),values:p(Object.entries(u),(function(e){var r=s(e,2);return[r[0],r[1].arts]}))},l=Object.values(c.values).reduce((function(e,r){return e*r.length}),1);if(0!==l){var h=n(y);if(Object.values(u).forEach((function(e){return e.ww.forEach((function(e,r){return h[r]+=e}))})),!r.constraints.some((function(e,r){var t=e.min;return h[r]<t}))&&!(h[h.length-1]<e)){var d=i({},t.base),v=i({},t.base);Object.values(u).forEach((function(e){var r=e.statsMin,t=e.statsMax;Object.entries(r).forEach((function(e){var r,t=s(e,2),n=t[0],a=t[1];return d[n]=a+(null!==(r=d[n])&&void 0!==r?r:0)})),Object.entries(t).forEach((function(e){var r,t=s(e,2),n=t[0],a=t[1];return v[n]=a+(null!==(r=v[n])&&void 0!==r?r:0)}))}));var m=ge(r,d,v);if(void 0!==m){var b=[].concat(n(m.constraints.map((function(e){return e.value}))),[m.optimizationTarget]),w=pe({a:c,f:b,cachedCompute:{lower:d,upper:v}});if(!m.constraints.some((function(e,r){var t=e.min;return w.maxEst[r]<t}))&&!(w.maxEst[w.maxEst.length-1]<e)){var k=f(L,(function(e){return{kind:"id",ids:new Set(c.values[e].map((function(e){return e.id})))}}));g.push({numBuilds:l,heur:w.maxEst[w.maxEst.length-1]-w.lin[w.lin.length-1].err,subproblem:i(i({},m),{},{filter:k,cache:!0,cachedCompute:w,depth:m.depth+1})})}}}}})),g.sort((function(e,r){return r.heur-e.heur})),g.map((function(e){return e.subproblem}))}}]),e}();function ge(e,r,t){var a=e.optimizationTarget,o=e.constraints,i=e.artSetExclusion,u=e.filter,c=e.depth,l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],f=[].concat(n(o.map((function(e){return e.value}))),[a]),p=o.map((function(e){return e.min}));f=fe(f,r,t);var h=B(o.map((function(e){return X(e.value)})),(function(e){return e.path[1]})),d=s(h,3),m=d[0],b=d[1],y=d[2];he(r,b,y);var g=m(),w=p.map((function(e,r){return e>g[r]})),k=f.pop(),E=f.map((function(e,r){return{value:e,min:p[r]}})).filter((function(e,r){return w[r]}));l&&console.log("reduceSubP",{statsMin:r,subnodes:f,submin:p,result:g,active:w});for(var S={},x=function(){var e=s(j[O],2),n=e[0],a=e[1];if("uniqueKey"===n){S[n]=a;var o=F.filter((function(e){return t[e]>0})),u=0,c=0;if(o.forEach((function(e){var n=v(r[e],t[e]);i[e]&&(n=n.filter((function(r){return!i[e].includes(r)}))),(n.includes(4)||n.includes(5))&&u++,(n.includes(2)||n.includes(3))&&c++})),a.includes(5)&&0===u){if(0===c)return{v:void 0};if(a.includes(3)&&c<2)return{v:void 0}}return"continue"}var l=a.filter((function(e){return r[n]<=e&&e<=t[n]}));if(l.includes(r[n])&&l.includes(t[n]))return{v:void 0};l.length>0&&(S[n]=l)},O=0,j=Object.entries(i);O<j.length;O++){var M=x();if("continue"!==M&&"object"===typeof M)return M.v}return{cache:!1,optimizationTarget:k,constraints:E,artSetExclusion:S,filter:u,depth:c}}function we(e,r){var t=r.artSetExclusion,a=r.cachedCompute,o=a.lin,u=a.upper,c=F.filter((function(e){return u[e]>0})),l={k:void 0,cnt:-1};c.forEach((function(e){var r=u[e];t[e]&&t[e].includes(r)&&(r=Math.min.apply(Math,n(t[e]))-1),r>l.cnt&&(l={k:e,cnt:r})}));var f=l.k;return Object.fromEntries(Object.entries(e.values).map((function(e){var r=s(e,2),t=r[0],n=r[1],a=n.filter((function(e){return e.set===f})),u=n.filter((function(e){return e.set!==f})),c=[a,u],l=[oe(o,a.map((function(e){return e.values}))),oe(o,u.map((function(e){return e.values})))];return[t,[0,1].filter((function(e){return c[e].length>0})).map((function(e){return i(i({arts:c[e]},ce(c[e])),{},{ww:l[e]})}))]})))}onmessage=function(e){var r,a=e.data,o=a.command;switch(o){case"setup":de=a.id;var u=function(e){return postMessage(i({id:de},e))};ve=new ye(a,u),me=new be(a,u),r={command:"iterate"};break;case"split":r={command:"split",subproblems:ve.split(a),ready:0===ve.subproblems.length};break;case"iterate":var c=a.threshold,s=a.subproblem;me.compute(c,s),r={command:"iterate"};break;case"finalize":me.refresh(!0);var l=me,f=l.builds,p=l.plotData;r={command:"finalize",builds:f,plotData:p};break;case"count":if("break"===function(){var e,o=a.exclusion,i=me.arts,u=R(H(o,n(new Set(Object.values(i.values).flatMap((function(e){return e.map((function(e){return e.set}))}))))),i),c=a.arts.map((function(e){return 0})),s=t(u);try{var l=function(){var r=e.value;a.arts.forEach((function(e,t){return c[t]+=_(I(e,r))}))};for(s.s();!(e=s.n()).done;)l()}catch(f){s.e(f)}finally{s.f()}return r={command:"count",counts:c},"break"}())break;case"share":var h=ve.popOne();r={command:"share",subproblem:h,sender:a.sender};break;default:m(o)}postMessage(i({id:de},r))}}();
//# sourceMappingURL=BackgroundWorker.56afc2e0.worker.js.map