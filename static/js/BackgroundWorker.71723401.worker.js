!function(){"use strict";function r(r,e,n){return e in r?Object.defineProperty(r,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):r[e]=n,r}function e(r,e){var n=Object.keys(r);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(r);e&&(t=t.filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.push.apply(n,t)}return n}function n(n){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?e(Object(o),!0).forEach((function(e){r(n,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):e(Object(o)).forEach((function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(o,r))}))}return n}function t(r,e){(null==e||e>r.length)&&(e=r.length);for(var n=0,t=new Array(e);n<e;n++)t[n]=r[n];return t}function o(r,e){if(r){if("string"===typeof r)return t(r,e);var n=Object.prototype.toString.call(r).slice(8,-1);return"Object"===n&&r.constructor&&(n=r.constructor.name),"Map"===n||"Set"===n?Array.from(r):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?t(r,e):void 0}}function a(r){return function(r){if(Array.isArray(r))return t(r)}(r)||function(r){if("undefined"!==typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}(r)||o(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(r,e){return function(r){if(Array.isArray(r))return r}(r)||function(r,e){var n=null==r?null:"undefined"!==typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=n){var t,o,a=[],i=!0,u=!1;try{for(n=n.call(r);!(i=(t=n.next()).done)&&(a.push(t.value),!e||a.length!==e);i=!0);}catch(s){u=!0,o=s}finally{try{i||null==n.return||n.return()}finally{if(u)throw o}}return a}}(r,e)||o(r,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(r,e){if(r&&e)return!Array.isArray(e)&&console.error(e),e.reduce((function(r,e){return null===r||void 0===r?void 0:r[e]}),r)}function s(r,e){return Object.fromEntries(r.map((function(r,n){return[r,e(r,n)]})))}function c(r){throw new Error("Should not reach this with value ".concat(r))}function l(){for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return e.reduce((function(r,e){return r.flatMap((function(r){return e.map((function(e){return[r,[e]].flat()}))}))}),[[]])}function f(r,e){var n="undefined"!==typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!n){if(Array.isArray(r)||(n=o(r))||e&&r&&"number"===typeof r.length){n&&(r=n);var t=0,a=function(){};return{s:a,n:function(){return t>=r.length?{done:!0}:{done:!1,value:r[t++]}},e:function(r){throw r},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,s=!1;return{s:function(){n=n.call(r)},n:function(){var r=n.next();return u=r.done,r},e:function(r){s=!0,i=r},f:function(){try{u||null==n.return||n.return()}finally{if(s)throw i}}}}function p(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function d(r,e){for(var n=0;n<e.length;n++){var t=e[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(r,t.key,t)}}function h(r,e,n){return e&&d(r.prototype,e),n&&d(r,n),Object.defineProperty(r,"prototype",{writable:!1}),r}v(NaN,{key:"TODO"}),m(1),m(0);function v(r,e){return{operation:"const",operands:[],value:r,info:e}}function m(r,e){return r>=Number.MAX_VALUE/100&&(r=1/0),r<=-Number.MAX_VALUE/100&&(r=-1/0),v(r,n({key:"_"},e))}function b(){for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return{operation:"add",operands:w(e)}}function g(){for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return{operation:"mul",operands:w(e)}}function y(r,e,n,t,o){return{operation:"threshold",operands:[S(r),S(e),S(n),S(t)],info:o}}function w(r){return r.map((function(r){return"object"===typeof r?r:v(r)}))}function S(r){return"object"!==typeof r?v(r):r}function E(r,e){if(r.operation!==e.operation)return!1;if(r.operands.length!==e.operands.length)return!1;switch(r.operation){case"read":return e.operation===r.operation&&r.path.every((function(r,n){return r===e.path[n]}));case"const":return e.operation===r.operation&&r.value===e.value;case"mul":case"add":case"min":case"max":if(e.operation!==r.operation)return!1;var n=[];return r.operands.every((function(r,t){return e.operands.some((function(e,t){return!n.includes(t)&&(!!E(r,e)&&(n.push(t),!0))}))}));default:return r.operands.every((function(r,n){return E(r,e.operands[n])}))}}var M=function(r){for(var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=3735928559^n,o=1103547991^n,a=0;a<r.length;a++)e=r.charCodeAt(a),t=Math.imul(t^e,2654435761),o=Math.imul(o^e,1597334677);return t=Math.imul(t^t>>>16,2246822507)^Math.imul(o^o>>>13,3266489909),4294967296*(2097151&(o=Math.imul(o^o>>>16,2246822507)^Math.imul(t^t>>>13,3266489909)))+(t>>>0)};function k(r){var e=Math.imul(M(r.operation),5234543537);switch(r.operation){case"const":return e^M(r.value.toString(2));case"mul":case"add":case"min":case"max":return r.operands.reduce((function(r,e){return r^k(e)}),e);default:return r.operands.reduce((function(r,e){return Math.imul(r^k(e),9923429423)}),e)}}function O(r,e,t){var o=new Set,a=new Map,i=new Map;function u(r){var s=a.get(r);if(s)return s;s=e(r);var c=i.get(s);return c||(o.has(s)?(console.error("Found cyclical dependency during formula mapping"),v(NaN)):(o.add(s),c=t(function(r){var e=r.operands.map(u);return j(e,r.operands)?r:n(n({},r),{},{operands:e})}(s),r),o.delete(s),a.set(r,c),i.set(s,c),c))}var s=r.map(u);return j(s,r)?r:s}function j(r,e){return void 0===r?void 0===e:void 0!==e&&(r.length===e.length&&r.every((function(r,n){return r===e[n]})))}var x={min:function(r){return Math.min.apply(Math,a(r))},max:function(r){return Math.max.apply(Math,a(r))},add:function(r){return r.reduce((function(r,e){return r+e}),0)},mul:function(r){return r.reduce((function(r,e){return r*e}),1)}},B=n(n({},x),{},{res:function(r){var e=i(r,1)[0];return e<0?1-e/2:e>=.75?1/(4*e+1):1-e},sum_frac:function(r){return r[0]/r.reduce((function(r,e){return r+e}))},threshold:function(r){var e=i(r,4),n=e[0],t=e[1],o=e[2],a=e[3];return n>=t?o:a}}),T=new Set(Object.keys(x));function P(r,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(r){return!1};return r=D(r=F(r=I(r,e,n)))}function A(r,e){var n=new Set,t=new Set,o=new Map;!function(r,e,n){var t=new Set,o=new Set;r.forEach((function r(a){o.has(a)||(t.has(a)?console.error("Found cyclical dependency during formula traversal"):(t.add(a),e(a),a.operands.forEach(r),n(a),t.delete(a),o.add(a)))}))}(r,(function(r){}),(function(r){var a=r.operation;switch(a){case"read":if("number"!==r.type||r.accu&&"add"!==r.accu)throw new Error("Unsupported ".concat(a," node in precompute"));var i=e(r);n.add(i),o.set(r,i);break;case"add":case"min":case"max":case"mul":case"threshold":case"res":case"sum_frac":o.set(r,{ins:r.operands.map((function(r){return o.get(r)}))});break;case"const":if("number"!==typeof r.value)throw new Error("Found string constant while precomputing");var u=r.value;t.add(u),o.set(r,u);break;case"match":case"lookup":case"subscript":case"prio":case"small":case"data":throw new Error("Unsupported ".concat(a," node in precompute"));default:c(a)}}));var u=new Map,l=a(n),f=r.length,p=a(t),d=[];r.forEach((function(r,e){u.set(r,e),"const"===r.operation&&u.set(r.value,e)})),l.forEach((function(e,n){return u.set(e,n+r.length)}));var h=r.length+l.length;p.forEach((function(r){return u.has(r)||u.set(r,h++)})),o.forEach((function(r,e){"object"===typeof r?(u.has(e)||u.set(e,h++),d.push({out:u.get(e),ins:e.operands.map((function(r){return u.get(r)})),op:B[e.operation],buff:Array(e.operands.length).fill(0)})):u.set(e,u.get(r))}));var v=new Float64Array(h).fill(0);t.forEach((function(r){return v[u.get(r)]=r}));var m=r.map((function(r,e){var n=u.get(r);return n!==e?[n,e]:void 0})).filter((function(r){return r})),b=m.length?function(){m.forEach((function(r){var e=i(r,2),n=e[0],t=e[1];return v[t]=v[n]}))}:void 0;return[function(){return d.forEach((function(r){var e=r.out,n=r.ins,t=r.op,o=r.buff;n.forEach((function(r,e){return o[e]=v[r]})),v[e]=t(o)})),null===b||void 0===b||b(),v},s(l,(function(r,e){return f+e})),v]}function F(r){return O(r,(function(r){return r}),(function(r){var e=r;if(T.has(r.operation)){var t=r,o=t.operation,a=!1,i=t.operands.flatMap((function(r){return r.operation===o?(a=!0,r.operands):[r]}));e=a?n(n({},t),{},{operands:i}):t}return e}))}function D(r){function e(r){var e,n=new Map,t=f(r);try{for(t.s();!(e=t.n()).done;){var o,a=e.value;n.set(a,(null!==(o=n.get(a))&&void 0!==o?o:0)+1)}}catch(i){t.e(i)}finally{t.f()}return n}for(var t={common:{counts:new Map,formulas:new Set,operation:"add"}},o=function(){for(var o,u=void 0,s={operation:t.common.operation,operands:(o=t.common.counts,a(o).flatMap((function(r){var e=i(r,2),n=e[0],t=e[1];return Array(t).fill(n)})))},c=new Map,l=0,p=Object.keys(x);l<p.length;l++){var d=p[l];c.set(d,[])}if(r=O(r,(function(r){if(t.common.formulas.has(r)){var e=r,o=new Map(t.common.counts),a=e.operands.filter((function(r){var e=o.get(r);return!e||(o.set(r,e-1),!1)}));return a.length?(a.push(s),n(n({},e),{},{operands:a})):s}return r}),(function(r){if(!T.has(r.operation))return r;var n=r;if(u){if(u.operation===n.operation){var t,o=e(n.operands),a=new Map,s=u.counts,l=0,p=f(o.entries());try{for(p.s();!(t=p.n()).done;){var d,h=i(t.value,2),v=h[0],m=h[1],b=Math.min(m,null!==(d=s.get(v))&&void 0!==d?d:0);b?(a.set(v,b),l+=b):a.delete(v)}}catch(C){p.e(C)}finally{p.f()}l>1&&(u.counts=a,u.formulas.add(n))}}else{var g,y=c.get(n.operation),w=e(n.operands),S=f(y);try{for(S.s();!(g=S.n()).done;){var E,M=i(g.value,2),k=M[0],O=M[1],j=0,x=new Map,B=f(O.entries());try{for(B.s();!(E=B.n()).done;){var P,A=i(E.value,2),F=A[0],D=A[1],I=Math.min(D,null!==(P=w.get(F))&&void 0!==P?P:0);I&&(x.set(F,I),j+=I)}}catch(C){B.e(C)}finally{B.f()}if(j>1){u={counts:x,formulas:new Set([n,k]),operation:n.operation},c.clear();break}}}catch(C){S.e(C)}finally{S.f()}u||y.push([n,w])}return n})),!u)return"break";t.common=u};;){if("break"===o())break}return r}function I(r,e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(r){return!1},o={data:[],processed:new Map},s=new Map([[o,new Map]]);function l(r,e){var p,d=e.processed.get(r);if(d)return d;var h,m=r.operation;switch(m){case"const":return r;case"add":case"mul":case"max":case"min":var b=B[m],g=[],y=r.operands.filter((function(r){var n=l(r,e);return"const"!==n.operation||(g.push(n.value),!1)})).map((function(r){return l(r,e)})),w=b(g);if(isFinite(w)){if("mul"===m&&0===w){h=v(w);break}}else if("mul"!==m&&("max"!==m||w>0)&&("min"!==m||w<0)){h=v(w);break}w!==b([])&&y.push(v(w)),h=y.length<=1?null!==(p=y[0])&&void 0!==p?p:v(b([])):{operation:m,operands:y};break;case"res":case"sum_frac":var S=r.operands.map((function(r){return l(r,e)})),E=B[m];h=S.every((function(r){return"const"===r.operation}))?v(E(S.map((function(r){return r.value})))):n(n({},r),{},{operands:S});break;case"lookup":var M=l(r.operands[0],e);if("const"===M.operation){var k,O=null!==(k=r.table[M.value])&&void 0!==k?k:r.operands[1];if(O){h=l(O,e);break}}throw new Error("Unsupported ".concat(m," node while folding"));case"prio":var j=r.operands.find((function(r){var n=l(r,e);if("const"!==n.operation)throw new Error("Unsupported ".concat(m," node while folding"));return void 0!==n.value}));h=j?l(j,e):v(void 0);break;case"small":var x,T,P=void 0,A=f(r.operands);try{for(A.s();!(T=A.n()).done;){var F,D=l(T.value,e);if("const"!==D.operation)throw new Error("Unsupported ".concat(m," node while folding"));(void 0===(null===(F=P)||void 0===F?void 0:F.value)||void 0!==D.value&&D.value<P.value)&&(P=D)}}catch(X){A.e(X)}finally{A.f()}h=null!==(x=P)&&void 0!==x?x:v(void 0);break;case"match":var I=i(r.operands.map((function(r){return l(r,e)})),4),C=I[0],N=I[1],R=I[2],W=I[3];if("const"!==C.operation||"const"!==N.operation)throw new Error("Unsupported ".concat(m," node while folding"));h=C.value===N.value?R:W;break;case"threshold":var H=i(r.operands.map((function(r){return l(r,e)})),4),L=H[0],V=H[1],z=H[2],U=H[3];h="const"===L.operation&&"const"===V.operation?L.value>=V.value?z:U:n(n({},r),{},{operands:[L,V,z,U]});break;case"subscript":var G=i(r.operands.map((function(r){return l(r,e)})),1)[0];h="const"===G.operation?v(r.list[G.value]):n(n({},r),{},{operands:[G]});break;case"read":var q=e.data.map((function(e){return u(e,r.path)})).filter((function(r){return r}));if(0===q.length)if(t(r)){var _=r.accu;h=void 0===_||"small"===_?"string"===r.type?v(void 0):v(NaN):v(B[_]([]))}else h=r;else h=void 0===r.accu||1===q.length?l(q[q.length-1],e):l({operation:r.accu,operands:q},e);break;case"data":r.reset&&(e=o);var K=s.get(e),J=K.get(r.data);J||(J={data:[].concat(a(e.data),[r.data]),processed:new Map},s.set(J,new Map),K.set(r.data,J)),h=l(r.operands[0],J);break;default:c(m)}return e.processed.set(r,h),h}var p={data:[e],processed:new Map};return s.set(p,new Map),s.get(o).set(e,p),r.map((function(r){return l(r,p)}))}var C=["flower","plume","sands","goblet","circlet"],N=(["physical"].concat(["anemo","geo","electro","hydro","pyro","cryo"]),["Adventurer","ArchaicPetra","Berserker","BlizzardStrayer","BloodstainedChivalry","BraveHeart","CrimsonWitchOfFlames","DefendersWill","EchoesOfAnOffering","EmblemOfSeveredFate","Gambler","GladiatorsFinale","HeartOfDepth","HuskOfOpulentDreams","Instructor","Lavawalker","LuckyDog","MaidenBeloved","MartialArtist","NoblesseOblige","OceanHuedClam","PaleFlame","PrayersForDestiny","PrayersForIllumination","PrayersForWisdom","PrayersToSpringtime","ResolutionOfSojourner","RetracingBolide","Scholar","ShimenawasReminiscence","TenacityOfTheMillelith","TheExile","ThunderingFury","Thundersoother","TinyMiracle","TravelingDoctor","VermillionHereafter","ViridescentVenerer","WanderersTroupe"]);[].concat(["AmenomaKageuchi","AquilaFavonia","BlackcliffLongsword","CinnabarSpindle","CoolSteel","DarkIronSword","DullBlade","FavoniusSword","FesteringDesire","FilletBlade","FreedomSworn","HaranGeppakuFutsu","HarbingerOfDawn","IronSting","LionsRoar","MistsplitterReforged","PrimordialJadeCutter","PrototypeRancour","RoyalLongsword","SacrificialSword","SilverSword","SkyriderSword","SkywardBlade","SummitShaper","SwordOfDescension","TheAlleyFlash","TheBlackSword","TheFlute","TravelersHandySword"],["Akuoumaru","BlackcliffSlasher","BloodtaintedGreatsword","DebateClub","FavoniusGreatsword","FerrousShadow","KatsuragikiriNagamasa","LithicBlade","LuxuriousSeaLord","OldMercsPal","PrototypeArchaic","Rainslasher","RedhornStonethresher","RoyalGreatsword","SacrificialGreatsword","SerpentSpine","SkyriderGreatsword","SkywardPride","SnowTombedStarsilver","SongOfBrokenPines","TheBell","TheUnforged","WasterGreatsword","Whiteblind","WhiteIronGreatsword","WolfsGravestone"],["BeginnersProtector","BlackcliffPole","BlackTassel","CalamityQueller","CrescentPike","Deathmatch","DragonsBane","DragonspineSpear","EngulfingLightning","FavoniusLance","Halberd","IronPoint","KitainCrossSpear","LithicSpear","PrimordialJadeWingedSpear","PrototypeStarglitter","RoyalSpear","SkywardSpine","StaffOfHoma","TheCatch","VortexVanquisher","WavebreakersFin","WhiteTassel"],["AlleyHunter","AmosBow","AquaSimulacra","BlackcliffWarbow","CompoundBow","ElegyForTheEnd","FadingTwilight","FavoniusWarbow","Hamayumi","HuntersBow","Messenger","MitternachtsWaltz","MouunsMoon","PolarStar","Predator","PrototypeCrescent","RavenBow","RecurveBow","RoyalBow","Rust","SacrificialBow","SeasonedHuntersBow","SharpshootersOath","SkywardHarp","Slingshot","TheStringless","TheViridescentHunt","ThunderingPulse","WindblumeOde"],["ApprenticesNotes","BlackcliffAgate","DodocoTales","EmeraldOrb","EverlastingMoonglow","EyeOfPerception","FavoniusCodex","Frostbearer","HakushinRing","KagurasVerity","LostPrayerToTheSacredWinds","MagicGuide","MappaMare","MemoryOfDust","OathswornEye","OtherworldlyStory","PocketGrimoire","PrototypeAmber","RoyalGrimoire","SacrificialFragments","SkywardAtlas","SolarPearl","TheWidsith","ThrillingTalesOfDragonSlayers","TwinNephrite","WineAndSong"]);function R(r,e){return{base:r.base,values:s(C,(function(n){var t=e[n];switch(t.kind){case"id":return r.values[n].filter((function(r){return t.ids.has(r.id)}));case"exclude":return r.values[n].filter((function(r){return!t.sets.has(r.set)}));case"required":return r.values[n].filter((function(r){return t.sets.has(r.set)}))}}))}}function W(r){return C.reduce((function(e,n){return e*r.values[n].length}),1)}s(C,(function(r){return{kind:"exclude",sets:new Set}}));var H=function(){function r(e,t){var o=this,a=e.arts,i=e.optimizationTarget,u=e.filters,s=e.plotBase,c=e.maxBuilds;p(this,r),this.builds=[],this.buildValues=void 0,this.plotData=void 0,this.threshold=-1/0,this.maxBuilds=void 0,this.min=void 0,this.arts=void 0,this.nodes=void 0,this.callback=void 0,this.interimReport=function(r){o.refresh(!1),o.callback(n({command:"interim",buildValues:o.buildValues},r)),o.buildValues=void 0,r.tested=0,r.failed=0,r.skipped=0},this.arts=a,this.min=u.map((function(r){return r.min})),this.maxBuilds=c,this.callback=t,this.nodes=u.map((function(r){return r.value})),this.nodes.push(i),s&&(this.plotData={},this.nodes.push(s))}return h(r,[{key:"compute",value:function(r,e){this.threshold>r&&(this.threshold=r);var n=e.optimizationTarget,t=e.constraints,o=e.filter,u=e.artSetExclusion,s=this.min,c=this.interimReport,l=this,p=R(this.arts,o),d=W(p),h=P([].concat(a(t.map((function(r){return r.value}))),[n]),{},(function(r){return!1})),v=P(this.nodes,{},(function(r){return!1})),m=i(A(v,(function(r){return r.path[1]})),3),b=m[0],g=m[1],y=m[2],w=i(A(h,(function(r){return r.path[1]})),3),S=w[0],E=w[1],M=w[2],k=Object.values(p.values).sort((function(r,e){return r.length-e.length})).map((function(r){return r.map((function(r){return{id:r.id,set:r.set,values:Object.entries(r.values).map((function(r){var e,n=i(r,2),t=n[0],o=n[1];return{key:g[t],key2:null!==(e=E[t])&&void 0!==e?e:0,value:o,cache:0}})).filter((function(r){var e=r.key,n=r.value;return void 0!==e&&0!==n}))}}))})),O=Array(k.length).fill(""),j={tested:0,failed:0,skipped:d-W(p)};for(var x=0,B=Object.entries(p.base);x<B.length;x++){var T=i(B[x],2),F=T[0],D=T[1],I=g[F];void 0!==I&&(y[I]=D);var C=E[F];void 0!==C&&(M[C]=D)}return function r(e,n){if(e<0){var o=b(),d=S();if(Math.abs(o[s.length]-d[t.length])>1e-4)throw console.log("OOF COMPUTE NO MATCH"),console.log(p),console.log(v),console.log(h),console.log(y),console.log(M),Error("what?");var m=!Object.entries(u).some((function(r){var e=i(r,2),n=e[0],t=e[1],o=g[n];return!!o&&t.includes(y[o])}));if(void 0!==u.uniqueKey&&(m=u.uniqueKey.every((function(r){return r!==n.size}))),m&&s.every((function(r,e){return r<=o[e]}))){var w,E=o[s.length],x=l.builds,B=l.plotData;if(E>=l.threshold&&(w={value:E,artifactIds:a(O)},x.push(w)),B){var T=o[s.length+1];(!B[T]||B[T].value<E)&&(w||(w={value:E,artifactIds:a(O)}),w.plot=T,B[T]=w)}}else j.failed+=1}else k[e].forEach((function(t){O[e]=t.id;var o,a=f(t.values);try{for(a.s();!(o=a.n()).done;){var i=o.value,u=i.key,s=i.value;i.cache=y[u],y[u]+=s,M[i.key2]+=s}}catch(m){a.e(m)}finally{a.f()}n.has(t.set),n.delete(t.set),r(e-1,n),n.has(t.set),n.delete(t.set);var c,l=f(t.values);try{for(l.s();!(c=l.n()).done;){var p=c.value,d=p.key,h=p.key2,v=p.cache;y[d]=v,M[h]=v}}catch(m){l.e(m)}finally{l.f()}})),0===e&&(j.tested+=k[0].length,j.tested>8192&&c(j))}(k.length-1,new Set),this.interimReport(j),this.threshold}},{key:"refresh",value:function(r){var e,n,t=this.maxBuilds;Object.keys(null!==(e=this.plotData)&&void 0!==e?e:{}).length>=1e5&&(this.plotData=function(r){for(var e=.01,n=new Set(r.flatMap((function(r){return Object.values(r).map((function(r){return Math.round(r.plot/e)}))})));n.size>1500;)e*=2,n=new Set(a(n).map((function(r){return Math.round(r/2)})));var t,o={},i=f(r);try{for(i.s();!(t=i.n()).done;)for(var u=t.value,s=0,c=Object.values(u);s<c.length;s++){var l=c[s],p=Math.round(l.plot/e)*e;(!o[p]||o[p].value<l.value)&&(o[p]=l)}}catch(d){i.e(d)}finally{i.f()}return o}([this.plotData])),this.builds=this.builds.sort((function(r,e){return e.value-r.value})).slice(0,t),this.buildValues=this.builds.map((function(r){return r.value})),this.threshold=Math.max(this.threshold,null!==(n=this.buildValues[t-1])&&void 0!==n?n:-1/0)}}]),r}();function L(r){if(1===r.length)return r[0];var e=(r=r.flatMap((function(r){return"add"===r.operation?r.operands:r}))).reduce((function(r,e){return"const"===e.operation?r+e.value:r}),0);return 0===(r=r.filter((function(r){return"const"!==r.operation}))).length?v(e):0===e?b.apply(void 0,a(r)):b.apply(void 0,a(r).concat([v(e)]))}function V(r){if(1===r.length)return r[0];var e=(r=r.flatMap((function(r){return"mul"===r.operation?r.operands:r}))).reduce((function(r,e){return"const"===e.operation?r*e.value:r}),1);return 0===(r=r.filter((function(r){return"const"!==r.operation}))).length?v(e):0===e?b.apply(void 0,a(r)):g.apply(void 0,a(r).concat([v(e)]))}function z(r,e){var n={},t=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541],o=0;function u(r){for(var e=k(r),a=n[e];void 0!==a;){if(E(a.n,r))return BigInt(a.ix);a=a.next}var i=t[o];return n[e]={n:r,ix:i,next:n[e]},o+=1,BigInt(i)}var s={};return r.forEach((function(r){var n,t;if("const"!==r.operation)if(e(r)){var o,a,i=u(r).toString();s[i]={coeff:1+(null!==(o=null===(a=s[i])||void 0===a?void 0:a.coeff)&&void 0!==o?o:0),rhs:[r]}}else{if("mul"!==r.operation)throw console.log(r),Error("Encountered unexpected node in `gatherSumOfProds`");var c,l,f=r.operands.reduce((function(r,e){var n=r.coeff,t=r.ix,o=r.ops;return"const"===e.operation?{coeff:n*e.value,ix:t,ops:o}:(o.push(e),{coeff:n,ix:t*u(e),ops:o})}),{coeff:1,ix:BigInt(1),ops:[]}),p=f.coeff,d=f.ix,h=f.ops,v=d.toString();s[v]={coeff:p+(null!==(c=null===(l=s[v])||void 0===l?void 0:l.coeff)&&void 0!==c?c:0),rhs:h}}else s[1]={coeff:r.value+(null!==(n=null===(t=s[1])||void 0===t?void 0:t.coeff)&&void 0!==n?n:0),rhs:[]}})),Object.entries(s).map((function(r){var e=i(r,2),n=(e[0],e[1]),t=n.coeff,o=n.rhs;return V([].concat(a(o),[v(t)]))}))}function U(r,e){switch(r.operation){case"mul":var n=r.operands.map((function(r){return U(r,e)})).map((function(r){return"add"===r.operation?r.operands:[r]})).map((function(r,n){var t=r.map((function(r){return e(r)||"mul"===r.operation&&r.operands.some(e)})),o=r.filter((function(r,e){return t[e]})),i=r.filter((function(r,e){return!t[e]}));return 0===i.length?o:[].concat(a(o),[L(i)])}));return L(z(l.apply(void 0,a(n)).map((function(r){return V(r)})),e));case"add":return L(z(r.operands.map((function(r){return U(r,e)})).flatMap((function(r){return"add"===r.operation?r.operands:r})),e));default:return r}}function G(r){return q(r)<=5}function q(r){if("add"===r.operation)return Math.min.apply(Math,a(r.operands.map((function(r){return q(r)}))));if("mul"===r.operation)return r.operands.map((function(r){return q(r)})).reduce((function(r,e){return r+e}));if("threshold"===r.operation){var e=r.operands[0];if("read"===e.operation&&N.includes(e.path[1]))return r.operands[1].value}return 0}function _(r,e){var n=e.i,t=e.j,o=r[n][t];return r.map((function(e,a){return e.map((function(e,i){return a===n&&i===t?1/o:a===n?r[n][i]/o:i===t?-r[a][t]/o:e-r[n][i]*r[a][t]/o}))}))}function K(r){for(var e=r.length,n=r[0].length,t={i:-1,j:-1,cmp:1/0},o=0;o<n-1;o++)if(!(r[e-1][o]>=0)){for(var a=0;a<e-1;a++)if(r[a][o]>1e-5){var i=r[a][n-1]/r[a][o];i<t.cmp&&(t={i:a,j:o,cmp:i})}if(t.i<0)throw Error("UNBOUNDED FEASIBLE")}if(t.i<0)throw Error("NO PIVOTS (done)");return{i:t.i,j:t.j}}function J(r){for(var e=r.length,n=r[0].length,t={i:-1,j:-1,cmp:1/0},o=0;o<e-1;o++)if(!(r[o][n-1]>=0)){for(var a=0;a<n-1;a++)if(r[o][a]<-1e-5){var i=r[o][n-1]/r[o][a];i<t.cmp&&(t={i:o,j:a,cmp:i})}if(t.i<0)throw Error("INFEASIBLE");return{i:t.i,j:t.j}}throw Error("NO PIVOTS (done)")}function X(r,e,n){var t=i(A([r],(function(r){return r.path[1]})),3),o=t[0],a=t[1],u=t[2];Object.entries(e).forEach((function(r){var e,n=i(r,2),t=n[0],o=n[1];return u[null!==(e=a[t])&&void 0!==e?e:0]=o}));var s=o()[0];return Object.entries(n).forEach((function(r){var e,n=i(r,2),t=n[0],o=n[1];return u[null!==(e=a[t])&&void 0!==e?e:0]=o})),[s,o()[0]]}function Q(e,t,o){if("const"===e.operation)return{w:{},c:e.value,err:0};if("read"===e.operation)return{w:r({},e.path[1],1),c:0,err:0};if("mul"!==e.operation)throw Error("toLUB should only operate on product forms");n({},t);var u=n({},o);var s=U(function r(e){switch(e.operation){case"const":case"read":return e;case"add":return L(e.operands.map((function(e){return r(e)})));case"mul":return V(e.operands.map((function(e){return r(e)})));case"threshold":var n=i(e.operands,4),s=n[0],c=n[1],l=n[2],f=n[3];if("read"===s.operation&&"const"===c.operation&&"const"===f.operation&&"const"===l.operation){var p=s.path[1];if(t[p]>=c.value)return v(l.value);if(o[p]<c.value)return v(f.value);if(l.value<f.value)throw console.log(e),Error("Not Implemented (threshold must be increasing)");var d=(l.value-f.value)/c.value;return u[p]=c.value,b(f.value,g(d,s))}throw console.log(e),Error("Not Implemented (threshold must branch between constants)");case"res":var h=function(r,e,n){var t=function r(e){switch(e.operation){case"add":return b.apply(void 0,a(e.operands.map((function(e){return r(e)}))));case"const":return v(-e.value);case"threshold":var n=i(e.operands,4),t=n[0],o=n[1],u=n[2],s=n[3];if("const"===u.operation&&"const"===s.operation&&u.value<=s.value)return y(t,o,-u.value,s.value);throw console.log(e),Error("(res neg slope): threshold. Something went wrong.");default:throw console.log(e),Error("(res neg slope) Havent written logic to handle this")}}(r.operands[0]),o=i(X(t,e,n),2),u=o[0],s=o[1],c=B.res,l=[c([-u]),c([-s])],f=l[0],p=l[1];return s>0&&u>-1.75?b(1,g(.5,t)):b((s*f-u*p)/(s-u),g((f-p)/(s-u),t))}(e,t,o);return r(h=U(h,(function(r){return"const"!==r.operation})));case"min":var m=i(e.operands,2),w=m[0],S=m[1];if("const"!==S.operation){var E=[S,w];w=E[0],S=E[1]}return"read"===w.operation&&"const"===S.operation?(S.value<u[w.path[1]]&&(u[w.path[1]]=S.value),r(w)):r(w);case"max":var M=i(e.operands,2),k=M[0],O=M[1];if("const"!==O.operation){var j=[O,k];k=j[0],O=j[1]}if("const"===S.operation){var x=S.value,T=i(X(k,t,o),2),P=T[0],A=T[1];if(P>x)return k;if(x>A)return v(x);var F=x-P;return b(g((A-x)/(A-P),r(k)),F)}throw console.log(e),Error("Not Implemented (max)");case"sum_frac":var D=i(e.operands,2),I=D[0],C=D[1];if("const"!==C.operation)throw Error("Not Implemented (non-constant sum_frac denominator)");var N=i(X(I,t,o),2),R=N[0],W=N[1],H=C.value,z=Math.sqrt((R+H)*(W+H))-H,G=(H+z)*(H+z);return r(b(z*z/G,g(H/G,I)));default:throw console.log(e),Error("Not Implemented")}}(e),(function(r){return"const"!==r.operation}));if("const"===s.operation)return{w:{},c:s.value,err:0};function c(e){if("read"===e.operation)return{w:r({},e.path[1],1),c:0,err:0};if("const"===e.operation)return{w:{},c:e.value,err:0};if("mul"!==e.operation)throw console.log(e),Error("toLUB takes only mul nodes.");var n=1,i=e.operands.reduce((function(r,e){return"read"===e.operation&&r.push(e.path[1]),"const"===e.operation&&(n*=e.value),r}),[]),u=function(r){if(0===r.length)return{w:[],c:0,err:0};var e=r.length,n=r.map((function(r){return r.upper})),t=n.reduce((function(r,e){return r*e}),1);r=r.map((function(r){return{lower:r.lower/r.upper,upper:1}}));var o,i=l.apply(void 0,a(r.map((function(r){return[r.lower,r.upper]})))).flatMap((function(r){var e=r.reduce((function(r,e){return r*e}),1);return[[].concat(a(r.map((function(r){return-r}))),[1,0,-e]),[].concat(a(r),[-1,-1,e])]})),u=[].concat(a(r.map((function(r){return 0}))),[0,1]);try{o=function(r,e){var n=e.length+1,t=e[0].length,o=Array(n).fill(0).map((function(r){return Array(t).fill(0)}));e.forEach((function(r,e){return r.forEach((function(r,n){return o[e][n]=r}))})),r.forEach((function(r,e){return o[n-1][e]=r}));for(var a=[];o.some((function(r,e){return e<n-1&&r[t-1]<0}));){var i=J(o);a.push(i),o=_(o,i)}for(;o[n-1].some((function(r,e){return e<t-1&&r<0}));){var u=K(o);a.push(u),o=_(o,u)}return r.map((function(r,e){return function(r,e,n){var t=1;e.forEach((function(r){var e=r.i,o=r.j;1===t&&o===n?(n=e,t=0):0===t&&e===n&&(n=o,t=1)}));var o=r[0].length;return 0===t?r[n][o-1]:0}(o,a,e)}))}(u,i)}catch(s){throw console.log("ERROR on bounds",r),console.log("Possibly numerical instability issue."),s}return{w:o.slice(0,e).map((function(r,e){return r*t/n[e]})),c:-t*o[e],err:t*o[e+1]}}(i.map((function(r){return{lower:t[r],upper:o[r]}}))),s=u.w,c=u.c,f=u.err;return{w:s.reduce((function(r,e,t){var o;return r[i[t]]=e*n+(null!==(o=r[i[t]])&&void 0!==o?o:0),r}),{}),c:c*n,err:f*n+0}}return"add"===s.operation?s.operands.map((function(r){return c(r)})):c(s)}function $(r,e){var n=Object.entries(e.w).reduce((function(e,n){var t=i(n,2),o=t[0];return e+t[1]*r.base[o]}),e.c);return Object.entries(r.values).reduce((function(r,n){var t=i(n,2),o=(t[0],t[1].reduce((function(r,n){var t=Object.entries(e.w).reduce((function(r,e){var t=i(e,2),o=t[0];return r+t[1]*n.values[o]}),0);return r.v>t?r:{v:t,id:n.id}}),{v:0,id:""}));return r.v+=o.v,r.ids.push(o.id),r}),{v:n,ids:[]}).v}function Y(r){return{statsMin:Object.entries(r.values).reduce((function(r,e){var n=i(e,2),t=(n[0],n[1]),o={};return t.forEach((function(r){for(var e in r.values){var n;o[e]=Math.min(r.values[e],null!==(n=o[e])&&void 0!==n?n:1/0)}})),Object.entries(o).forEach((function(e){var n,t=i(e,2),o=t[0],a=t[1];return r[o]=a+(null!==(n=r[o])&&void 0!==n?n:0)})),r}),n({},r.base)),statsMax:Object.entries(r.values).reduce((function(r,e){var n=i(e,2),t=(n[0],n[1]),o={};return t.forEach((function(r){for(var e in r.values){var n;o[e]=Math.max(r.values[e],null!==(n=o[e])&&void 0!==n?n:0)}})),Object.entries(o).forEach((function(e){var n,t=i(e,2),o=t[0],a=t[1];return r[o]=a+(null!==(n=r[o])&&void 0!==n?n:0)})),r}),n({},r.base))}}function Z(r){var e=r.f,n=r.a,t=r.cachedCompute;if(void 0===t){var o=Y(n),a=o.statsMin,u=o.statsMax,s=e.map((function(r){return function(r,e,n){var t=n.statsMin,o=n.statsMax;if("const"===r.operation)return{maxEst:r.value,lin:Q(r,t,o)};if("read"===r.operation)return{maxEst:o[r.path[1]],lin:Q(r,t,o)};var a=U(r,(function(r){switch(r.operation){case"read":case"max":case"min":case"sum_frac":case"threshold":return!0;default:return!1}})).operands.filter(G).flatMap((function(r){return Q(r,t,o)})).reduce((function(r,e){return Object.entries(e.w).forEach((function(e){var n,t=i(e,2),o=t[0],a=t[1];return r.w[o]=a+(null!==(n=r.w[o])&&void 0!==n?n:0)})),{w:r.w,c:r.c+e.c,err:r.err+e.err}}),{w:{},c:0,err:0});return{maxEst:$(e,a),lin:a}}(r,n,{statsMin:a,statsMax:u})}));return{maxEst:s.map((function(r){return r.maxEst})),lin:s.map((function(r){return r.lin})),lower:a,upper:u}}var c=t.lin,l=t.lower,f=t.upper;return{maxEst:c.map((function(r){return $(n,r)})),lin:c,lower:l,upper:f}}var rr,er,nr,tr=function(){function r(e,n){var t,o,a=e.arts,u=e.optimizationTarget,s=e.filters,c=e.artSetExclusion;p(this,r),this.min=void 0,this.arts=void 0,this.nodes=void 0,this.artSet=void 0,this.subproblems=[],this.callback=void 0,this.arts=a,this.min=s.map((function(r){return r.min})),this.nodes=s.map((function(r){return r.value})),this.callback=n,this.min.push(-1/0),this.nodes.push(u),this.artSet=(t=Object.entries(c),o=function(r){var e=i(r,2),n=e[0],t=e[1];return"rainbow"===n?["uniqueKey",t.map((function(r){return r+1}))]:[n,t.flatMap((function(r){return 2===r?[2,3]:[4,5]}))]},Object.fromEntries(t.map((function(r){return o(r)}))))}return h(r,[{key:"addSubProblem",value:function(r){var e=W(R(this.arts,r.filter));0!==e&&this.subproblems.push({count:e,subproblem:r})}},{key:"split",value:function(r){var e=this,n=r.threshold,t=r.minCount,o=r.maxIter,a=r.subproblem;n>this.min[this.min.length-1]&&(this.min[this.min.length-1]=n),a&&this.addSubProblem(a),console.log("split",this.min[this.min.length-1],{todo:this.subproblems.length,buildsleft:this.subproblems.reduce((function(r,e){return r+e.count}),0)});for(var i=0;i<o&&this.subproblems.length;){i+=1;var u=this.subproblems.pop(),s=u.count,c=u.subproblem;if(s<=t)return[c];this.splitBNB(this.min[this.min.length-1],c).forEach((function(r){return e.addSubProblem(r)}))}return[]}},{key:"splitWork",value:function(r){var e=this,n=r.threshold,t=r.numSplits,o=r.subproblem;for(n>this.min[this.min.length-1]&&(this.min[this.min.length-1]=n),o&&this.addSubProblem(o);this.subproblems.length>0&&this.subproblems.length<=t;){var a=this.subproblems.shift().subproblem;this.splitBNB(this.min[this.min.length-1],a).forEach((function(r){return e.addSubProblem(r)}))}return console.log("exit splitWork. Filters pre-exit",this.subproblems),this.subproblems.splice(0,t).map((function(r){return r.subproblem}))}},{key:"splitBNB",value:function(r,e){var t=R(this.arts,e.filter);if(!1===e.cache){var o=Y(t),u=o.statsMin,c=o.statsMax,f=or(e,u,c);if(void 0===f)return[];var p=Z({f:[].concat(a(f.constraints.map((function(r){return r.value}))),[f.optimizationTarget]),a:t});if(f.constraints.some((function(r,e){var n=r.min;return p.maxEst[e]<n})))return[];if(p.maxEst[p.maxEst.length-1]<r)return[];e=n(n({},f),{},{cache:!0,cachedCompute:p})}var d=function(r,e){var n=e.lin,t=n[n.length-1],o=Object.keys(t.w),u={k:"",heur:-1};if(o.forEach((function(e){var n=Object.entries(r.values).reduce((function(r,n){var t=i(n,2),o=(t[0],t[1].map((function(r){return r.values[e]}))),u=Math.min.apply(Math,a(o)),s=Math.max.apply(Math,a(o));if(u===s)return r;var c=(u+s)/2,l=Math.max.apply(Math,a(o.filter((function(r){return r<=c})))),f=Math.min.apply(Math,a(o.filter((function(r){return r>c}))));return r+Math.min(s-l,f-u)}),0),o=t.w[e]*n;o>u.heur&&(u={k:e,heur:o})})),""===u.k)throw Error("Shatter broke...");return u}(t,e.cachedCompute),h=d.k,v=Object.fromEntries(Object.entries(t.values).map((function(r){var e=i(r,2),n=e[0],t=e[1].map((function(r){return r.values[h]}));return[n,(Math.min.apply(Math,a(t))+Math.max.apply(Math,a(t)))/2]}))),m=Object.fromEntries(Object.entries(t.values).map((function(r){var e=i(r,2),n=e[0],t=e[1],o=t.filter((function(r){return r.values[h]<v[n]})),a=t.filter((function(r){return!(r.values[h]<v[n])}));return[n,[a,o]]}))),b=e,g=(b.optimizationTarget,b.cachedCompute);if(g.maxEst[g.maxEst.length-1]<r)return[];var y=[];return l([0,1],[0,1],[0,1],[0,1],[0,1]).forEach((function(o){var u=i(o,5),c=u[0],l=u[1],f=u[2],p=u[3],d=u[4],h={base:n({},t.base),values:{flower:m.flower[c],plume:m.plume[l],sands:m.sands[f],goblet:m.goblet[p],circlet:m.circlet[d]}},v=Object.values(h.values).reduce((function(r,e){return r*e.length}),1);if(0!==v){var b=Y(h),w=b.statsMin,S=b.statsMax,E=or(e,w,S);if(void 0!==E){var M=Z({a:h,cachedCompute:g}).maxEst;if(!E.constraints.some((function(r,e){var n=r.min;return M[e]<n}))&&!(M[M.length-1]<r)){var k=[].concat(a(E.constraints.map((function(r){return r.value}))),[E.optimizationTarget]),O=Z({a:h,f:k});if(!E.constraints.some((function(r,e){var n=r.min;return O.maxEst[e]<n}))&&!(O.maxEst[O.maxEst.length-1]<r)){var j=s(C,(function(r){return{kind:"id",ids:new Set(h.values[r].map((function(r){return r.id})))}}));y.push({numBuilds:v,subproblem:n(n({},E),{},{filter:j,cache:!0,cachedCompute:O})})}}}}})),y.sort((function(r,e){return e.numBuilds-r.numBuilds})),y.map((function(r){return r.subproblem}))}}]),r}();function or(r,e,n){var t=r.optimizationTarget,o=r.constraints,u=r.artSetExclusion,s=[t].concat(a(o.map((function(r){return r.value})))),c=o.map((function(r){return r.min}));s=function(r,e,n){var t=Object.fromEntries(Object.entries(e).filter((function(r){var e=i(r,2),t=e[0];return e[1]===n[t]})));return P(O(r,(function(r){return r}),(function(r){if("read"===r.operation&&r.path[1]in t)return v(t[r.path[1]]);if("threshold"===r.operation){var o=i(r.operands,4),a=o[0],u=o[1],s=o[2],c=o[3];if("read"===a.operation&&"const"===u.operation){if(e[a.path[1]]>=u.value)return r.operands[2];if(n[a.path[1]]<u.value)return r.operands[3]}if("const"!==s.operation){if("const"===c.operation&&0===c.value)return g(y(a,u,1,0),s);throw Error("Threshold between non-const `pass` and non-zero `fail` not supported.")}}return r})),{})}(s,e,n);var l=i(A(s,(function(r){return r.path[1]})),3),f=l[0],p=l[1],d=l[2];Object.entries(e).forEach((function(r){var e,n=i(r,2),t=n[0],o=n[1];return d[null!==(e=p[t])&&void 0!==e?e:0]=o}));var h=f(),m=s.shift(),b=c.map((function(r,e){return r>h[e]}));b[0]=!0;for(var w=s.map((function(r,e){return{value:r,min:c[e]}})).filter((function(r,e){return b[e]})),S={},E=function(){var r=i(k[M],2),t=r[0],o=r[1];if("uniqueKey"===t)return S[t]=o,"continue";var a=o.filter((function(r){return e[t]<=r&&r<=n[t]}));if(a.includes(e[t])&&a.includes(n[t]))return{v:void 0};a.length>0&&(S[t]=a)},M=0,k=Object.entries(u);M<k.length;M++){var j=E();if("continue"!==j&&"object"===typeof j)return j.v}return{cache:!1,optimizationTarget:m,constraints:w,artSetExclusion:S,filter:r.filter}}onmessage=function(r){var e,t=r.data,o=t.command;switch(o){case"setup":rr=t.id;var a=function(r){return postMessage(n({id:rr},r))};er=new tr(t,a),nr=new H(t,a),e={command:"iterate"};break;case"split":e={command:"split",subproblems:er.split(t),ready:0===er.subproblems.length};break;case"splitwork":e={command:"split",subproblems:er.splitWork(t),ready:0===er.subproblems.length};break;case"iterate":var i=t.threshold,u=t.subproblem;nr.compute(i,u),e={command:"iterate"};break;case"finalize":nr.refresh(!0);var s=nr;e={command:"finalize",builds:s.builds,plotData:s.plotData};break;default:c(o)}postMessage(n({id:rr},e))}}();
//# sourceMappingURL=BackgroundWorker.71723401.worker.js.map