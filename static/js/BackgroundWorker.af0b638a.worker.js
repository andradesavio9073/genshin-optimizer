!function(){"use strict";function e(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}function n(n,r){if(n){if("string"===typeof n)return e(n,r);var t=Object.prototype.toString.call(n).slice(8,-1);return"Object"===t&&n.constructor&&(t=n.constructor.name),"Map"===t||"Set"===t?Array.from(n):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?e(n,r):void 0}}function r(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var t,a,o=[],i=!0,u=!1;try{for(r=r.call(e);!(i=(t=r.next()).done)&&(o.push(t.value),!n||o.length!==n);i=!0);}catch(c){u=!0,a=c}finally{try{i||null==r.return||r.return()}finally{if(u)throw a}}return o}}(e,r)||n(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(r){return function(n){if(Array.isArray(n))return e(n)}(r)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(r)||n(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function o(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function i(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?o(Object(r),!0).forEach((function(n){a(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function u(e,r){var t="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=n(e))||r&&e&&"number"===typeof e.length){t&&(e=t);var a=0,o=function(){};return{s:o,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,c=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return u=e.done,e},e:function(e){c=!0,i=e},f:function(){try{u||null==t.return||t.return()}finally{if(c)throw i}}}}function c(e,n){if(e&&n)return!Array.isArray(n)&&console.error(n),n.reduce((function(e,n){return null===e||void 0===e?void 0:e[n]}),e)}function s(e,n){return Object.fromEntries(e.map((function(e,r){return[e,n(e,r)]})))}function l(e,n){return Object.fromEntries(Object.entries(e).map((function(e,t){var a=r(e,2),o=a[0],i=a[1];return[o,n(i,o,t)]})))}function f(e){throw new Error("Should not reach this with value ".concat(e))}d(NaN,{key:"TODO"}),p(1),p(0);function d(e,n){return{operation:"const",operands:[],value:e,info:n}}function p(e,n){return e>=Number.MAX_VALUE/100&&(e=1/0),e<=-Number.MAX_VALUE/100&&(e=-1/0),d(e,i({key:"_"},n))}function v(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return{operation:"min",operands:b(n)}}function m(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return{operation:"max",operands:b(n)}}function h(e,n){return{operation:"read",operands:[],path:e,info:n,type:"number"}}function b(e){return e.map((function(e){return"object"===typeof e?e:d(e)}))}function g(e,n,r){var t=new Set,a=new Set;e.forEach((function e(o){a.has(o)||(t.has(o)?console.error("Found cyclical dependency during formula traversal"):(t.add(o),n(o),o.operands.forEach(e),r(o),t.delete(o),a.add(o)))}))}function y(e,n,r){var t=new Set,a=new Map,o=new Map;function u(e){var c=a.get(e);if(c)return c;c=n(e);var s=o.get(c);return s||(t.has(c)?(console.error("Found cyclical dependency during formula mapping"),d(NaN)):(t.add(c),s=r(function(e){var n=e.operands.map(u);return w(n,e.operands)?e:i(i({},e),{},{operands:n})}(c),e),t.delete(c),a.set(e,s),o.set(c,s),s))}var c=e.map(u);return w(c,e)?e:c}function w(e,n){return void 0===e?void 0===n:void 0!==n&&(e.length===n.length&&e.every((function(e,r){return e===n[r]})))}var k={min:function(e){return Math.min.apply(Math,t(e))},max:function(e){return Math.max.apply(Math,t(e))},add:function(e){return e.reduce((function(e,n){return e+n}),0)},mul:function(e){return e.reduce((function(e,n){return e*n}),1)}},S=i(i({},k),{},{res:function(e){var n=r(e,1)[0];return n<0?1-n/2:n>=.75?1/(4*n+1):1-n},sum_frac:function(e){return e[0]/e.reduce((function(e,n){return e+n}))},threshold:function(e){var n=r(e,4),t=n[0],a=n[1],o=n[2],i=n[3];return t>=a?o:i}}),O=new Set(Object.keys(k));function x(e){return y(e,(function(e){return e}),(function(e){var n=e;if(O.has(e.operation)){var r=e,t=r.operation,a=!1,o=r.operands.flatMap((function(e){return e.operation===t?(a=!0,e.operands):[e]}));n=a?i(i({},r),{},{operands:o}):r}return n}))}function M(e){function n(e){var n,r=new Map,t=u(e);try{for(t.s();!(n=t.n()).done;){var a,o=n.value;r.set(o,(null!==(a=r.get(o))&&void 0!==a?a:0)+1)}}catch(i){t.e(i)}finally{t.f()}return r}for(var a={common:{counts:new Map,formulas:new Set,operation:"add"}},o=function(){for(var o,c=void 0,s={operation:a.common.operation,operands:(o=a.common.counts,t(o).flatMap((function(e){var n=r(e,2),t=n[0],a=n[1];return Array(a).fill(t)})))},l=new Map,f=0,d=Object.keys(k);f<d.length;f++){var p=d[f];l.set(p,[])}if(e=y(e,(function(e){if(a.common.formulas.has(e)){var n=e,r=new Map(a.common.counts),t=n.operands.filter((function(e){var n=r.get(e);return!n||(r.set(e,n-1),!1)}));return t.length?(t.push(s),i(i({},n),{},{operands:t})):s}return e}),(function(e){if(!O.has(e.operation))return e;var t=e;if(c){if(c.operation===t.operation){var a,o=n(t.operands),i=new Map,s=c.counts,f=0,d=u(o.entries());try{for(d.s();!(a=d.n()).done;){var p,v=r(a.value,2),m=v[0],h=v[1],b=Math.min(h,null!==(p=s.get(m))&&void 0!==p?p:0);b?(i.set(m,b),f+=b):i.delete(m)}}catch(D){d.e(D)}finally{d.f()}f>1&&(c.counts=i,c.formulas.add(t))}}else{var g,y=l.get(t.operation),w=n(t.operands),k=u(y);try{for(k.s();!(g=k.n()).done;){var S,x=r(g.value,2),M=x[0],E=x[1],j=0,A=new Map,P=u(E.entries());try{for(P.s();!(S=P.n()).done;){var B,F=r(S.value,2),T=F[0],R=F[1],N=Math.min(R,null!==(B=w.get(T))&&void 0!==B?B:0);N&&(A.set(T,N),j+=N)}}catch(D){P.e(D)}finally{P.f()}if(j>1){c={counts:A,formulas:new Set([t,M]),operation:t.operation},l.clear();break}}}catch(D){k.e(D)}finally{k.f()}c||y.push([t,w])}return t})),!c)return"break";a.common=c};;){if("break"===o())break}return e}function E(e,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return!1},o={data:[],processed:new Map},s=new Map([[o,new Map]]);function l(e,n){var p,v=n.processed.get(e);if(v)return v;var m,h=e.operation;switch(h){case"const":return e;case"add":case"mul":case"max":case"min":var b=S[h],g=[],y=e.operands.filter((function(e){var r=l(e,n);return"const"!==r.operation||(g.push(r.value),!1)})).map((function(e){return l(e,n)})),w=b(g);if(isFinite(w)){if("mul"===h&&0===w){m=d(w);break}}else if("mul"!==h&&("max"!==h||w>0)&&("min"!==h||w<0)){m=d(w);break}w!==b([])&&y.push(d(w)),m=y.length<=1?null!==(p=y[0])&&void 0!==p?p:d(b([])):{operation:h,operands:y};break;case"res":case"sum_frac":var k=e.operands.map((function(e){return l(e,n)})),O=S[h];m=k.every((function(e){return"const"===e.operation}))?d(O(k.map((function(e){return e.value})))):i(i({},e),{},{operands:k});break;case"lookup":var x=l(e.operands[0],n);if("const"===x.operation){var M,E=null!==(M=e.table[x.value])&&void 0!==M?M:e.operands[1];if(E){m=l(E,n);break}}throw new Error("Unsupported ".concat(h," node while folding"));case"prio":var j=e.operands.find((function(e){var r=l(e,n);if("const"!==r.operation)throw new Error("Unsupported ".concat(h," node while folding"));return void 0!==r.value}));m=j?l(j,n):d(void 0);break;case"small":var A,P,B=void 0,F=u(e.operands);try{for(F.s();!(P=F.n()).done;){var T,R=l(P.value,n);if("const"!==R.operation)throw new Error("Unsupported ".concat(h," node while folding"));(void 0===(null===(T=B)||void 0===T?void 0:T.value)||void 0!==R.value&&R.value<B.value)&&(B=R)}}catch(X){F.e(X)}finally{F.f()}m=null!==(A=B)&&void 0!==A?A:d(void 0);break;case"match":var N=r(e.operands.map((function(e){return l(e,n)})),4),D=N[0],C=N[1],W=N[2],I=N[3];if("const"!==D.operation||"const"!==C.operation)throw new Error("Unsupported ".concat(h," node while folding"));m=D.value===C.value?W:I;break;case"threshold":var G=r(e.operands.map((function(e){return l(e,n)})),4),H=G[0],L=G[1],U=G[2],_=G[3];m="const"===H.operation&&"const"===L.operation?H.value>=L.value?U:_:i(i({},e),{},{operands:[H,L,U,_]});break;case"subscript":var q=r(e.operands.map((function(e){return l(e,n)})),1)[0];m="const"===q.operation?d(e.list[q.value]):i(i({},e),{},{operands:[q]});break;case"read":var V=n.data.map((function(n){return c(n,e.path)})).filter((function(e){return e}));if(0===V.length)if(a(e)){var z=e.accu;m=void 0===z||"small"===z?"string"===e.type?d(void 0):d(NaN):d(S[z]([]))}else m=e;else m=void 0===e.accu||1===V.length?l(V[V.length-1],n):l({operation:e.accu,operands:V},n);break;case"data":e.reset&&(n=o);var K=s.get(n),J=K.get(e.data);J||(J={data:[].concat(t(n.data),[e.data]),processed:new Map},s.set(J,new Map),K.set(e.data,J)),m=l(e.operands[0],J);break;default:f(h)}return n.processed.set(e,m),m}var p={data:[n],processed:new Map};return s.set(p,new Map),s.get(o).set(n,p),e.map((function(e){return l(e,p)}))}var j,A,P,B,F,T=["flower","plume","sands","goblet","circlet"];["physical"].concat(["anemo","geo","electro","hydro","pyro","cryo"]),[].concat(["AmenomaKageuchi","AquilaFavonia","BlackcliffLongsword","CinnabarSpindle","CoolSteel","DarkIronSword","DullBlade","FavoniusSword","FesteringDesire","FilletBlade","FreedomSworn","HaranGeppakuFutsu","HarbingerOfDawn","IronSting","LionsRoar","MistsplitterReforged","PrimordialJadeCutter","PrototypeRancour","RoyalLongsword","SacrificialSword","SilverSword","SkyriderSword","SkywardBlade","SummitShaper","SwordOfDescension","TheAlleyFlash","TheBlackSword","TheFlute","TravelersHandySword"],["Akuoumaru","BlackcliffSlasher","BloodtaintedGreatsword","DebateClub","FavoniusGreatsword","FerrousShadow","KatsuragikiriNagamasa","LithicBlade","LuxuriousSeaLord","OldMercsPal","PrototypeArchaic","Rainslasher","RedhornStonethresher","RoyalGreatsword","SacrificialGreatsword","SerpentSpine","SkyriderGreatsword","SkywardPride","SnowTombedStarsilver","SongOfBrokenPines","TheBell","TheUnforged","WasterGreatsword","Whiteblind","WhiteIronGreatsword","WolfsGravestone"],["BeginnersProtector","BlackcliffPole","BlackTassel","CalamityQueller","CrescentPike","Deathmatch","DragonsBane","DragonspineSpear","EngulfingLightning","FavoniusLance","Halberd","IronPoint","KitainCrossSpear","LithicSpear","PrimordialJadeWingedSpear","PrototypeStarglitter","RoyalSpear","SkywardSpine","StaffOfHoma","TheCatch","VortexVanquisher","WavebreakersFin","WhiteTassel"],["AlleyHunter","AmosBow","AquaSimulacra","BlackcliffWarbow","CompoundBow","ElegyForTheEnd","FadingTwilight","FavoniusWarbow","Hamayumi","HuntersBow","Messenger","MitternachtsWaltz","MouunsMoon","PolarStar","Predator","PrototypeCrescent","RavenBow","RecurveBow","RoyalBow","Rust","SacrificialBow","SeasonedHuntersBow","SharpshootersOath","SkywardHarp","Slingshot","TheStringless","TheViridescentHunt","ThunderingPulse","WindblumeOde"],["ApprenticesNotes","BlackcliffAgate","DodocoTales","EmeraldOrb","EverlastingMoonglow","EyeOfPerception","FavoniusCodex","Frostbearer","HakushinRing","KagurasVerity","LostPrayerToTheSacredWinds","MagicGuide","MappaMare","MemoryOfDust","OathswornEye","OtherworldlyStory","PocketGrimoire","PrototypeAmber","RoyalGrimoire","SacrificialFragments","SkywardAtlas","SolarPearl","TheWidsith","ThrillingTalesOfDragonSlayers","TwinNephrite","WineAndSong"]);function R(e,n){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=new Set,c=new Set;function p(e,n){n?o.add(e):e.operands.forEach((function(e){var n=e;o.has(n)&&c.add(n)}))}var v=new Set;if(g(e,(function(e){}),(function(e){var n=e.operation;switch(n){case"read":if("number"!==e.type||"dyn"!==e.path[0]||"add"!==e.accu)throw new Error("Found unsupported ".concat(n," node at path ").concat(e.path," when computing affine nodes"));v.add(e.path[1]),p(e,!0);break;case"add":p(e,e.operands.every((function(e){return o.has(e)})));break;case"mul":var r=e.operands.filter((function(e){return"const"!==e.operation}));p(e,0===r.length||1===r.length&&o.has(r[0]));break;case"const":if("string"===typeof e.value||void 0===e.value)throw new Error("Found constant ".concat(e.value," while compacting"));p(e,!0);break;case"res":case"threshold":case"sum_frac":case"max":case"min":p(e,!1);break;case"data":case"subscript":case"lookup":case"match":case"prio":case"small":throw new Error("Found unsupported ".concat(n," node when computing affine nodes"));default:f(n)}})),t(c).every((function(e){var n=e.operation;return"read"===n||"const"===n}))&&Object.keys(n.base).length===v.size)return{nodes:e,arts:n};var m=-1;function b(){for(;v.has("".concat(++m)););return"".concat(m)}e.forEach((function(e){return o.has(e)&&c.add(e)}));var w=t(c).filter((function(e){return"const"!==e.operation})),k=new Map(w.map((function(e){return[e,a||"read"!==e.operation||"dyn"!==e.path[0]?i(i({},h(["dyn","".concat(b())])),{},{accu:"add"}):e]})));function S(e){var n=E(t(k.keys()),{dyn:l(e,(function(e){return d(e)}))},(function(e){return!0}));return Object.fromEntries(t(k.values()).map((function(e,r){return[e.path[1],n[r].value]})))}for(var O={nodes:e=y(e,(function(e){var n;return null!==(n=k.get(e))&&void 0!==n?n:e}),(function(e){return e})),arts:{base:S(n.base),values:s(T,(function(e){return n.values[e].map((function(e){return{id:e.id,set:e.set,values:S(e.values)}}))}))}},x=Object.entries(S({})),M=0,j=Object.values(O.arts.values);M<j.length;M++){var A,P=j[M],B=u(P);try{for(B.s();!(A=B.n()).done;){var F,R=A.value.values,N=u(x);try{for(N.s();!(F=N.n()).done;){var D=r(F.value,2),C=D[0],W=D[1];R[C]-=W}}catch(I){N.e(I)}finally{N.f()}}}catch(I){B.e(I)}finally{B.f()}}return O}function N(e,n,t){var a=!1,o=s(T,(function(o){var i=e.values[o],u=i.filter((function(e){var a=0;return i.every((function(o){var i=Object.entries(o.values).every((function(n){var t=r(n,2),a=t[0];return t[1]>=e.values[a]})),u=Object.entries(o.values).some((function(n){var t=r(n,2),a=t[0];return t[1]>e.values[a]}));return!i||!(u||o.id>e.id)||t.has(e.set)&&e.set!==o.set||a++,a<n}))}));return u.length!==i.length&&(a=!0),u}));return a?{base:e.base,values:o}:e}function D(e,n,t){for(var a=Object.fromEntries(Object.entries(n.base).map((function(e){var n=r(e,2),t=n[0],a=n[1];return[t,{min:a,max:a}]}))),o={arts:n},i=function(){var n=s(T,(function(e){return I(o.arts.values[e])})),r=s(T,(function(e){return W(Object.entries(n).map((function(n){return n[0]===e?a:n[1]})).filter((function(e){return e})))})),i=!1,u=s(T,(function(n){var a=o.arts.values[n].filter((function(a){var o=W([I([a]),r[n]]),i=G(e,o);return e.every((function(e,n){var r;return i.get(e).max>=(null!==(r=t[n])&&void 0!==r?r:-1/0)}))}));return a.length!==o.arts.values[n].length&&(i=!0),a}));if(!i)return"break";o.arts={base:o.arts.base,values:u}};;){if("break"===i())break}return o.arts}function C(e,n){var a=G(e,W([Object.fromEntries(Object.entries(n.base).map((function(e){var n=r(e,2),t=n[0],a=n[1];return[t,{min:a,max:a}]})))].concat(t(Object.values(n.values).map((function(e){return I(e)}))))));return y(e,(function(e){var n=e.operation,o=e.operands.map((function(e){return a.get(e)}));switch(n){case"threshold":var i=r(o,4),u=i[0],c=i[1],s=i[2],l=i[3];if(u.min>=c.max)return e.operands[2];if(u.max<c.min)return d(0);if(s.max===s.min&&l.max===l.min&&s.min===l.min&&isFinite(s.min))return d(s.max);break;case"min":var f=e.operands.filter((function(e,n){var r=o[n];return o.every((function(e,n){return r.min<=e.max}))}));if(f.length<o.length)return v.apply(void 0,t(f));break;case"max":var p=e.operands.filter((function(e,n){var r=o[n];return o.every((function(e){return r.max>=e.min}))}));if(p.length<o.length)return m.apply(void 0,t(p))}return e}),(function(e){return e}))}function W(e){var n={};return e.forEach((function(e){Object.entries(e).forEach((function(e){var t=r(e,2),a=t[0],o=t[1];n[a]?(n[a].min+=o.min,n[a].max+=o.max):n[a]=i({},o)}))})),n}function I(e){var n={};return e.length&&(Object.keys(e[0].values).filter((function(n){return e.every((function(e){return e.values[n]}))})).forEach((function(r){return n[r]={min:e[0].values[r],max:e[0].values[r]}})),e.forEach((function(e){for(var t=e.values,a=0,o=Object.entries(t);a<o.length;a++){var i=r(o[a],2),u=i[0],c=i[1];n[u]?(n[u].max<c&&(n[u].max=c),n[u].min>c&&(n[u].min=c)):n[u]={min:0,max:c}}}))),n}function G(e,n){var t=new Map;return g(e,(function(e){}),(function(e){var a,o,i=e,u=i.operation,c=i.operands.map((function(e){return t.get(e)}));switch(u){case"read":if("dyn"!==i.path[0])throw new Error("Found non-dyn path ".concat(i.path," while computing range"));o=null!==(a=n[i.path[1]])&&void 0!==a?a:{min:0,max:0};break;case"const":o=H([i.value]);break;case"subscript":o=H(i.list);break;case"add":case"min":case"max":o={min:S[u](c.map((function(e){return e.min}))),max:S[u](c.map((function(e){return e.max})))};break;case"res":o={min:S[u]([c[0].max]),max:S[u]([c[0].min])};break;case"mul":o=c.reduce((function(e,n){return H([e.min*n.min,e.min*n.max,e.max*n.min,e.max*n.max])}));break;case"threshold":o=c[0].min>=c[1].max?c[2]:c[0].max<c[1].min?H([0]):H([0],[c[2]]);break;case"sum_frac":var s=r(c,2),l=s[0],d=s[1],p={min:l.min+d.min,max:l.max+d.max};o=p.min<=0&&p.max>=0?l.min<=0&&l.max>=0?{min:NaN,max:NaN}:{min:-1/0,max:1/0}:H([l.min/p.min,l.min/p.max,l.max/p.min,l.max/p.max]);break;case"data":case"lookup":case"match":throw new Error("Unsupported ".concat(u," node"));default:f(u)}t.set(i,o)})),t}function H(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=Math.max.apply(Math,t(e).concat(t(n.map((function(e){return e.max}))))),a=Math.min.apply(Math,t(e).concat(t(n.map((function(e){return e.min})))));return{min:a,max:r}}function L(e){return T.reduce((function(n,r){return n*e.values[r].length}),1)}var U=void 0;function _(e){var n=e.threshold,a=e.filter;F>n&&(F=n);var o=function(e,n){return{base:e.base,values:s(T,(function(r){var t=n[r];switch(t.kind){case"id":return e.values[r].filter((function(e){return t.ids.has(e.id)}));case"exclude":return e.values[r].filter((function(e){return!t.sets.has(e.set)}));case"required":return e.values[r].filter((function(e){return t.sets.has(e.set)}))}}))}}(U.arts,a),u=L(o),c=function(e,n){return M(e=x(e=E(e,n,arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return!1})))}(U.nodes,{},(function(e){return!1})),l=function(e,n,r,t,a,o){for(var u=o,c={pruneNodeRange:!0},s={pruneNodeRange:!0},l={reaffine:!0},f={pruneOrder:!0,pruneArtRange:!0,pruneNodeRange:!0},d=0;Object.values(u).some((function(e){return e}))&&d++<20;){if(u.pruneOrder){delete u.pruneOrder;var p=N(r,t,a);r!==p&&(r=p,u=i(i({},u),c))}if(u.pruneArtRange){delete u.pruneArtRange;var v=D(e,r,n);r!==v&&(r=v,u=i(i({},u),s))}if(u.pruneNodeRange){delete u.pruneNodeRange;var m=C(e,r);e!==m&&(e=m,u=i(i({},u),l))}if(u.reaffine){delete u.reaffine;var h=R(e,r),b=h.nodes,g=h.arts;e===b&&r===g||(e=b,r=g,u=i(i({},u),f))}}return{nodes:e,arts:r}}(c,U.min,o,U.maxBuilds,new Set,{pruneArtRange:!0,pruneNodeRange:!0});c=l.nodes,o=l.arts;var d=function(e,n){var a=new Set,o=new Set,i=new Map;g(e,(function(e){}),(function(e){var r=e.operation;switch(r){case"read":if("number"!==e.type||e.accu&&"add"!==e.accu)throw new Error("Unsupported ".concat(r," node in precompute"));var t=n(e);a.add(t),i.set(e,t);break;case"add":case"min":case"max":case"mul":case"threshold":case"res":case"sum_frac":i.set(e,{ins:e.operands.map((function(e){return i.get(e)}))});break;case"const":if("number"!==typeof e.value)throw new Error("Found string constant while precomputing");var u=e.value;o.add(u),i.set(e,u);break;case"match":case"lookup":case"subscript":case"prio":case"small":case"data":throw new Error("Unsupported ".concat(r," node in precompute"));default:f(r)}}));var u=new Map,c=t(a),s=e.length,l=t(o),d=[];e.forEach((function(e,n){u.set(e,n),"const"===e.operation&&u.set(e.value,n)})),c.forEach((function(n,r){return u.set(n,r+e.length)}));var p=e.length+c.length;l.forEach((function(e){return u.has(e)||u.set(e,p++)})),i.forEach((function(e,n){"object"===typeof e?(u.has(n)||u.set(n,p++),d.push({out:u.get(n),ins:n.operands.map((function(e){return u.get(e)})),op:S[n.operation],buff:Array(n.operands.length).fill(0)})):u.set(n,u.get(e))}));var v=Array(p).fill(0);v.forEach((function(e,n,r){return r[n]=NaN})),o.forEach((function(e){return v[u.get(e)]=e}));var m=e.map((function(e,n){var r=u.get(e);return r!==n?[r,n]:void 0})).filter((function(e){return e})),h=m.length?function(){m.forEach((function(e){var n=r(e,2),t=n[0],a=n[1];return v[a]=v[t]}))}:void 0;return function(e){return c.forEach((function(n,r){var t;return v[s+r]=null!==(t=e[n])&&void 0!==t?t:0})),d.forEach((function(e){var n=e.out,r=e.ins,t=e.op,a=e.buff;r.forEach((function(e,n){return a[n]=v[e]})),v[n]=t(a)})),null===h||void 0===h||h(),v}}(c,(function(e){return e.path[1]})),p=Object.values(o.values).sort((function(e,n){return e.length-n.length})),v=Array(p.length).fill(""),m={build:0,failed:0,skipped:u-L(o)};return function e(n,a){if(n<0){var o=d(a);if(U.min.every((function(e,n){return e<=o[n]}))){var u,c=o[U.min.length];if(c>=F&&(u={value:c,artifactIds:t(v)},A.push(u)),B){var s=o[U.min.length+1];(!B[s]||B[s].value<c)&&(u||(u={value:c,artifactIds:t(v)}),u.plot=s,B[s]=u)}}else m.failed+=1}else p[n].forEach((function(t){v[n]=t.id;var o=i({},a);Object.entries(t.values).forEach((function(e){var n,t=r(e,2),a=t[0],i=t[1];return o[a]=(null!==(n=o[a])&&void 0!==n?n:0)+i})),e(n-1,o)})),0===n&&(m.build+=p[0].length,m.build>8192&&q(m))}(p.length-1,o.base),q(m),{command:"request",id:j,total:u}}var q=function(e){V(!1),U.callback({command:"interim",id:j,buildValues:P,buildCount:e.build,failedCount:e.failed,skippedCount:e.skipped}),P=void 0,e.build=0,e.failed=0,e.skipped=0};function V(e){var n;(B&&Object.keys(B).length>=1e5&&(B=function(e){for(var n=.01,r=new Set(e.flatMap((function(e){return Object.values(e).map((function(e){return Math.round(e.plot/n)}))})));r.size>1500;)n*=2,r=new Set(t(r).map((function(e){return Math.round(e/2)})));var a,o={},i=u(e);try{for(i.s();!(a=i.n()).done;)for(var c=a.value,s=0,l=Object.values(c);s<l.length;s++){var f=l[s],d=Math.round(f.plot/n)*n;(!o[d]||o[d].value<f.value)&&(o[d]=f)}}catch(p){i.e(p)}finally{i.f()}return o}([B])),A.length>=1e5||e)&&(A=A.sort((function(e,n){return n.value-e.value})).slice(0,U.maxBuilds),P=A.map((function(e){return e.value})),F=Math.max(F,null!==(n=P[U.maxBuilds-1])&&void 0!==n?n:-1/0))}onmessage=function(e){var n,r,t=e.data,a=t.command;switch(a){case"setup":postMessage((r=function(e){return postMessage(e,void 0)},(U=i({},n=t)).nodes=n.filters.map((function(e){return e.value})),U.min=n.filters.map((function(e){return e.min})),U.callback=r,U.nodes.push(n.optimizationTarget),n.plotBase&&(B={},U.nodes.push(n.plotBase)),j=n.id,A=[],P=void 0,F=-1/0,{command:"request",id:j}));break;case"request":postMessage(_(t));break;case"finalize":postMessage((V(!0),{command:"finalize",id:j,builds:A,plotData:B}));break;default:f(a)}}}();
//# sourceMappingURL=BackgroundWorker.af0b638a.worker.js.map